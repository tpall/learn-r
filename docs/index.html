<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ülo Maiväli1, Taavi Päll2" />

<meta name="date" content="2021-09-03" />

<title>Reproducible Data Analysis in R</title>

<script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Reproducible Data Analysis in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Reproducible Data Analysis in R</h1>
<h4 class="author">Ülo Maiväli<sup>1</sup>, Taavi Päll<sup>2</sup></h4>
<h4 class="date">2021-09-03</h4>

</div>


<p><sup>1</sup><a href="http://www.tuit.ut.ee/en">University of Tartu, Institute of Technology</a>,<br />
<sup>2</sup><a href="https://www.biomeditsiin.ut.ee/en/institute/department-microbiology">University of Tartu, Institute of Biomedicine and Translational Medicine</a></p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>R is <a href="https://en.wikipedia.org/wiki/Functional_programming">functional programming language</a> and <a href="https://www.r-project.org/about.html">statistical environment</a>.</p>
<div id="about" class="section level2">
<h2>About</h2>
<p>R statistical language is based on <strong>S</strong> (R is <a href="https://en.wikipedia.org/wiki/GNU">GNU</a> S). S was developed by John Chambers (mainly), Rick Becker and Allan Wilks of Bell Laboratories. The first version of S saw light in 1976. The aim of the S language was “to turn ideas into software, quickly and faithfully”. R was initially written by Robert Gentleman and Ross Ihaka at the University of Auckland Statistics Department. The project is relatively new, conceived in 1992, with an initial version released in 1994 and a first stable beta version in 2000.</p>
<div id="r-pros" class="section level3">
<h3>R pros</h3>
<ul>
<li>Just about any type of data analysis can be done in R.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="index_files/figure-html/plotcranpackages-1.png" alt="There are about eight packages supplied with the R distribution. The number of available CRAN packages grows exponentially, featuring 9560 available packages as of 2016-11-21 ." width="672" />
<p class="caption">
There are about eight packages supplied with the R distribution. The number of available CRAN packages grows exponentially, featuring 9560 available packages as of 2016-11-21 .
</p>
</div>
<ul>
<li>R contains advanced statistical routines not yet available in other packages @ref(fig:plotcranpackages).<br />
</li>
<li>R provides reproducibility in data analysis, and yet is very flexible (everyone can write their parallel solution to any problem).</li>
<li>R has the most comprehensive feature set available to visualize complex data.</li>
<li>The results of any analytic step can easily be saved, manipulated, and used as input for additional analyses.</li>
<li>R can import/export data from text files, pdf-s, database-management systems, statistical packages, and specialized data stores.</li>
<li>R can also access data directly from web pages, social media sites, and a wide range of online data services.<br />
</li>
<li>R provides a natural language for quickly programming recently published methods.<br />
</li>
<li>Most operations in R are much quicker than manipulating tables in MS Excel or LO Calc.</li>
<li>R has a large community of users – most questions can be quickly answered by googling.<br />
</li>
<li>For a non-programmer R is easier to learn than Python, etc. (Ülo: most users do not program in R, and don’t need to.)</li>
</ul>
<p>A key reason that R is a good thing is because it is a language. The power of language is abstraction. The way to make abstractions in R is to write functions <a href="http://www.burns-stat.com/pages/Tutor/R_inferno.pdf">(Burns, 2011)</a>.</p>
</div>
<div id="r-cons-none-is-the-deal-breaker" class="section level3">
<h3>R cons (none is the deal breaker):</h3>
<ul>
<li>With R you must know exactly, what you want to do – in terms of your immediate atomic goals in data massage, methods of statistical analysis, and the overall strategy of analysis.</li>
<li>It is <strong>like getting your own keys to daddy’s F-16 fighter plane</strong>. Get a setting wrong <strong>and boom!</strong></li>
</ul>
<div class="figure">
<img src="http://nkpzz1l56ai473pu632f0nui.wpengine.netdna-cdn.com/wp-content/uploads/2015/01/amazing-model-airplane-remote-control-replica-of-dutch-orange-f-16-fighter-jet-672x377.jpg" alt="" />
<p class="caption">Unlike your daddy’s F-16, it’s similarly annoying but safe to crash your R session. Image: <a href="http://www.thebrofessional.net/guy-builds-incredible-working-replica-dutch-f-16-military-fighter-jet-scratch/">The Brofessional</a></p>
</div>
<ul>
<li>R has uneven inbuilt help – but a lot of users who are willing to help you.</li>
</ul>
</div>
<div id="alternatives" class="section level3">
<h3>Alternatives</h3>
<p>You can prepend “Some say, ..” to these statements:</p>
<ul>
<li>MS Excel might be better for inputting data into tables.</li>
<li>Graphpad Prism is much more foolproof and easier to use as a statistical tool (but has limited functionality). There is a free web version of Graphpad – <a href="http://www.graphpad.com/quickcalcs/">check it out</a>.<br />
</li>
<li>Python is more widely spread as a general purpose programming language – it is also arguably better in working with external databases (which we won’t).</li>
</ul>
</div>
</div>
<div id="install-r" class="section level2">
<h2>Install R</h2>
<p>As you can guess, it’s very straightforward: download and install <strong>R</strong> for your operation system from <a href="https://cran.r-project.org/">https://cran.r-project.org/</a>.</p>
</div>
<div id="install-rstudio" class="section level2">
<h2>Install RStudio</h2>
<blockquote>
<p>RStudio is a set of integrated tools designed to help you be more productive with R. It includes a console, syntax-highlighting editor that supports direct code execution, as well as tools for plotting, history, debugging and workspace management.</p>
</blockquote>
<p>Download and install <strong>RStudio</strong> from <a href="https://www.rstudio.com/">https://www.rstudio.com/</a></p>
<div class="figure">
<img src="graphs/RStudio.png" alt="" />
<p class="caption">RStudio window layout. The panel in the upper right contains your workspace. Any plots that you generate will show up in the panel in the lower right corner. The panel on the upper left corner is your source file. The panel on the lower left corner is the console.</p>
</div>
<div id="setup-your-project" class="section level3">
<h3>Setup your project</h3>
<p>To get started using R via RStudio it is suggested to organise your work to projects. Each project has their own working directory, workspace, history, and source documents. In order to create a new project:</p>
<ol style="list-style-type: decimal">
<li>Open RStudio</li>
<li>Select <code>Project</code> menu from the <strong>upper right corner</strong> and either create <code>New Project</code> or <code>Open Project</code>. <a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects">RStudio support page for using projects</a>.</li>
</ol>
<div class="figure">
<img src="graphs/RStudio_NewProject.png" alt="" />
<p class="caption">New Project menu</p>
</div>
<p>When you open a project in RStudio several actions are taken:</p>
<ul>
<li>A fresh new R session is started</li>
<li>The current working directory is set to the project directory.</li>
<li>Previously edited source documents are restored into editor tabs.</li>
<li>The <code>.Rprofile</code> file in the project’s main directory (if any) is sourced by R, also the <code>.RData</code> and <code>.Rhistory</code> files in the project’s main directory are loaded.</li>
<li>Other RStudio settings (e.g. active tabs, splitter positions, etc.) are restored to where they were the last time the project was closed.</li>
</ul>
</div>
<div id="folder-structure-of-r-project" class="section level3">
<h3>Folder structure of R project</h3>
<ul>
<li>Create a directory structure to separate R code, data, reports, and output</li>
<li><strong>Treat data as read-only</strong>: do data-munging in R code, but always start with the source data</li>
<li><strong>Consider output figures and tables as disposable</strong>: the data plus the R script is the canonical source</li>
<li><strong>Keep function definitions and applications code separately</strong></li>
</ul>
<div class="figure">
<img src="graphs/RProject_folders.png" alt="" />
<p class="caption">Example folder structure in R project</p>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>MyProject<span class="sc">/</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span><span class="sc">--</span> scripts<span class="sc">/</span> <span class="co"># contains R script</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span><span class="sc">--</span> data<span class="sc">/</span> <span class="co"># contains raw data, read only</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span><span class="sc">--</span> output<span class="sc">/</span> or results<span class="sc">/</span> <span class="co"># modified data, rendered documents/reports </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span><span class="sc">--</span> plots<span class="sc">/</span>, graphs<span class="sc">/</span> or figures<span class="sc">/</span> <span class="co"># output graphs</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span><span class="sc">--</span> report.Rmd <span class="co"># expected to be in project root</span></span></code></pre></div>
<p>Where am I?</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>() <span class="co"># shows active working directory.</span></span></code></pre></div>
<p>Using <strong>R projects</strong> together with <strong>here</strong> <a href="https://here.r-lib.org" class="uri">https://here.r-lib.org</a> package in your scripts makes <code>getwd()</code> and <code>setwd()</code> useless.</p>
<blockquote>
<p>There is a blue cube button in files tab in RStudio that directs you back to your project folder.</p>
</blockquote>
</div>
<div id="getting-help" class="section level3">
<h3>Getting help</h3>
<p>You can get help for individual functions from R Documentation at the program’s command prompt by preceding R command with ?.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>?<span class="fu">getwd</span>()</span></code></pre></div>
<p>Package documentation with list of all included functions can be accessed like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="at">help =</span> <span class="st">&quot;readxl&quot;</span>)</span></code></pre></div>
<p>In RStudio if you type the name of the function without parentheses eg. <code>scale</code> and hit the <code>F1</code> key, the help page of the function is shown in the lower right panel.</p>
</div>
<div id="tips-and-tricks" class="section level3">
<h3>Tips and tricks</h3>
<ul>
<li>RStudio: <code>Help</code> menu contains section <code>Cheatsheets</code>.</li>
<li><code>Ctrl + Enter</code> (<code>Cmd + Enter</code> on a Mac) in RStudio: sends the current line (or current selection) from the editor to the console and runs it.</li>
<li><code>Alt + -</code> in RStudio: gives assignment operator <code>&lt;-</code>.</li>
<li><code>Ctrl + Shift + M</code> (Shift + Cmd + M on a Mac) in RStudio: gives piping operator <code>%&gt;%</code>.</li>
<li><code>Ctrl + Shift + C</code> (Ctrl + Cmd + C on a Mac) in RStudio: comment/uncomment lines.</li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf">RStudio cheat sheet with more tips</a>.</li>
<li>R is case-sensitive.</li>
<li>Enter commands one at a time at the console or run a set of commands from the editor.</li>
<li>Object names and column names cannot begin with a number.</li>
<li>No spaces in object names! (use <code>.</code> or <code>_</code> or <code>-</code>).</li>
<li>Using the backslash <code>\</code> in a pathname on Windows – R sees the <code>\</code> as an escape character. <code>setwd("C:\mydata")</code> generates an error. Use <code>setwd("C:/mydata")</code> or <code>setwd("C:\\mydata")</code> instead.</li>
</ul>
</div>
</div>
<div id="installing-packages" class="section level2">
<h2>Installing packages</h2>
<p>To install package, run following command in your R console:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;packagename&quot;</span>) <span class="co"># eg use &quot;ggplot2&quot; as packagename</span></span></code></pre></div>
<p>RStudio offers also point-and-click style package install option: <img src="graphs/RStudio_package.install.png" alt="Install packages via RStudio GUI" /></p>
<p>You will not be able to use a package until you load it with the <code>library()</code> function. After you have installed the packages, you can load any of the packages into your current R session with the <code>library()</code> command, e.g. </p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load library/package tidyr</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code></pre></div>
<p>The <code>library(tidyr)</code> command makes available all the funtions in the tidyr package.</p>
<blockquote>
<p>R packages are collections of one or more functions with clearly specifed task.</p>
</blockquote>
<p>For example, the tidyr package contains following 77 functions:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(<span class="st">&quot;package:tidyr&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;%&gt;%&quot;               &quot;as_tibble&quot;         &quot;billboard&quot;        
##  [4] &quot;build_longer_spec&quot; &quot;build_wider_spec&quot;  &quot;chop&quot;             
##  [7] &quot;complete&quot;          &quot;complete_&quot;         &quot;construction&quot;     
## [10] &quot;contains&quot;          &quot;crossing&quot;          &quot;crossing_&quot;        
## [13] &quot;drop_na&quot;           &quot;drop_na_&quot;          &quot;ends_with&quot;        
## [16] &quot;everything&quot;        &quot;expand&quot;            &quot;expand_&quot;          
## [19] &quot;expand_grid&quot;       &quot;extract&quot;           &quot;extract_&quot;         
## [22] &quot;extract_numeric&quot;   &quot;fill&quot;              &quot;fill_&quot;            
## [25] &quot;fish_encounters&quot;   &quot;full_seq&quot;          &quot;gather&quot;           
## [28] &quot;gather_&quot;           &quot;hoist&quot;             &quot;last_col&quot;         
## [31] &quot;matches&quot;           &quot;nest&quot;              &quot;nest_&quot;            
## [34] &quot;nest_legacy&quot;       &quot;nesting&quot;           &quot;nesting_&quot;         
## [37] &quot;num_range&quot;         &quot;one_of&quot;            &quot;pack&quot;             
## [40] &quot;pivot_longer&quot;      &quot;pivot_longer_spec&quot; &quot;pivot_wider&quot;      
## [43] &quot;pivot_wider_spec&quot;  &quot;population&quot;        &quot;relig_income&quot;     
## [46] &quot;replace_na&quot;        &quot;separate&quot;          &quot;separate_&quot;        
## [49] &quot;separate_rows&quot;     &quot;separate_rows_&quot;    &quot;smiths&quot;           
## [52] &quot;spread&quot;            &quot;spread_&quot;           &quot;starts_with&quot;      
## [55] &quot;table1&quot;            &quot;table2&quot;            &quot;table3&quot;           
## [58] &quot;table4a&quot;           &quot;table4b&quot;           &quot;table5&quot;           
## [61] &quot;tibble&quot;            &quot;tidyr_legacy&quot;      &quot;tribble&quot;          
## [64] &quot;unchop&quot;            &quot;uncount&quot;           &quot;unite&quot;            
## [67] &quot;unite_&quot;            &quot;unnest&quot;            &quot;unnest_&quot;          
## [70] &quot;unnest_auto&quot;       &quot;unnest_legacy&quot;     &quot;unnest_longer&quot;    
## [73] &quot;unnest_wider&quot;      &quot;unpack&quot;            &quot;us_rent_income&quot;   
## [76] &quot;who&quot;               &quot;world_bank_pop&quot;</code></pre>
</div>
<div id="r-repositories" class="section level2">
<h2>R repositories</h2>
<p>R packages are available from 3 major repositories:</p>
<ol style="list-style-type: decimal">
<li><strong>CRAN</strong></li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Bioconductor</strong> <a href="https://www.bioconductor.org/">https://www.bioconductor.org/</a></li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First run biocLite script fron bioconductor.org</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://bioconductor.org/biocLite.R&quot;</span>)  </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use &#39;http&#39; in url if &#39;https&#39; is unavailable. </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">biocLite</span>(<span class="st">&quot;GenomicRanges&quot;</span>, <span class="at">suppressUpdates=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><strong>GitHub</strong> <a href="https://github.com/">https://github.com/</a></li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">&quot;ramnathv/slidify&quot;</span>) <span class="co"># ramnathv is the user, slidify the package.</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or alternatively, should we want only to install the missing package while avoiding any side effects that might result from loading the entire package, we use: </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;ramnathv/slidify&quot;</span>)</span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;githubinstall&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(githubinstall)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">githubinstall</span>(<span class="st">&quot;AnomalyDetection&quot;</span>)</span></code></pre></div>
<p>also</p>
<ol start="4" style="list-style-type: decimal">
<li><code>library(remotes)</code>: functions to install R packages from GitHub, Bitbucket, git, svn repositories, URL-s (also devtools package has functions to install packages from these resources).</li>
</ol>
<blockquote>
<p>NB! As we want to add extra data munging power to the base R, in our course, every R session should start with loading these packages:</p>
</blockquote>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span></code></pre></div>
<div id="common-mistakes-in-loading-packages" class="section level3">
<h3>Common mistakes in loading packages</h3>
<ul>
<li>Using the wrong case: help(), Help(), and HELP() - only the first will work.</li>
<li>Forgetting quotation marks – <code>install.packages("gclus")</code> works.</li>
<li>Using a function from a package that’s not loaded: library(“foo”)</li>
<li>Forgetting to include the parentheses in a function call. For example <code>help()</code> works, but <code>help</code> doesn’t.</li>
</ul>
<blockquote>
<p>Entering function name without parentheses returns function internals. Very useful!</p>
</blockquote>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ruut  <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span> <span class="co"># lets define function</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ruut <span class="co"># display function internals</span></span></code></pre></div>
<pre><code>## function(x) x^2</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ruut</span>(<span class="dv">3</span>) <span class="co"># run function</span></span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<!-- Even if there are no **function arguments**, you still need the `()` appended to function name to execute function. -->
<!-- ```{r} -->
<!-- twoplustwo <- function() 2+2 # here we define our function -->
<!-- twoplustwo # lets see whats in it -->
<!-- twoplustwo() # run function -->
<!-- ``` -->
</div>
</div>
</div>
<div id="r-objects" class="section level1">
<h1>R objects</h1>
<p>An R object is anything that can be assigned a value (data, functions, graphs, analytic results, and more). Every object has a class attribute telling R how to handle it. Common R data structures are: vectors (numerical, character, logical), matrices, data frames, and lists. The basic data structure in R is the vector.</p>
<div id="class-of-object" class="section level3">
<h3>Class of object</h3>
<p>An R vector is characterized by a mode that describes its contents: logical, numeric, complex, character.</p>
<p>An R data structure is characterized by a class that describes its structure: matrix, array, factor, time-series, data frame, and list.</p>
<p>To determine the class of your object use <code>class(object)</code> - prints the class attribute of an object.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>myobject <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>,<span class="st">&quot;a&quot;</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(myobject) <span class="co"># gives the data structure of object &#39;myobject&#39;</span></span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
</div>
<div id="r-expressions" class="section level3">
<h3>R expressions</h3>
<p>Syntactically correct R expressions (<code>y &lt;- x * 10</code>) will be referred to as statements. R uses the symbol <code>&lt;-</code> for assignments, rather than the typical <code>=</code> sign.</p>
<p>Here we create a vector named <code>x</code> containing five random numbers from a standard normal distribution.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1]  1.3761634  0.2861325 -0.8516899  1.7341453 -1.7049719</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="dv">10</span> <span class="co"># here we multiply numeric vector x by 10</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>y</span></code></pre></div>
<pre><code>## [1]  13.761634   2.861325  -8.516899  17.341453 -17.049719</code></pre>
</div>
<div id="assigning-value-to-object" class="section level3">
<h3>Assigning value to object</h3>
<p><code>a</code> is an object containing character “b”:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="st">&quot;b&quot;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<pre><code>## [1] &quot;b&quot;</code></pre>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
In <a href="https://twitter.com/hashtag/rstats?src=hash">#rstats</a>, it's surprisingly important to realise that names have objects; objects don't have names <a href="https://t.co/bEMO1YVZX0">pic.twitter.com/bEMO1YVZX0</a>
</p>
— Hadley Wickham (<span class="citation">@hadleywickham</span>) <a href="https://twitter.com/hadleywickham/status/732288980549390336">May 16, 2016</a>
</blockquote>
<p>You can overwrite objects (assign a new value to it):</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;poodle&quot;</span>,<span class="st">&quot;sheltie&quot;</span>) <span class="co"># c(1,2) is a vector </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>a <span class="co"># a now contains two values: &quot;poodle&quot; and &quot;sheltie&quot;</span></span></code></pre></div>
<pre><code>## [1] &quot;poodle&quot;  &quot;sheltie&quot;</code></pre>
<div class="figure">
<img src="http://www.dailytorygraph.com/wp-content/uploads/2016/03/IMG_2139-700x525.jpg" alt="" />
<p class="caption">Poodle as innocent victim of overwriting <span class="citation">@daily</span> torygraph.</p>
</div>
<p>You can copy objects under new name:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> a</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>b</span></code></pre></div>
<pre><code>## [1] &quot;poodle&quot;  &quot;sheltie&quot;</code></pre>
<p>You can use output of <code>function 1</code> as input to <code>function 2</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">4</span> <span class="co"># function 1</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">foo</span>(<span class="at">x =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">foo</span>(<span class="dv">2</span>)) <span class="co"># function &#39;sqrt&#39; calculates square root</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<blockquote>
<p>Never use a function name as object name – <code>c</code> vs. <code>c()</code>. You rewrite that function in your environment and you get into trouble!</p>
</blockquote>
</div>
<div id="coercing" class="section level3">
<h3>Coercing</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="st">&quot;42&quot;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<pre><code>## [1] &quot;42&quot;</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(a)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>b</span></code></pre></div>
<pre><code>## [1] 42</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(b)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(a)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>b</span></code></pre></div>
<pre><code>## [1] 42
## Levels: 42</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(b)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<p>To coerce the factor <code>ss</code> with two levels <code>10</code> and <code>20</code> into numbers you must convert it to character first:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>ss</span></code></pre></div>
<pre><code>## [1] 10 20
## Levels: 10 20</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lets see what happens if we try to convert ss directly to numeric</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(ss)</span></code></pre></div>
<pre><code>## [1] 1 2</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(ss))</span></code></pre></div>
<pre><code>## [1] 10 20</code></pre>
<p>Factor variables are encoded as integers in their underlying representation. So a variable like “poodle” and “sheltie” will be encoded as 1 and 2 in the underlying representation <a href="http://simplystatistics.org/2015/07/24/stringsasfactors-an-unauthorized-biography/">more about factors and stringsAsFactors option when importing a data.frame</a>.</p>
<p>Factors are used to group data by their levels for analysis (e.g. linear model: <code>lm()</code>) &amp; graphing. In earlier versions of R, storing character data as a factor was more space efficient if there is even a small proportion of repeats. However, identical character strings now share storage, so the difference is small in most cases. Nominal variables are categorical, without an implied order.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>diabetes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Type1&quot;</span>, <span class="st">&quot;Type2&quot;</span>, <span class="st">&quot;Type1&quot;</span>, <span class="st">&quot;Type1&quot;</span>) <span class="co"># diabetes is a factor with 2 levels</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>diabetes <span class="co"># a character vector</span></span></code></pre></div>
<pre><code>## [1] &quot;Type1&quot; &quot;Type2&quot; &quot;Type1&quot; &quot;Type1&quot;</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(diabetes)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>diabetes <span class="ot">&lt;-</span> <span class="fu">factor</span>(diabetes) <span class="co"># coerce to factor</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>diabetes <span class="co"># factors</span></span></code></pre></div>
<pre><code>## [1] Type1 Type2 Type1 Type1
## Levels: Type1 Type2</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(diabetes)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<p>Encoding <code>diabetes</code> vector as a factor stores this vector as 1, 2, 1, 1 and associates it with 1 = Type1 and 2 = Type2 internally (the assignment is alphabetical). Any analyses performed on the vector diabetes will treat the variable as nominal and select the statistical methods appropriate for this level of measurement.</p>
<p>Ordinal variables imply order but not amount. <code>Status (poor, improved, excellent)</code>. For vectors representing ordinal variables, add <code>ordered = TRUE</code> to the <code>factor()</code> function.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>status <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Poor&quot;</span>, <span class="st">&quot;Improved&quot;</span>, <span class="st">&quot;Excellent&quot;</span>, <span class="st">&quot;Poor&quot;</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>status</span></code></pre></div>
<pre><code>## [1] &quot;Poor&quot;      &quot;Improved&quot;  &quot;Excellent&quot; &quot;Poor&quot;</code></pre>
<p>For ordered factors, override the alphabetic default by specifying levels.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>status <span class="ot">&lt;-</span> <span class="fu">factor</span>(status, <span class="at">ordered =</span> <span class="cn">TRUE</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Poor&quot;</span>, <span class="st">&quot;Improved&quot;</span>, <span class="st">&quot;Excellent&quot;</span>)) <span class="co"># Assigns the levels as 1 = Poor, 2 = Improved, 3 = Excellent. </span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>status</span></code></pre></div>
<pre><code>## [1] Poor      Improved  Excellent Poor     
## Levels: Poor &lt; Improved &lt; Excellent</code></pre>
<p>Continuous variables have order &amp; amount (<code>class: numeric or integer</code>). Numeric variables can be re-coded as factors. If sex was coded as 1 for male and 2 for female in the original data,</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dv">21</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co"># lets generate data</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>sex</span></code></pre></div>
<pre><code>##  [1] 1 2 1 2 1 2 1 1 2 1 1 1 2 1 2 2 2 2 2 1 1</code></pre>
<p>then, <code>factor()</code> converts the variable to an unordered factor.<br />
The order of the labels must match the order of the levels. Sex would be treated as categorical, the labels “Male” and “Female” would appear in the output instead of 1 and 2</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>sex</span></code></pre></div>
<pre><code>##  [1] Male   Female Male   Female Male   Female Male   Male   Female Male  
## [11] Male   Male   Female Male   Female Female Female Female Female Male  
## [21] Male  
## Levels: Male Female</code></pre>
</div>
</div>
<div id="data-structures" class="section level1">
<h1>Data structures</h1>
<ul>
<li><strong>Atomic vectors</strong> are arrays that contain a single data type (logical, real, complex, character). Each of the following is a one-dimensional atomic vector:</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>passed <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>) <span class="co"># random sequence</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(passed)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">53</span>, <span class="dv">51</span>, <span class="dv">25</span>, <span class="dv">67</span>, <span class="dv">66</span>, <span class="dv">41</span>, <span class="dv">62</span>, <span class="dv">42</span>) <span class="co"># random numbers</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(ages)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>namez <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Marina&quot;</span>, <span class="st">&quot;Allar&quot;</span>, <span class="st">&quot;Siim&quot;</span>, <span class="st">&quot;Mart&quot;</span>, <span class="st">&quot;Mailis&quot;</span>, <span class="st">&quot;Eiki&quot;</span>, <span class="st">&quot;Urmas&quot;</span>) <span class="co"># random names, names is R function!</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(namez)  </span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>A scalar is an atomic vector with a single element. So <code>k &lt;- 2</code> is a shortcut for <code>k &lt;- c(2)</code>.</p>
<ul>
<li>A <strong>matrix</strong> is an atomic vector that has a dimension attribute, <code>dim()</code>, containing two elements (<code>nrow</code>, number of rows and <code>ncol</code>, number of columns)</li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(ages, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   53   25   66   62
## [2,]   51   67   41   42</code></pre>
<ul>
<li><strong>Lists</strong> are collections of atomic vectors and/or other lists.</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>mylist <span class="ot">&lt;-</span> <span class="fu">list</span>(passed, ages, namez)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>mylist</span></code></pre></div>
<pre><code>## [[1]]
## [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE
## 
## [[2]]
## [1] 53 51 25 67 66 41 62 42
## 
## [[3]]
## [1] &quot;Marina&quot; &quot;Allar&quot;  &quot;Siim&quot;   &quot;Mart&quot;   &quot;Mailis&quot; &quot;Eiki&quot;   &quot;Urmas&quot;</code></pre>
<p>We can assign names to list objects:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mylist) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;passed&quot;</span>, <span class="st">&quot;ages&quot;</span>, <span class="st">&quot;namez&quot;</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>mylist</span></code></pre></div>
<pre><code>## $passed
## [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE
## 
## $ages
## [1] 53 51 25 67 66 41 62 42
## 
## $namez
## [1] &quot;Marina&quot; &quot;Allar&quot;  &quot;Siim&quot;   &quot;Mart&quot;   &quot;Mailis&quot; &quot;Eiki&quot;   &quot;Urmas&quot;</code></pre>
<ul>
<li><strong>Data frames</strong> are a special type of list, where each atomic vector in the collection has the same length. Each vector represents a column (variable) in the data frame.</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>exam <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> namez, <span class="at">passed =</span> passed)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>exam</span></code></pre></div>
<pre><code>##     name passed
## 1 Marina   TRUE
## 2  Allar  FALSE
## 3   Siim  FALSE
## 4   Mart  FALSE
## 5 Mailis   TRUE
## 6   Eiki   TRUE
## 7  Urmas   TRUE</code></pre>
<div class="figure">
<img src="https://raw.githubusercontent.com/Anonymous-Y/BlogImage/master/r-intro-3.jpg" alt="" />
<p class="caption">Illustration of R data types. Image: <a href="http://yzc.me/2015/12/11/r-intro-1/">http://yzc.me/2015/12/11/r-intro-1/</a></p>
</div>
</div>
<div id="selecting-by-index" class="section level1">
<h1>Selecting by index</h1>
<p>Index gives the address that specifies the elements of vector/matrix/list or data.frame, which are then automatically selected.</p>
<ul>
<li>Indexing begins at 1 (not 0) in R</li>
<li>Indexing operators in R are square brackets – ‘[’, <code>[[</code> and dollar sign <code>$</code><br />
</li>
<li><code>[</code> allows selecting more than one element, whereas <code>[[</code> and <code>$</code> select only one element.</li>
<li>Empty index [,] means “select all” – <code>a[,1]</code> means “select all rows and 1st column from <code>a</code>”.</li>
</ul>
<!-- ```{r} -->
<!-- '['(c(1,2,3), 1) == c(1,2,3)[1] # as you can see these are both identical -->
<!-- ``` -->
<!-- + you can select values, rows or columns by index -->
<!-- + `-` (minus) before index means "not this element" -->
<!-- + ! means "not" -->
<!-- + != means "not equal" -->
<!-- + == means "equal" -->
<p>During initial data exploration it is often necessary to have a look how the head of your table looks like, for this you can use convenience methods <code>head</code> and <code>tail</code> which are returning first and last elements of a object, respectively:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtcars) <span class="co"># Prints first 6 elements (rows) as default</span></span></code></pre></div>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(mtcars, <span class="at">n =</span> <span class="dv">3</span>) <span class="co"># Prints last 3 elements (rows)</span></span></code></pre></div>
<pre><code>##                mpg cyl disp  hp drat   wt qsec vs am gear carb
## Ferrari Dino  19.7   6  145 175 3.62 2.77 15.5  0  1    5    6
## Maserati Bora 15.0   8  301 335 3.54 3.57 14.6  0  1    5    8
## Volvo 142E    21.4   4  121 109 4.11 2.78 18.6  1  1    4    2</code></pre>
<p>Tip: you can use <code>tail</code> to return the very last element of a object with unknown length.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(LETTERS, <span class="at">n =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Z&quot;</code></pre>
</div>
<div id="vectors" class="section level1">
<h1>Vectors</h1>
<p>The combine function <code>c()</code> is used to form the vector.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">6</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span>,<span class="cn">FALSE</span>) <span class="co"># We use d instead of c as vector name. Why?</span></span></code></pre></div>
<p><code>a</code> is a numeric vector, <code>b</code> is a character vector, and <code>d</code> is a logical vector. The data in a vector can be only one type (numeric, character, or logical).</p>
<p>You can refer to elements of a vector:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>a[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)] <span class="co"># Refers to the second and fourth elements of vector a.</span></span></code></pre></div>
<pre><code>## [1]  2 -3</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;[&#39;</span>(a, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)) <span class="co"># [ is a function! This is very handy in case of piping, as we see in the upcoming lessons.</span></span></code></pre></div>
<pre><code>## [1]  2 -3</code></pre>
<p>We can sort/order vector:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(a, <span class="at">decreasing =</span> <span class="cn">FALSE</span>) <span class="co"># sorts vector in ascending order</span></span></code></pre></div>
<pre><code>## [1] -3 -2  1  2  4  5  6</code></pre>
<p>We can extract uniqe elements of a vector:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(d) <span class="co"># Returns a vector, data frame or array like d but with duplicate elements removed.</span></span></code></pre></div>
<pre><code>## [1]  TRUE FALSE</code></pre>
<p>Create sequence:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 2.0 2.5 3.0 3.5 4.0 4.5 5.0</code></pre>
<p>A complex sequence:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">times =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 1 2 3 4</code></pre>
<p>Repeat each element of a vector:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 1 1 1 2 2 2</code></pre>
<p>Repeat elements of a vector:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;poodle&quot;</span>,<span class="st">&quot;sheltie&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>, <span class="at">times =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;poodle&quot;  &quot;poodle&quot;  &quot;poodle&quot;  &quot;sheltie&quot; &quot;sheltie&quot; &quot;sheltie&quot; &quot;poodle&quot; 
##  [8] &quot;poodle&quot;  &quot;poodle&quot;  &quot;sheltie&quot; &quot;sheltie&quot; &quot;sheltie&quot;</code></pre>
</div>
<div id="data-frame" class="section level1">
<h1>Data frame</h1>
<ul>
<li><p><code>data frame</code>: a collection of vectors where different columns can contain different modes of data (numeric, character, and so on). Each vector contains only 1 mode of data (<code>vector1 &lt;- c("a", 2, 3.4)</code> is automatically coerced to <code>chr</code>, but can be manually coerced to numeric or factor). The data frame columns are variables, and the rows are observations. Vectors are bound into matrix/data.frame vertically, with the direction from top to bottom. Column = vector. <code>as.matrix()</code> has default argument <code>byrow = FALSE</code>, change this to fill matrix by rows.</p></li>
<li><p><code>tibble::data_frame()</code> is a more modern version of data.frame (slight differences for the better) <code>as_data_frame()</code> converts to it. <code>data_frame()</code> does less than <code>data.frame()</code>:</p>
<ul>
<li>it never changes the type of the inputs (e.g. it never converts strings to factors!),</li>
<li>it never changes the names of variables, and it never creates <code>row.names()</code>.</li>
</ul></li>
</ul>
<p><strong>Tibbles</strong> have a print method that shows only the first 10 rows, and all the columns that fit on screen. This makes it much easier to work with large data. <!-- In addition to its name, each column reports its type.  --> <!-- Tibbles clearly delineate `[` and `[[`: `[` always returns another tibble, `[[` always returns a vector.  --> <!-- Some older functions don't work with tibbles because they expect `df[, 1]` to return a vector, not a data frame.  --> <!-- If you encounter one of these functions, use `as.data.frame()` to coerce a tibble back to a data frame: --></p>
<div class="figure">
<img src="http://articles.concreteinteractive.com/wp-content/uploads/2015/03/irises.png" alt="" />
<p class="caption">Iris dataset contains sepal and petal measurements of three iris species.</p>
</div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># tbl_df </span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_df</span>(iris)</span></code></pre></div>
<pre><code>## # A tibble: 150 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
##  1          5.1         3.5          1.4         0.2 setosa 
##  2          4.9         3            1.4         0.2 setosa 
##  3          4.7         3.2          1.3         0.2 setosa 
##  4          4.6         3.1          1.5         0.2 setosa 
##  5          5           3.6          1.4         0.2 setosa 
##  6          5.4         3.9          1.7         0.4 setosa 
##  7          4.6         3.4          1.4         0.3 setosa 
##  8          5           3.4          1.5         0.2 setosa 
##  9          4.4         2.9          1.4         0.2 setosa 
## 10          4.9         3.1          1.5         0.1 setosa 
## # … with 140 more rows</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">as.data.frame</span>(<span class="fu">tbl_df</span>(iris)))</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">187</span>, <span class="dv">190</span>, <span class="dv">156</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Jim&quot;</span>, <span class="st">&quot;Joe&quot;</span>, <span class="st">&quot;Jill&quot;</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>my_tab <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(name, height) <span class="co"># object names are used as column names</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>my_tab</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  height
##   &lt;chr&gt;  &lt;dbl&gt;
## 1 Jim      187
## 2 Joe      190
## 3 Jill     156</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(my_tab) <span class="co"># Prints a summary of data</span></span></code></pre></div>
<pre><code>##      name               height     
##  Length:3           Min.   :156.0  
##  Class :character   1st Qu.:171.5  
##  Mode  :character   Median :187.0  
##                     Mean   :177.7  
##                     3rd Qu.:188.5  
##                     Max.   :190.0</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(my_tab) <span class="co"># Prints column names</span></span></code></pre></div>
<pre><code>## [1] &quot;name&quot;   &quot;height&quot;</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(my_tab) <span class="co"># number of rows</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(my_tab)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(my_tab)</span></code></pre></div>
<pre><code>## [1] 3 2</code></pre>
<div id="indexing-data.frames" class="section level2">
<h2>Indexing data.frames</h2>
<!-- Data frames can be indexed in several modes. When [ and [[ are used with a single vector index (x[i] or x[[i]]), they index the data frame as if it were a list. -->
<p>We use R <code>mtcars</code> dataset to illustrate indexing of a data.frame:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mtcars)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mtcars) <span class="co"># what&#39;s the size of the data.frame</span></span></code></pre></div>
<pre><code>## [1] 32 11</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>mtc <span class="ot">&lt;-</span> mtcars[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), <span class="dv">6</span>), ] <span class="co"># select a manageable subset</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>mtc</span></code></pre></div>
<pre><code>##                    mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Chrysler Imperial 14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Volvo 142E        21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
## Merc 450SLC       15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Fiat 128          32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Ferrari Dino      19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## AMC Javelin       15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2</code></pre>
<p>Here we select columns:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>mtc[,<span class="dv">2</span>] <span class="co"># selects 2nd column and returns vector</span></span></code></pre></div>
<pre><code>## [1] 8 4 8 4 6 8</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>mtc[<span class="dv">3</span>] <span class="co"># selects 3nd column and returns data.frame</span></span></code></pre></div>
<pre><code>##                    disp
## Chrysler Imperial 440.0
## Volvo 142E        121.0
## Merc 450SLC       275.8
## Fiat 128           78.7
## Ferrari Dino      145.0
## AMC Javelin       304.0</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>mtc[, <span class="st">&quot;hp&quot;</span>] <span class="co"># selects column named &quot;hp&quot;</span></span></code></pre></div>
<pre><code>## [1] 230 109 180  66 175 150</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>mtc<span class="sc">$</span>cyl <span class="co"># selects column named &quot;cyl&quot;</span></span></code></pre></div>
<pre><code>## [1] 8 4 8 4 6 8</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">M =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">34</span>), <span class="at">N =</span> <span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">3</span>), <span class="at">L =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##    M  N     L
## 1  2 34  TRUE
## 2  3  3 FALSE
## 3  6  8  TRUE
## 4  3  3 FALSE
## 5 34  3  TRUE</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>M <span class="sc">==</span> <span class="dv">34</span>,] <span class="co"># selects rows from A that have value == 34</span></span></code></pre></div>
<pre><code>##    M N    L
## 5 34 3 TRUE</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;N&quot;</span>] <span class="co"># selects rows 1 through 2 from column &quot;A&quot;</span></span></code></pre></div>
<pre><code>## [1] 34  3</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(df) <span class="ot">&lt;-</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] <span class="co"># letters vector gives us lower case letters</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">rownames</span>(df) <span class="sc">==</span> <span class="st">&quot;c&quot;</span>,] <span class="co"># selects row named &quot;c&quot;</span></span></code></pre></div>
<pre><code>##   M N    L
## c 6 8 TRUE</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>df[<span class="sc">-</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>),] <span class="co"># drops rows 2 to 4 (incl)</span></span></code></pre></div>
<pre><code>##    M  N    L
## a  2 34 TRUE
## e 34  3 TRUE</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>df[, <span class="sc">-</span><span class="dv">2</span>] <span class="co"># drops col 2, outputs vector! </span></span></code></pre></div>
<pre><code>##    M     L
## a  2  TRUE
## b  3 FALSE
## c  6  TRUE
## d  3 FALSE
## e 34  TRUE</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>M <span class="sc">==</span> <span class="dv">6</span>,] <span class="co"># selects all rows that contain 6 in column named M</span></span></code></pre></div>
<pre><code>##   M N    L
## c 6 8 TRUE</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>M <span class="sc">!=</span> <span class="dv">6</span>,] <span class="co"># selects all rows that do not contain 6 in column named M</span></span></code></pre></div>
<pre><code>##    M  N     L
## a  2 34  TRUE
## b  3  3 FALSE
## d  3  3 FALSE
## e 34  3  TRUE</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>L<span class="sc">==</span>T,] <span class="co"># selects all rows where L is TRUE (T)</span></span></code></pre></div>
<pre><code>##    M  N    L
## a  2 34 TRUE
## c  6  8 TRUE
## e 34  3 TRUE</code></pre>
<p>What if we have duplicated rows or elements in our data frame or vector (and we want to get rid of them)?</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>?duplicated <span class="co">#  determines which elements of a vector or data frame are duplicates of elements with smaller subscripts</span></span></code></pre></div>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>df[<span class="sc">!</span><span class="fu">duplicated</span>(df),] <span class="co"># removes second one of the duplicated rows from df, we have to use ! to negate logical evaluation</span></span></code></pre></div>
<pre><code>##    M  N     L
## a  2 34  TRUE
## b  3  3 FALSE
## c  6  8  TRUE
## e 34  3  TRUE</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>M <span class="sc">&gt;</span> <span class="fu">median</span>(df<span class="sc">$</span>N) <span class="sc">&amp;</span> df<span class="sc">$</span>M <span class="sc">&lt;</span> <span class="dv">25</span>,] <span class="co"># selects rows where df$M value is &gt; median df$N AND df$M value &lt; 25</span></span></code></pre></div>
<pre><code>##   M N    L
## c 6 8 TRUE</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>M <span class="sc">&gt;</span> <span class="fu">median</span>(df<span class="sc">$</span>N) <span class="sc">|</span> df<span class="sc">$</span>M <span class="sc">==</span> <span class="dv">34</span>,] <span class="co"># selects rows where df$M value is &gt; median df$N OR df$M value == 34</span></span></code></pre></div>
<pre><code>##    M N    L
## c  6 8 TRUE
## e 34 3 TRUE</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(df<span class="sc">$</span>M[df<span class="sc">$</span>L<span class="sc">==</span>T]) <span class="co"># sums column df$M at rows where column &#39;L&#39; is TRUE (T)</span></span></code></pre></div>
<pre><code>## [1] 42</code></pre>
<p>A vector can be extracted by <code>$</code> and worked on:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>Mean.height <span class="ot">&lt;-</span> <span class="fu">mean</span>(my_tab<span class="sc">$</span>height)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>Mean.height <span class="co"># Prints the answer</span></span></code></pre></div>
<pre><code>## [1] 177.6667</code></pre>
<p>New vectors can be bound into a data.frame:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>my_tab<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">87</span>, <span class="dv">96</span>, <span class="dv">69</span>) <span class="co"># Now there are 3 columns in my_tab</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>my_tab</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   name  height weight
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 Jim      187     87
## 2 Joe      190     96
## 3 Jill     156     69</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>my_tab<span class="sc">$</span>experiment <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="st">&quot;A&quot;</span>) <span class="co"># the 4th col contains a factor with a single level &quot;A&quot;</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(my_tab<span class="sc">$</span>experiment) <span class="co"># prints the unique levels in a factor vector</span></span></code></pre></div>
<pre><code>## [1] &quot;A&quot;</code></pre>
</div>
</div>
<div id="matrix" class="section level1">
<h1>Matrix</h1>
<p>Matrix: a collection of data elements, which are all numeric, character, or logical.</p>
<p>Why use matrix? The choice between matrix and data.frame comes up only if you have data of the same type.</p>
<ul>
<li><p>The answer depends on what you are going to do with the data in data.frame/matrix. If it is going to be passed to other functions then the expected type of the arguments of these functions determine the choice.</p></li>
<li><p>Matrices are more memory efficient:</p></li>
</ul>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(m)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(m)</span></code></pre></div>
<pre><code>## 232 bytes</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(d)</span></code></pre></div>
<pre><code>## 864 bytes</code></pre>
<ul>
<li>Matrices are a necessity if you plan to do any linear algebra-type of operations.</li>
<li>Data frames are more convenient if you frequently refer to its columns by name (via the <code>$</code> operator).</li>
<li>Data frames are also better for reporting tabular data as you can apply formatting to each column separately.</li>
</ul>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">30</span>), <span class="at">ncol =</span> <span class="dv">5</span>) </span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(n)</span></code></pre></div>
<pre><code>## [1] 6 5</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>n</span></code></pre></div>
<pre><code>##            [,1]        [,2]       [,3]       [,4]       [,5]
## [1,]  0.9625717  0.08574938  1.4015132 -0.1912197  0.8754069
## [2,] -0.3202461 -0.37379322 -1.0499794  0.3187382  1.1420646
## [3,]  1.0826235  0.32876437 -1.0656420 -0.0214719 -1.9810216
## [4,]  0.6353925 -0.17265983 -0.3996834 -1.4182507 -0.3312632
## [5,] -0.3768512  0.82532371  0.9483084  1.1160782 -0.1887763
## [6,] -1.0271560 -0.18793586  0.5508250 -0.6006577  0.8535260</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>exam <span class="co"># we created previously data.frame exam</span></span></code></pre></div>
<pre><code>##     name passed
## 1 Marina   TRUE
## 2  Allar  FALSE
## 3   Siim  FALSE
## 4   Mart  FALSE
## 5 Mailis   TRUE
## 6   Eiki   TRUE
## 7  Urmas   TRUE</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(exam)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(exam) <span class="co"># coerce data.frame with n,m dimension to a matrix with n,m dimension </span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<pre><code>##      name     passed 
## [1,] &quot;Marina&quot; &quot;TRUE&quot; 
## [2,] &quot;Allar&quot;  &quot;FALSE&quot;
## [3,] &quot;Siim&quot;   &quot;FALSE&quot;
## [4,] &quot;Mart&quot;   &quot;FALSE&quot;
## [5,] &quot;Mailis&quot; &quot;TRUE&quot; 
## [6,] &quot;Eiki&quot;   &quot;TRUE&quot; 
## [7,] &quot;Urmas&quot;  &quot;TRUE&quot;</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(m) <span class="co"># transposes a matrix</span></span></code></pre></div>
<pre><code>##        [,1]     [,2]    [,3]    [,4]    [,5]     [,6]   [,7]   
## name   &quot;Marina&quot; &quot;Allar&quot; &quot;Siim&quot;  &quot;Mart&quot;  &quot;Mailis&quot; &quot;Eiki&quot; &quot;Urmas&quot;
## passed &quot;TRUE&quot;   &quot;FALSE&quot; &quot;FALSE&quot; &quot;FALSE&quot; &quot;TRUE&quot;   &quot;TRUE&quot; &quot;TRUE&quot;</code></pre>
<!-- Transpose a data frame with 1st column as factor -->
<!-- ```{r} -->
<!-- n <- exam$name -->
<!-- df <- as.data.frame(t(exam[,-1])) -->
<!-- colnames(df) <- n -->
<!-- df -->
<!-- ``` -->
<!-- ### Indexing matrices -->
<!-- Matrices are vectors with a dimension attribute and so all the vector forms of indexing can be used with a single index.  -->
<!-- ```{r} -->
<!-- m <- matrix(1:12, nrow = 3, dimnames = list(c("a","b","d"), LETTERS[1:4])) -->
<!-- m -->
<!-- ``` -->
<!-- ```{r} -->
<!-- m[1,]                 # the first row of matrix m -->
<!-- ``` -->
<!-- ```{r} -->
<!-- m[1, , drop = FALSE]  # is a 1-row matrix -->
<!-- ``` -->
<!-- ```{r} -->
<!-- m[, c(TRUE, FALSE, FALSE, TRUE)] # logical indexing -->
<!-- ``` -->
<!-- ```{r} -->
<!-- m[cbind(c(1,2,1), 3:1)] # matrix numeric index -->
<!-- ``` -->
<!-- ```{r} -->
<!-- ci <- cbind(c("a", "b", "a"), c("A", "C", "B")) -->
<!-- m[ci]                 # matrix character index -->
<!-- ``` -->
<!-- ```{r} -->
<!-- m[,-1]           # delete the first column of m -->
<!-- ``` -->
</div>
<div id="list" class="section level1">
<h1>List</h1>
<p>A list is an ordered collection of objects. Basically, in R you can shove any data structure into list. E.g. list may contain a combination of vectors, matrices, data frames, and even other lists, (poodles?). You can specify elements of the list by:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>mylist[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] 53 51 25 67 66 41 62 42</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>mylist[[<span class="st">&quot;ages&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 53 51 25 67 66 41 62 42</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>mylist<span class="sc">$</span>ages</span></code></pre></div>
<pre><code>## [1] 53 51 25 67 66 41 62 42</code></pre>
<p>As you can see all these above expressions give identical result</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(mylist[[<span class="dv">2</span>]], mylist[[<span class="st">&quot;ages&quot;</span>]], mylist<span class="sc">$</span>ages)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div id="indexing-lists" class="section level2">
<h2>Indexing lists</h2>
<p>Indexing by <code>[</code> is similar to atomic vectors and selects a list of the specified element(s). Both <code>[[</code> and <code>$</code> select a single element of the list (e.g. a single vector or data frame).</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>mylist <span class="co"># here we go back to our mylist object</span></span></code></pre></div>
<pre><code>## $passed
## [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE
## 
## $ages
## [1] 53 51 25 67 66 41 62 42
## 
## $namez
## [1] &quot;Marina&quot; &quot;Allar&quot;  &quot;Siim&quot;   &quot;Mart&quot;   &quot;Mailis&quot; &quot;Eiki&quot;   &quot;Urmas&quot;</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>mylist[[<span class="dv">1</span>]]               <span class="co"># the first element of list mylist</span></span></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>mylist[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)]           <span class="co"># a list containing elements 1 and 3 of mylist</span></span></code></pre></div>
<pre><code>## $passed
## [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE
## 
## $namez
## [1] &quot;Marina&quot; &quot;Allar&quot;  &quot;Siim&quot;   &quot;Mart&quot;   &quot;Mailis&quot; &quot;Eiki&quot;   &quot;Urmas&quot;</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>mylist<span class="sc">$</span>ages               <span class="co"># the element of mylist named ages</span></span></code></pre></div>
<pre><code>## [1] 53 51 25 67 66 41 62 42</code></pre>
<p>Difference between using <code>[</code> and <code>[[</code> for subsetting a list: Square brackets <code>[</code> return subset of list as list:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>mylist[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## $passed
## [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mylist[<span class="dv">1</span>]) <span class="co"># returns list with one object</span></span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>mylist[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]</span></code></pre></div>
<pre><code>## $passed
## [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE
## 
## $ages
## [1] 53 51 25 67 66 41 62 42</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mylist[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]) <span class="co"># returns list with two objects</span></span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<p>Double square brackets <code>[[</code> return single list object/value:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>mylist[[<span class="dv">1</span>]] <span class="co"># returns list object </span></span></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mylist[[<span class="dv">1</span>]]) <span class="co"># logical vector in this case</span></span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<p><strong>Warning</strong>: if you use double square brackets <code>[[</code> instead of <code>[</code> with index vector e.g. c(3,2) we get 2nd element from 3rd list object:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>mylist[[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>)]]</span></code></pre></div>
<pre><code>## [1] &quot;Allar&quot;</code></pre>
<p>Be careful, if you won’t get <code>Error in ... : subscript out of bounds</code>, your script proceeds with this value and returns error in some of the next lines or returns wrong result.</p>
<!-- ### Recursive indexing into lists -->
<!-- ```{r} -->
<!-- z <- list(a = list(x = 9, y = "chello"), b = 1:5) # we create list named 'a' inside list 'z' -->
<!-- z -->
<!-- ``` -->
<!-- ```{r} -->
<!-- unlist(z) # look what happens if we simplify this list into vector... -->
<!-- ``` -->
<!-- ```{r} -->
<!-- z$a$x # what's a$x in list z -->
<!-- ``` -->
<!-- ```{r} -->
<!-- z[[c(1, 2)]] # we get second element of 1st element of list z -->
<!-- ``` -->
<!-- ```{r} -->
<!-- z[[c("a", "x")]] <- "piano" # here we replace z$a$x with "piano" -->
<!-- z -->
<!-- ``` -->
<p>Query names of list objects:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mylist)</span></code></pre></div>
<pre><code>## [1] &quot;passed&quot; &quot;ages&quot;   &quot;namez&quot;</code></pre>
<p>Set/change names of list objects:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mylist) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>)</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mylist)</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<p>New name for nth list object:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mylist)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;poodles&quot;</span>)</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mylist)</span></code></pre></div>
<pre><code>## [1] &quot;a&quot;       &quot;poodles&quot; &quot;c&quot;</code></pre>
</div>
<div id="output-from-statistical-tests" class="section level2">
<h2>Output from statistical tests</h2>
<p>Output of statistical tests in R is usually a list. Here we perform t test to compare two vectors a and b.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>) <span class="co"># random normal vector with mean 0</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>,<span class="dv">2</span>) <span class="co"># random normal vector with mean 2</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>t.result <span class="ot">&lt;-</span> <span class="fu">t.test</span>(a, b) <span class="co"># t test</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(t.result) <span class="co"># str() displays the internal structure of an R object</span></span></code></pre></div>
<pre><code>## List of 10
##  $ statistic  : Named num -3.45
##   ..- attr(*, &quot;names&quot;)= chr &quot;t&quot;
##  $ parameter  : Named num 16.6
##   ..- attr(*, &quot;names&quot;)= chr &quot;df&quot;
##  $ p.value    : num 0.00317
##  $ conf.int   : num [1:2] -2.931 -0.703
##   ..- attr(*, &quot;conf.level&quot;)= num 0.95
##  $ estimate   : Named num [1:2] 0.177 1.993
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;mean of x&quot; &quot;mean of y&quot;
##  $ null.value : Named num 0
##   ..- attr(*, &quot;names&quot;)= chr &quot;difference in means&quot;
##  $ stderr     : num 0.527
##  $ alternative: chr &quot;two.sided&quot;
##  $ method     : chr &quot;Welch Two Sample t-test&quot;
##  $ data.name  : chr &quot;a and b&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;htest&quot;</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>t.result<span class="sc">$</span>conf.int <span class="co"># extracts an element from the list</span></span></code></pre></div>
<pre><code>## [1] -2.9305769 -0.7028183
## attr(,&quot;conf.level&quot;)
## [1] 0.95</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>t.result<span class="sc">$</span>p.value <span class="co"># p.value</span></span></code></pre></div>
<pre><code>## [1] 0.003168964</code></pre>
</div>
</div>
<div id="base-graphics" class="section level1">
<h1>Base graphics</h1>
<p>Some say that R base graphics is only good for <strong>quick and dirty</strong> data exploration, but not very straightforward for creating polished publication quality graphs (but you can master it if you really dive into it).</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="at">help =</span> <span class="st">&quot;graphics&quot;</span>) <span class="co"># complete list of functions</span></span></code></pre></div>
<p>Base R has extensive set of graphical parameters, which can be set or query using function <code>par</code>:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>() <span class="co"># set or look at the available graphical parameters</span></span></code></pre></div>
<div id="scatterplot" class="section level2">
<h2>Scatterplot</h2>
<p>Scatterplots can be created using <code>plot()</code>. If we use <code>plot()</code> command with only one variable, we get graph with values versus index. We can use this representation to find out where we have gross outliers in our variable.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris<span class="sc">$</span>Sepal.Length)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-84-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Even more sensible use of scatterplot is visualizing relationship between variables. Here, we explore the relationship between sepal length and width in different iris species.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris<span class="sc">$</span>Sepal.Length, iris<span class="sc">$</span>Sepal.Width)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-85-1.png" width="672" style="display: block; margin: auto;" /> Looks OK-ish. But we don’t know witch dot belongs to which of the three iris species (setosa, versicolor, virginica).</p>
<p>We can fix that with <code>col=</code> argument, where <code>iris$Species</code> column is used as the factor by whose levels to color the dots (R will automatically order factor levels in alphabetical order: setosa, versicolor, virginica). <code>palette()</code> gives you the colors and their order, and it allows you to manipulate the color palette (see <code>?palette</code>).</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris<span class="sc">$</span>Sepal.Length, iris<span class="sc">$</span>Sepal.Width, </span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> iris<span class="sc">$</span>Species, <span class="co"># dots are colored by species</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="co"># we use filled dots instead of default empty dots</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># horizontal y-axis labels</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="fu">palette</span>()</span></code></pre></div>
<pre><code>## [1] &quot;black&quot;   &quot;#DF536B&quot; &quot;#61D04F&quot; &quot;#2297E6&quot; &quot;#28E2E5&quot; &quot;#CD0BBC&quot; &quot;#F5C710&quot;
## [8] &quot;gray62&quot;</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="co"># we place legend to the top right corner of the plot</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">levels</span>(iris<span class="sc">$</span>Species), <span class="co"># species names in the legend</span></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>, <span class="co"># dot shape</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="co"># the type of box to be drawn around the legend: &quot;n&quot; no box</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="co"># new colors are added with numbers 1 to 3. This will work like using a factor.</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-86-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can plot all variable pairs into a single <strong>matrix of scatterplots</strong>:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="co"># same output can be achieved also by using just plot()</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Iris Dataset&quot;</span>,</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">pch =</span> <span class="dv">21</span>, <span class="co"># dots need to be big enough to display color</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">bg =</span> iris<span class="sc">$</span>Species) <span class="co"># color by species</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-87-1.png" width="672" style="display: block; margin: auto;" /> <!-- `bg=` arguments gives us color for dots background. We can sample colors from colors 2:4 from default `palette()`: `c( "red","green3",  "blue")[unclass(iris$Species)]`. If we just use `iris$Species` then we get colors 1:3, which are "black, #DF536B, #61D04F". --></p>
<p><strong>Matrix scatterplots can be created using the R formula interface</strong>, which allows better control over variables we want to explore. We use “Swiss Fertility and Socioeconomic Indicators (1888)” data as example.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(swiss)</span></code></pre></div>
<pre><code>##              Fertility Agriculture Examination Education Catholic
## Courtelary        80.2        17.0          15        12     9.96
## Delemont          83.1        45.1           6         9    84.84
## Franches-Mnt      92.5        39.7           5         5    93.40
## Moutier           85.8        36.5          12         7    33.77
## Neuveville        76.9        43.5          17        15     5.16
## Porrentruy        76.1        35.3           9         7    90.57
##              Infant.Mortality
## Courtelary               22.2
## Delemont                 22.2
## Franches-Mnt             20.2
## Moutier                  20.3
## Neuveville               20.6
## Porrentruy               26.6</code></pre>
<p>Here we plot matrix scatterplot using formula method from function example <code>?pairs</code>, if left hand side (dependent variable) of the formula is empty, we get all combinations of variables in the right hand side:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span> Fertility <span class="sc">+</span> Education <span class="sc">+</span> Catholic, <span class="at">data =</span> swiss,</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">subset =</span> Education <span class="sc">&lt;</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">&quot;Swiss data, Education &lt; 20&quot;</span>) <span class="co"># formula method from function example </span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-89-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Scatterplots are also ideal for visualising relationships between independent and dependent variables</strong>. We use R in-house dataset <code>CO2</code> showing carbon dioxide uptake in grass plants.</p>
<!-- We first summarise the dataset by calculating mean uptake per conc and ignore the independent variables Plant, Type, and Treatment: -->
<!-- ```{r} -->
<!-- head(CO2) #  -->
<!-- mean.uptake <- tapply(CO2$uptake, CO2$conc, mean) # we calculate mean for each conc ignoring variables Plant, Type, and Treatment. -->
<!-- CO2 <- data.frame(conc = unique(CO2$conc), uptake = mean.uptake) # we overwrite original CO2 dataset -->
<!-- ``` -->
<p>We plot plant CO<sub>2</sub> uptake versus its concentration and add calculated linear model fit to the scatterplot:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> CO2<span class="sc">$</span>conc, <span class="at">y =</span> CO2<span class="sc">$</span>uptake, <span class="co"># </span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="co"># dot type and color</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Carbon Dioxide Uptake in Grass Plants&quot;</span>, <span class="co"># scatterplot</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># horizontal y-axis labels</span></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(uptake<span class="sc">~</span>conc, <span class="at">data =</span> CO2) <span class="co"># linear model fit</span></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod1, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># add lin model fit to the scatterplot</span></span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod1) <span class="co"># linear model coefficients</span></span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">round</span>(coefs[<span class="dv">1</span>], <span class="dv">2</span>) <span class="co"># round for printing</span></span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">round</span>(coefs[<span class="dv">2</span>], <span class="dv">2</span>) <span class="co"># round for printing</span></span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">summary</span>(mod1)<span class="sc">$</span>r.squared, <span class="dv">2</span>) <span class="co"># r squared</span></span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a>eqn <span class="ot">&lt;-</span> <span class="fu">bquote</span>(<span class="fu">italic</span>(y) <span class="sc">==</span> .(b0) <span class="sc">+</span> .(b1)<span class="sc">*</span><span class="fu">italic</span>(x) <span class="sc">*</span> <span class="st">&quot;,&quot;</span> <span class="sc">~</span><span class="er">~</span> r<span class="sc">^</span><span class="dv">2</span> <span class="sc">==</span> .(r2)) <span class="co"># formula and rsuared for printing</span></span>
<span id="cb239-13"><a href="#cb239-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">750</span>, <span class="dv">20</span>, <span class="at">labels =</span> eqn) <span class="co"># add equation to the plot</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-90-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As we can see in the upper plot, the linear model does not explain the relationship between conc and uptake very well. Therefore we fit exponential function, which seems to fit much better to these data.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(uptake <span class="sc">~</span> conc, </span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> CO2, </span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Carbon Dioxide Uptake in Grass Plants&quot;</span>,</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># horizontal y-axis labels</span></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> CO2<span class="sc">$</span>conc, <span class="at">y =</span> <span class="fu">predict</span>(mod1), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># add linear model fitted line</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">nls</span>(uptake <span class="sc">~</span> <span class="fu">SSlogis</span>(conc, Asym, xmid, scal), <span class="at">data =</span> CO2) <span class="co"># nonlin fit using SSlogis selfstart model</span></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>xvals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">95</span>, <span class="at">to =</span> <span class="dv">1000</span>, <span class="at">by =</span> <span class="dv">3</span>) <span class="co"># new x values for which we want model prediction</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> xvals, <span class="at">y =</span> <span class="fu">predict</span>(mod2, <span class="fu">list</span>(<span class="at">conc =</span> xvals)), <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># add nonlin fit line</span></span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;linear model&quot;</span>, <span class="st">&quot;exponential model&quot;</span>) , <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># add legend to the plot</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-91-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="histogram" class="section level2">
<h2>Histogram</h2>
<p>To illustrate <code>hist</code> function we use 2013 Tartu cross-country skiing marathon 63 km times (<code>Aeg</code> in Estonian).</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/Tartu_Maraton_2013.RData&quot;</span>)</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tm_2013)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##    Koht    Nr Nimi             Elukoht       Aeg     Vanuseklass Kuubik
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;
## 1    NA     0 Laugal, Emil     Harju maakond &lt;NA&gt;    &lt;NA&gt;          0   
## 2  5500  6083 Miezys, Audrius  Leedu         6:25:42 M50           0   
## 3     1     4 Oestensen, Simen Norra         2:45:01 M21           1   
## 4     2     1 Brink, Joergen   Rootsi        2:45:02 M35           1.00
## 5     3     2 Aukland, Anders  Norra         2:45:02 M40           1.00
## 6     4    50 Näss, Börre      Norra         2:45:02 M21           1.00</code></pre>
<p>We first convert times in H:M:S format into periods using <code>hms()</code> function from <code>lubridate</code> package, then convert them to period objects with <code>as.duration</code> function (ibid.). <code>as.duration</code> gives us seconds, which we convert to decimal hours by dividing with 3600s (== 1h).</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># for easy time manipulation</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">hms</span>(tm_2013<span class="sc">$</span>Aeg[<span class="sc">-</span><span class="dv">1</span>]) </span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">unclass</span>(<span class="fu">as.duration</span>(times))<span class="sc">/</span><span class="dv">3600</span> <span class="co"># unclass gives us numbers (time in seconds), which we further divide by 3600 to get time in hours</span></span></code></pre></div>
<p>Lets have a look at <code>TP</code>-s finish time and convert it into decimal hours:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>tm_2013[tm_2013<span class="sc">$</span>Nimi<span class="sc">==</span><span class="st">&quot;Päll, Taavi&quot;</span>,]<span class="sc">$</span>Aeg <span class="co"># TP-s time in H:M:S</span></span></code></pre></div>
<pre><code>## [1] &quot;4:34:20&quot;</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>tp_time <span class="ot">&lt;-</span> <span class="fu">unclass</span>(<span class="fu">as.duration</span>(<span class="fu">hms</span>(tm_2013[tm_2013<span class="sc">$</span>Nimi<span class="sc">==</span><span class="st">&quot;Päll, Taavi&quot;</span>,]<span class="sc">$</span>Aeg)))<span class="sc">/</span><span class="dv">3600</span> </span></code></pre></div>
<p>Now we plot a histogram of Tartu skiing marathon times and add a vertical line at <code>TP</code>-s time:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(times, </span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">100</span>, <span class="co"># seems to be a good granularity</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Tartu cross-country skiing</span><span class="sc">\n</span><span class="st">marathon 2013, 63 km&quot;</span>, <span class="co"># plot title. Pro tip: &#39;\n&#39; works as enter.</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Time, h&quot;</span>, <span class="co"># x-axis label: time in seconds</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># horizontal y-axis labels</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> tp_time, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># add red vertical line</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-95-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(times, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.25</span>)) <span class="co"># breaks after every 15 min</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-96-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="boxplot" class="section level2">
<h2>Boxplot</h2>
<p>Boxplots can be created, unsurprisingly, by <code>boxplot</code>:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(iris<span class="sc">$</span>Sepal.Length <span class="sc">~</span> iris<span class="sc">$</span>Species, </span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>,</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Species&quot;</span>,</span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Sepal Length&quot;</span>,</span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Sepal Length by Species in Iris&quot;</span>,</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(iris<span class="sc">$</span>Sepal.Length)))</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-97-1.png" width="672" style="display: block; margin: auto;" /></p>
<!-- With base graphics `boxplot` it is possible to use `plot = FALSE` argument to obtain boxplot stats for each group/plot without drawing the plot (**lower whisker, the lower hinge, the median, the upper hinge and the upper whisker**): -->
<!-- ```{r} -->
<!-- p <- boxplot(iris$Sepal.Length ~ iris$Species, plot = FALSE) -->
<!-- p$stats # boxplot stats -->
<!-- ``` -->
<!-- Whereas, lower and upper whiskers show 1.5 IQR by default (can be adjusted with the argument `range=`) and any values which lie outside of extremes of whiskers can be accessed like this:  -->
<!-- ```{r} -->
<!-- p$out # possible outliers -->
<!-- ``` -->
</div>
<div id="bargraphs" class="section level2">
<h2>Bargraphs</h2>
<p>This is <strong>no-brainer</strong>! Base graphics function <code>barplot</code> creates for us barplots with either vertical or horizontal bars:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/Rio2016_medals.RData&quot;</span>) <span class="co"># we use rio medals data </span></span></code></pre></div>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(medals<span class="sc">$</span>Total, </span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">names.arg =</span> medals<span class="sc">$</span>country_un, <span class="co"># country abbreviations, x-axis labels</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz =</span> <span class="cn">TRUE</span>, <span class="co"># horozontal y-axis</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.5</span>, <span class="co"># smaller labels</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>, <span class="co"># horizontal axis labels</span></span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="dv">4</span>, <span class="co"># fill color nr 4 from default palette = &quot;blue&quot;</span></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Total number of medals&quot;</span>, <span class="co"># x-axis label</span></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Country ranking by Rio 2016 medals&quot;</span>, <span class="co"># main title</span></span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">sub =</span> <span class="st">&quot;Ranking also takes into account the number of gold, silver and bronze medals.&quot;</span>, <span class="co"># subtitle or ingraph caption</span></span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.sub =</span> <span class="fl">0.5</span>) <span class="co"># labels perpendicular to x-axis</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-99-1.png" width="384" style="display: block; margin: auto;" /></p>
<!-- ### Dynamite plot -->
<!-- Whenever you open scientific article in biomedical field there is a good chance that you encounter **barplots with errorbars** sticking out of them, these pests are also known as [dynamite plots](http://biostat.mc.vanderbilt.edu/wiki/pub/Main/TatsukiKoyama/Poster3.pdf). In order to blend into the crowd we also learn how to create these wonderful and frightening graphs. -->
<!-- First we have to calculate summary statistics we want to put onto the graph -- mean (bar) and standard deviation (errorbar): -->
<!-- ```{r} -->
<!-- irissl_mean <- tapply(iris$Sepal.Length, iris$Species, mean) # mean for each species -->
<!-- irissl_sd <- tapply(iris$Sepal.Length, iris$Species, sd) # standard deviation for each species -->
<!-- ``` -->
<!-- It might seem little bit complicated, but you can use `tapply` when you want to apply a function (mean or sd in our case) to subsets of a vector (`iris$Sepal.Length` by Species) and the subsets are defined by some other vector, usually a factor (`iris$Species`). -->
<!-- `mapply` - when you have several data structures (e.g. lists) and you want to apply a function to the 1st elements of each, and then the 2nd elements of each, etc. -->
<!-- ```{r} -->
<!-- maxLim <- 1.1*max(mapply(sum, irissl_mean, irissl_sd)) # we find maximum sum of mean and sd in our dataset and multiply this number with 1.1 to give enough headroom for errorbars in our graph -->
<!-- bp <- barplot(irissl_mean, # means of our groups -->
<!--               names.arg = levels(iris$Species), # names for x-axis -->
<!--               ylim = c(0, maxLim)) # we have to set y-axis limits manually -->
<!-- arrows(x0 = bp, # coordinates of our groups on x-axis -->
<!--        y0 = irissl_mean, # start of arrow -->
<!--        y1 = irissl_mean + irissl_sd, # end of arrow -->
<!--        angle = 90) # blunt end for arrows; default is 30deg -->
<!-- ``` -->
</div>
<div id="combine-multiple-subplots" class="section level2">
<h2>Combine multiple subplots</h2>
<p>Here we show, how to combine multiple subplots into one overall graph in base R, using either the <code>par()</code> or <code>layout()</code> function. Plotting linear model fit object outputs four separate diagnostic plots – “Residuals vs Fitted”, “Normal Q-Q”, “Scale-Location” and “Residuals vs Leverage”:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod1)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-100-1.png" width="672" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-100-2.png" width="672" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-100-3.png" width="672" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-100-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>By telling graphics device to create four slots, arranged 2x2, in our plot window, using <code>par</code> function argument <code>mfrow=c(nr, nc)</code>, we can tidy up all this information little bit:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))      <span class="co"># number of rows, number of columns</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod1) <span class="co"># plots are arranged into matrix in order of appearance</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-101-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<p><code>layout()</code> function specifies graph layout using matrix. Here we create 2x2 layout specified by matrix – plots one and two will appear in the first column and third plot will be placed into second column and occupies two slots:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="dv">2</span>, <span class="dv">2</span>)) </span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris<span class="sc">$</span>Sepal.Length, iris<span class="sc">$</span>Sepal.Width, <span class="at">col =</span> iris<span class="sc">$</span>Species, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(uptake <span class="sc">~</span> conc, <span class="at">data =</span> CO2, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Carbon Dioxide Uptake in Grass Plants&quot;</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(medals<span class="sc">$</span>Total, </span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">names.arg =</span> medals<span class="sc">$</span>country_un, <span class="co"># country abbreviations, x-axis labels</span></span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz =</span> <span class="cn">TRUE</span>, <span class="co"># horozontal y-axis</span></span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.5</span>, <span class="co"># smaller labels</span></span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>, <span class="co"># horizontal axis labels</span></span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="dv">4</span>, <span class="co"># fill color nr 4 from default palette = &quot;blue&quot;</span></span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Total number of medals&quot;</span>, <span class="co"># x-axis label</span></span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Country ranking by Rio 2016 medals&quot;</span>, <span class="co"># main title</span></span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">sub =</span> <span class="st">&quot;Ranking also takes into account the number of gold, silver and bronze medals.&quot;</span>, <span class="co"># subtitle or ingraph caption</span></span>
<span id="cb256-13"><a href="#cb256-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.sub =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-102-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<p>If you want to revert your <code>par(mfrow=...</code> to the original settings with single slot in graphics device, use following approach:</p>
<p>Either run <code>par</code> again with <code>mfrow=c(1,1)</code> settings</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>Or assign original settings to object and after you have done your multiplot load these setting using <code>par</code>:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>originalpars <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="co"># direct current mfrow to originalpars object</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>),<span class="fu">rnorm</span>(<span class="dv">100</span>))</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-104-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(originalpars) <span class="co"># loads/restores previous parameters</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>originalpars <span class="co"># we have only mfrow here </span></span></code></pre></div>
<pre><code>## $mfrow
## [1] 1 1</code></pre>
</div>
<div id="save-plots" class="section level2">
<h2>Save plots</h2>
<p>To save a plot into file you have to open the file and plot device first and then plot any graphics. Base R has graphics devices for BMP, JPEG, PNG and TIFF format bitmap files and for PDF.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="at">filename =</span> <span class="st">&quot;Rplot%03d.png&quot;</span>,</span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">480</span>, <span class="at">height =</span> <span class="dv">480</span>, <span class="at">units =</span> <span class="st">&quot;px&quot;</span>, <span class="at">pointsize =</span> <span class="dv">12</span>,</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,  <span class="at">res =</span> <span class="cn">NA</span>, ...,</span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;cairo&quot;</span>, <span class="st">&quot;cairo-png&quot;</span>, <span class="st">&quot;Xlib&quot;</span>, <span class="st">&quot;quartz&quot;</span>), antialias)</span></code></pre></div>
<p>We want to save our disposable output files to directory <code>output</code>, therefore we first check if we already have this directory, if not then we create it:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;output&quot;</span>)) <span class="fu">dir.create</span>(<span class="st">&quot;output&quot;</span>)</span></code></pre></div>
<p>In case of .png:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="at">file =</span> <span class="st">&quot;output/iris_sepal.png&quot;</span>, <span class="at">width =</span> <span class="dv">1200</span>, <span class="at">height =</span> <span class="dv">800</span>, <span class="at">res =</span> <span class="dv">300</span>)</span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris<span class="sc">$</span>Sepal.Length, iris<span class="sc">$</span>Sepal.Width, <span class="at">col =</span> iris<span class="sc">$</span>Species, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="cf">if</span>(onefile) <span class="st">&quot;Rplots.pdf&quot;</span> <span class="cf">else</span> <span class="st">&quot;Rplot%03d.pdf&quot;</span>,</span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>    width, height, onefile, family, title, fonts, version,</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a>    paper, encoding, bg, fg, pointsize, pagecentre, colormodel,</span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a>    useDingbats, useKerning, fillOddEven, compress)</span></code></pre></div>
<p>width, height – the width and height of the graphics region in inches. The default values are 7.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">&quot;output/co2_uptake.pdf&quot;</span>)</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(uptake <span class="sc">~</span> conc, <span class="at">data =</span> CO2, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Carbon Dioxide Uptake in Grass Plants&quot;</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;output&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;co2_uptake.pdf&quot; &quot;iris_sepal.png&quot;</code></pre>
</div>
</div>
<div id="getting-data-in-and-out-of-r" class="section level1">
<h1>Getting data in and out of R</h1>
<div class="figure">
<img src="https://upload.wikimedia.org/wikipedia/en/2/2c/Banksy_Better_Out_Than_In_New_York_City_2013.png" alt="" />
<p class="caption">Really? Photo: Banksy</p>
</div>
<!-- When planning to import your data from external files to R, then -->
<!-- + avoid whitespaces in your file names, replace these with `.`,`_` or `-` -->
<!-- + don't use special characters like `,` `?` `#` `*` `@` `$` `%` `|` `^` `{` `}` `(` `)` `[` `]` `\` `/` -->
<div id="import-tabular-data" class="section level2">
<h2>Import tabular data</h2>
<p><code>read.table</code>, <code>read.csv</code>, <code>read.delim</code> functions allow to create data frames, where different columns may contain different type of data – <code>numeric</code>, <code>character</code> etc. <code>read.table</code> is the basic function with values separated by white space <code>""</code> (one or more spaces, tabs, newlines). <code>read.csv</code> is a wrapper around it and expects comma <code>,</code> as a field separator and <code>read.delim</code> expects <code>tab</code> separator <code>\t</code>.</p>
<p>Other important arguments of <code>read.table</code> are:</p>
<ul>
<li><code>dec = "."</code> the character used in the file for decimal points. In many cases ignorant people use comma as decimal separator.</li>
<li><code>stringsAsFactors =</code> default setting is TRUE and character data is converted into factors.</li>
<li><code>na.string = "NA"</code> a character vector of strings which are to be interpreted as NA values. Blank fields are also considered to be missing values in logical, integer, numeric and complex fields.<br />
</li>
<li><code>skip =</code> the number of lines of the data file to skip before beginning to read data.</li>
</ul>
<p>We use survey data (%) of eating fruits and vegetables within last 7 days from Estonian <a href="http://www.tai.ee/en/">Institute for Health Development</a>. Don’t mind the file extension .csv, it’s values are tab separated. TAI offers different download formats, but mostly in useless forms (even for .csv and .txt files). Only “Tabeldieraldusega pealkirjata tekst (.csv)” and “Semikooloneraldusega pealkirjata tekst (.csv)” are in a suitable rectangular format, although lacking column headers. We have to identify and add column headers separately and fix character encoding.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>fruit <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/TKU10m.csv&quot;</span>) <span class="co"># tab separated text</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fruit) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Foodstuff&quot;</span>, <span class="st">&quot;Consumption&quot;</span>, <span class="st">&quot;Gender&quot;</span>, <span class="st">&quot;AGE16-24&quot;</span>, <span class="st">&quot;AGE25-34&quot;</span>, <span class="st">&quot;AGE35-44&quot;</span>, <span class="st">&quot;AGE45-54&quot;</span>, <span class="st">&quot;AGE55-64&quot;</span>)</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fruit)</span></code></pre></div>
<pre><code>##   Year Foodstuff     Consumption Gender AGE16-24 AGE25-34 AGE35-44 AGE45-54
## 1 1994   Puuvili Ei s\xf6\xf6nud  Mehed     32.3     24.8     33.8     34.0
## 2 1994   Puuvili Ei s\xf6\xf6nud Naised     14.7     15.0     18.1     22.8
## 3 1994   Puuvili   1-2 p\xe4eval  Mehed     40.3     45.1     40.4     43.3
## 4 1994   Puuvili   1-2 p\xe4eval Naised     40.0     43.8     43.2     46.2
## 5 1994   Puuvili   3-5 p\xe4eval  Mehed     22.6     23.0     17.7     16.3
## 6 1994   Puuvili   3-5 p\xe4eval Naised     32.0     24.8     25.8     26.0
##   AGE55-64
## 1     52.4
## 2     39.0
## 3     33.3
## 4     42.1
## 5     11.9
## 6     15.2</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets translate some variables to english by changing factor labels</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>fruit<span class="sc">$</span>Foodstuff  <span class="ot">&lt;-</span> <span class="fu">factor</span>(fruit<span class="sc">$</span>Foodstuff, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;K</span><span class="sc">\xf6\xf6</span><span class="st">givili&quot;</span>,<span class="st">&quot;Puuvili&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Vegetables&quot;</span>, <span class="st">&quot;Fruits&quot;</span>))</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>fruit<span class="sc">$</span>Consumption <span class="ot">&lt;-</span>  <span class="fu">factor</span>(fruit<span class="sc">$</span>Consumption, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Ei s</span><span class="sc">\xf6\xf6</span><span class="st">nud&quot;</span>, <span class="st">&quot;1-2 p</span><span class="sc">\xe4e</span><span class="st">val&quot;</span>, <span class="st">&quot;3-5 p</span><span class="sc">\xe4e</span><span class="st">val&quot;</span>, <span class="st">&quot;6-7 p</span><span class="sc">\xe4e</span><span class="st">val&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;1-2 days&quot;</span>, <span class="st">&quot;3-5 days&quot;</span>, <span class="st">&quot;6-7 days&quot;</span>))</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>fruit<span class="sc">$</span>Gender <span class="ot">&lt;-</span>  <span class="fu">factor</span>(fruit<span class="sc">$</span>Gender, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Mehed&quot;</span>, <span class="st">&quot;Naised&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Males&quot;</span>, <span class="st">&quot;Females&quot;</span>))                            </span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fruit)</span></code></pre></div>
<pre><code>##   Year Foodstuff Consumption  Gender AGE16-24 AGE25-34 AGE35-44 AGE45-54
## 1 1994    Fruits          No   Males     32.3     24.8     33.8     34.0
## 2 1994    Fruits          No Females     14.7     15.0     18.1     22.8
## 3 1994    Fruits    1-2 days   Males     40.3     45.1     40.4     43.3
## 4 1994    Fruits    1-2 days Females     40.0     43.8     43.2     46.2
## 5 1994    Fruits    3-5 days   Males     22.6     23.0     17.7     16.3
## 6 1994    Fruits    3-5 days Females     32.0     24.8     25.8     26.0
##   AGE55-64
## 1     52.4
## 2     39.0
## 3     33.3
## 4     42.1
## 5     11.9
## 6     15.2</code></pre>
<p>Table of downloadable R .csv datasets to play around and test things is for example available <a href="https://vincentarelbundock.github.io/Rdatasets/datasets.html">here</a>. As you can see, you can use URL to download data directly from web.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/datasets/airquality.csv&quot;</span>)</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(airquality)</span></code></pre></div>
<pre><code>##   X Ozone Solar.R Wind Temp Month Day
## 1 1    41     190  7.4   67     5   1
## 2 2    36     118  8.0   72     5   2
## 3 3    12     149 12.6   74     5   3
## 4 4    18     313 11.5   62     5   4
## 5 5    NA      NA 14.3   56     5   5
## 6 6    28      NA 14.9   66     5   6</code></pre>
<div id="readr-package" class="section level3">
<h3><code>readr</code> package</h3>
<p>You can import tabular data using read_ functions from <code>readr</code> package. Compared to base R functions like <code>read.csv()</code>, <code>readr</code> is much faster (important for very large datasets) and gives more convenient output:</p>
<ul>
<li>it never converts strings to factors,</li>
<li>can parse date/times, and</li>
<li>it leaves the column names as in raw data.</li>
</ul>
<p>We can compare what happens with column names in case of <code>read.csv</code> and <code>read_csv</code>:</p>
<p><code>base::read.csv</code> changes column names (1st row):</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="fu">textConnection</span>(<span class="st">&quot;1 column, my data</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="st">               2,3</span></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a><span class="st">               4,5&quot;</span>))</span></code></pre></div>
<pre><code>##   X1.column my.data
## 1         2       3
## 2         4       5</code></pre>
<p><code>readr::read_csv</code> leaves column names intact:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">&quot;1 column, my data</span></span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="st">              2,3</span></span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="st">              4,5&quot;</span>)  </span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   `1 column` `my data`
##        &lt;dbl&gt;     &lt;dbl&gt;
## 1          2         3
## 2          4         5</code></pre>
<p>Note also that in case of <code>read_csv</code> you can directly paste your comma separated text into function (instead trough textConnection).</p>
<p>The first two arguments of <code>read_csv()</code> are:</p>
<ul>
<li><code>file</code>: path (or URL) to the file you want to load. Readr can automatically decompress files ending in .zip, .gz, .bz2, and .xz.</li>
<li><code>col_names</code>: column names. 3 options: TRUE (the default); FALSE numbers columns sequentially from X1 to Xn. A character vector, used as column names. If these don’t match up with the columns in the data, you’ll get a warning message.</li>
</ul>
<!-- `read_fwf()` reads fixed width files. You can specify fields either by their widths with `fwf_widths()` or their position with `fwf_positions()`.  -->
<p><code>read_table()</code> reads a common variation of fixed width files where columns are separated by white space.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;readr&quot;</span>)</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="fu">read_table</span>() <span class="co"># read the type of textual data where each column is separate by whitespace</span></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>() <span class="co"># reads comma delimited files, </span></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_tsv</span>() <span class="co"># reads tab delimited files, </span></span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>() <span class="co"># reads in files with a user supplied delimiter.</span></span></code></pre></div>
<p>Importantly, <code>read_</code> functions expect specific delimiter: comma for _csv, tab for _tsv etc., and only <code>read_delim</code> has argument for specifying delimiter to be used.</p>
<!-- #### Change column type -->
<!-- ```{r, eval=FALSE} -->
<!-- read_csv("mypath.csv", col_types = col(x = col_integer(), treatment = col_character())) -->
<!-- ``` -->
<!-- You can specify the following types of columns: -->
<!-- + `col_integer()` (i) and `col_double()` (d) specify integer and doubles. -->
<!-- + `col_logical()` (l) parses TRUE, T, FALSE and F into a logical vector. -->
<!-- + `col_character()` (c) leaves strings as is. -->
<!-- + `col_number()` (n) is a more flexible parser for numbers embedded in other strings. It will look for the first number in a string, ignoring non-numeric prefixes and suffixes. -->
<!-- + `col_factor()` (f) allows you to load data directly into a factor if you know what the levels are. -->
<!-- + `col_skip()` (_, -) completely ignores a column. -->
<!-- + `col_date()` (D), `col_datetime()` (T) and `col_time()` (t) parse into dates, date times, and times. -->
<!-- Each column parser has a one letter abbreviation, which you can use instead of the full function call (assuming you're happy with the default arguments): -->
<!-- ```{r, eval=FALSE} -->
<!-- read_csv("mypath.csv", col_types = cols(x = "i", treatment = "c")) -->
<!-- ``` -->
<!-- Each `col_XYZ()` function also has a corresponding `parse_XYZ()` that you can use on a character vector. -->
<!-- ```{r} -->
<!-- parse_integer(c("1", "2", "3")) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- parse_logical(c("TRUE", "FALSE", "NA")) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- parse_number(c("$1000", "20%", "3,000")) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- parse_datetime("2010-10-01T2010") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- parse_date("2010-10-01") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- parse_time("20:10:01") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- parse_date("01/02/15", "%m/%d/%y") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- parse_date("01/02/15", "%d/%m/%y") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- parse_date("01/02/15", "%y/%m/%d") -->
<!-- ``` -->
</div>
</div>
<div id="import-ms-excel" class="section level2">
<h2>Import MS Excel</h2>
<p>There are several libraries and functions available to import MS excel workbooks into R, like <code>XLConnect</code>,<code>gdata::read.xls()</code>, <code>xlsx</code>. <code>XLConnect</code> is a powerful package for working with .xls(x) files, but it depends on Java and has memory limitations: you’ll never know when your script crashes. <code>readxl</code> package contains only two verbs and is very easy to use.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>xlsfile <span class="ot">&lt;-</span> <span class="st">&quot;data/ECIS_140317_MFT_1.xls&quot;</span> <span class="co"># 96-well multi frequency real-time impedance data</span></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(xlsfile) </span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>sheets</span></code></pre></div>
<pre><code>##  [1] &quot;Details&quot;    &quot;Comments&quot;   &quot;Z 1000 Hz&quot;  &quot;R 1000 Hz&quot;  &quot;C 1000 Hz&quot; 
##  [6] &quot;Z 2000 Hz&quot;  &quot;R 2000 Hz&quot;  &quot;C 2000 Hz&quot;  &quot;Z 4000 Hz&quot;  &quot;R 4000 Hz&quot; 
## [11] &quot;C 4000 Hz&quot;  &quot;Z 8000 Hz&quot;  &quot;R 8000 Hz&quot;  &quot;C 8000 Hz&quot;  &quot;Z 16000 Hz&quot;
## [16] &quot;R 16000 Hz&quot; &quot;C 16000 Hz&quot; &quot;Z 32000 Hz&quot; &quot;R 32000 Hz&quot; &quot;C 32000 Hz&quot;
## [21] &quot;Z 64000 Hz&quot; &quot;R 64000 Hz&quot; &quot;C 64000 Hz&quot;</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(xlsfile, sheets[<span class="dv">3</span>]) <span class="co"># we import 3rd sheet &quot;Z 1000 Hz&quot;</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(z)</span></code></pre></div>
<pre><code>## [1] 647  97</code></pre>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Extract tables from messy spreadsheets with jailbreakr <a href="https://t.co/9wJfDj0cLM">https://t.co/9wJfDj0cLM</a> <a href="https://twitter.com/hashtag/rstats?src=hash">#rstats</a> <a href="https://twitter.com/hashtag/DataScience?src=hash">#DataScience</a>
</p>
— R-bloggers (<span class="citation">@Rbloggers</span>) <a href="https://twitter.com/Rbloggers/status/766226281859997697">August 18, 2016</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js"charset="utf-8"></script>
</div>
<div id="import-ods" class="section level2">
<h2>Import ODS</h2>
<p>To import Open Document Spreadsheets .ods files into R you can try <a href="https://github.com/chainsawriot/readODS">following approach</a>.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readODS)</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_ods</span>(<span class="st">&quot;table.ods&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>) <span class="do">## return only the first sheet</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="fu">read_ods</span>(<span class="st">&quot;multisheet.ods&quot;</span>, <span class="at">sheet =</span> <span class="dv">2</span>) <span class="do">## return the second sheet </span></span></code></pre></div>
<!-- ## PDF tables -->
<!-- PDF table extractor -- `Tabula` - exists as both a server application, accessed via a web browser, or as a service using the tabula extractor Java application. The (`tabulizer` R package)[https://github.com/ropenscilabs/tabulizer] provides a wrapper for tabula extractor (bundled within the package), that lets you access the service via it's command line calls. (One dependency you do need to take care of is to have Java installed; adding Java into an RStudio docker container would be one way of taking care of this.) -->
<!-- You can try this code with [more instructions on `github`](https://github.com/ropenscilabs/tabulizer) to install package (if rJava is installed successfully...). -->
<!-- ```{r, eval=FALSE} -->
<!-- devtools::install_github("ropenscilabs/tabulizer") -->
<!-- library("tabulizer") -->
<!-- f <- system.file("examples", "data.pdf", package = "tabulizer") -->
<!-- out1 <- extract_tables(f) -->
<!-- str(out1) -->
<!-- ``` -->
</div>
<div id="import-spss-sas-etc." class="section level2">
<h2>Import SPSS, SAS etc.</h2>
<p><code>foreign</code> package provies functions for reading and writing data stored by Minitab, S, SAS, SPSS, Stata, etc.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">read.spss</span>(<span class="st">&quot;mydata.sav&quot;</span>) <span class="co"># import spss data file, returns list</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">read.spss</span>(<span class="st">&quot;mydata.sav&quot;</span>, <span class="at">to.data.frame =</span> <span class="cn">TRUE</span>) <span class="co"># returns data.frame</span></span></code></pre></div>
</div>
<div id="import-all-datasets-from-directory" class="section level2">
<h2>Import all datasets from directory</h2>
<p>We can use <code>sapply(X, FUN, ..., simplify = TRUE, USE.NAMES = TRUE)</code> or <code>lapply(X, FUN, ...)</code> functions to iterate through vector or list of files, respectively. Three dots <code>...</code> shows that you can pass further arguments to your function (FUN).</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>data_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;data&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;.csv&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="co"># </span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>data_files <span class="co"># ups, we have only one file</span></span></code></pre></div>
<pre><code>## [1] &quot;data/test.csv&quot;   &quot;data/test2.csv&quot;  &quot;data/TKU10m.csv&quot;</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data_files, read.table, <span class="at">simplify =</span> <span class="cn">FALSE</span>, <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>) <span class="co"># sapply returns vector or matrix, simplify = FALSE outputs list</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(datasets)</span></code></pre></div>
<pre><code>## List of 3
##  $ data/test.csv  :&#39;data.frame&#39;: 6 obs. of  3 variables:
##   ..$ V1: chr [1:6] &quot;name,&quot; &quot;ana,&quot; &quot;bob,&quot; &quot;dad,&quot; ...
##   ..$ V2: chr [1:6] &quot;age,&quot; &quot;23.2,&quot; &quot;12,&quot; &quot;78.5,&quot; ...
##   ..$ V3: chr [1:6] &quot;sex&quot; &quot;m&quot; &quot;f&quot; &quot;m&quot; ...
##  $ data/test2.csv :&#39;data.frame&#39;: 6 obs. of  3 variables:
##   ..$ V1: chr [1:6] &quot;name;&quot; &quot;ana;&quot; &quot;bob;&quot; &quot;dad;&quot; ...
##   ..$ V2: chr [1:6] &quot;age;&quot; &quot;23,2;&quot; &quot;12;&quot; &quot;78,5;&quot; ...
##   ..$ V3: chr [1:6] &quot;sex&quot; &quot;m&quot; &quot;f&quot; &quot;m&quot; ...
##  $ data/TKU10m.csv:&#39;data.frame&#39;: 176 obs. of  9 variables:
##   ..$ V1: int [1:176] 1994 1994 1994 1994 1994 1994 1994 1994 1994 1994 ...
##   ..$ V2: chr [1:176] &quot;Puuvili&quot; &quot;Puuvili&quot; &quot;Puuvili&quot; &quot;Puuvili&quot; ...
##   ..$ V3: chr [1:176] &quot;Ei s\xf6\xf6nud&quot; &quot;Ei s\xf6\xf6nud&quot; &quot;1-2 p\xe4eval&quot; &quot;1-2 p\xe4eval&quot; ...
##   ..$ V4: chr [1:176] &quot;Mehed&quot; &quot;Naised&quot; &quot;Mehed&quot; &quot;Naised&quot; ...
##   ..$ V5: num [1:176] 32.3 14.7 40.3 40 22.6 32 4.8 13.3 21.3 17.6 ...
##   ..$ V6: num [1:176] 24.8 15 45.1 43.8 23 24.8 7.1 16.3 22.1 15.7 ...
##   ..$ V7: num [1:176] 33.8 18.1 40.4 43.2 17.7 25.8 8.1 12.9 25 16.1 ...
##   ..$ V8: num [1:176] 34 22.8 43.3 46.2 16.3 26 6.4 5.1 31.7 19.6 ...
##   ..$ V9: num [1:176] 52.4 39 33.3 42.1 11.9 15.2 2.4 3.7 39 28.4 ...</code></pre>
<!-- If you have datasets with same column names, you can import all datasets as a list and rbind them into one data.frame. Here we concatenate our single data.frame in `datasets` object. -->
<!-- `do.call(rbind, my_list_of_dataframes)` is base R solution to this task. -->
<!-- ```{r} -->
<!-- nrow(datasets[[1]]) # how many rows in our original data? datasets is a list. -->
<!-- rbound_datasets <-  do.call(rbind, c(datasets, datasets)) # bind dataframes in list by rows -->
<!-- nrow(rbound_datasets) # how many rows we have now -->
<!-- ``` -->
<!-- Alternative solution is `bind_rows` from `dplyr` package. -->
<!-- ```{r} -->
<!-- rbound_datasets2 <- dplyr::bind_rows(c(datasets, datasets)) -->
<!-- nrow(rbound_datasets2) # how many rows we have now -->
<!-- ``` -->
</div>
<div id="import-text-file" class="section level2">
<h2>Import text file</h2>
<p>Probably, the most basic form of data to import into R is a simple text file.</p>
<p>Here we write our data to external file <code>ex.data</code> and read it into R using <code>scan()</code> function. Importantly, <code>scan()</code> reads vectors of data which all have the same mode. Default data type is numeric, strings can be specified with the <code>what = ""</code> argument.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;my title line&quot;</span>, <span class="st">&quot;2 3 5 7&quot;</span>, <span class="st">&quot;11 13 17&quot;</span>, <span class="at">file =</span> <span class="st">&quot;ex.data&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">scan</span>(<span class="st">&quot;ex.data&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>) <span class="co"># we skip 1st line with title text or we get error</span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;ex.data&quot;</span>) <span class="co"># tidy up, unlink deletes the file(s) or directories specified</span></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>pp</span></code></pre></div>
<pre><code>## [1]  2  3  5  7 11 13 17</code></pre>
<p>In case you dont wan’t or can’t save your text into file (bad for reproducibility!), it’s possible to use <code>textConnection()</code> function to input data into R. <code>\n</code> is a newline character.</p>
<p><code>readLines</code> reads “unorganized” data, this is the function that will read input into R so that we can manipulate it further.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>zzz <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(<span class="st">&quot;my title line 2 3 5 7 11 13 17 9&quot;</span>) </span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">readLines</span>(zzz) <span class="co"># zzz is a connection object</span></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>pp</span></code></pre></div>
<pre><code>## [1] &quot;my title line 2 3 5 7 11 13 17 9&quot;</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">close</span>(zzz) <span class="co"># close connection</span></span></code></pre></div>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">scan</span>(<span class="fu">textConnection</span>(<span class="st">&quot;my title line</span><span class="sc">\n</span><span class="st">2 3 5 7</span><span class="sc">\n</span><span class="st">11 13 17 9&quot;</span>), <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>pp</span></code></pre></div>
<pre><code>## [1]  2  3  5  7 11 13 17  9</code></pre>
<p>Text in <code>textConnection</code> call can be already structured, so you can quickly import copy-paste data from screen into R.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>zzz <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(<span class="st">&quot;my title line </span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="st">                      2 3 5 7</span></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="st">                      11 13 17 9&quot;</span>)</span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">scan</span>(zzz, <span class="at">skip =</span> <span class="dv">2</span>) <span class="co"># lets skip 1st two lines</span></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<pre><code>## [1] 11 13 17  9</code></pre>
<p>Scanned data can be coerced into rectangular matrix. We have 2 rows of numbers in our text string shown above therefore we set <code>nrow = 2</code> and we need to specify that data is inserted into matrix rowwise <code>byrow = TRUE</code> (default option is FALSE) to keep original data structure.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(pp, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    2    3    5    7
## [2,]   11   13   17    9</code></pre>
</div>
</div>
<div id="tidy-data" class="section level1">
<h1>Tidy data</h1>
<p>To standardize data analysis, you must start by standardizing data structure. Tidy data arranges values so that the relationships between variables in a data set will parallel the relationship between vectors in R’s storage objects. R stores tabular data as a data frame, a list of atomic vectors arranged to look like a table. Each column in the table is a vector. In tidy data, each variable in the data set is assigned to its own column, i.e., its own vector in the data frame. As a result, you can extract all the values of a variable in a tidy data set by extracting the column vector that contains the variable, i.e. table1$cases. Because R does vector calculations element by element, it is fastest when you compare vectors directly side-by-side.</p>
<ul>
<li>value is the result of a single measurement (167 cm). = cell</li>
<li>variable is what you measure (length, height), or a factor (sex, treatment). = column</li>
<li>observation or data point is a set of measurements that made under similar conditions (John’s height and weight measured on 23.04.2012). = row</li>
<li>Observational unit (who or what was measured): subject no. 1, etc. = 1st column</li>
<li>Type of observational unit: humans, mice, cell lysates, etc. = table</li>
</ul>
<p>Tidy data: each value is in its own “cell”, each variable in its own column, each observation in its own row, and each type of observational unit in its own table - useful for grouping, summarizing, filtering, and plotting. In a tidy table the order of columns is:</p>
<ol style="list-style-type: decimal">
<li>Observational unit</li>
<li>Factors &amp; everything that was not measured (values fixed at experimental planning stage)</li>
<li>Measured Vars.</li>
</ol>
<p>Keeping the data in this form allows multiple tools to be used in sequence. NB! There are always more possible Vars in your data than were measured – do weight and height and get BMI as a bonus.</p>
<div id="melt-data-into-long-format" class="section level2">
<h2>Melt data into long format</h2>
<p>First we load a bunch of <strong>tidyverse</strong> backages:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span></code></pre></div>
<p><code>reshape2::melt(df)</code> - treats the variables that contain factors or strings as ‘id.vars’, which remain fixed; and melts all numeric columns.</p>
<p>We start by making a mock table:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>subject <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Tim&quot;</span>, <span class="st">&quot;Ann&quot;</span>, <span class="st">&quot;Jill&quot;</span>)</span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>)</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">23</span>, <span class="dv">31</span>, <span class="dv">30</span>)</span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>experiment_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">38</span>, <span class="dv">36</span>)</span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>experiment_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">42</span>, <span class="dv">44</span>)</span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(subject, sex, control, experiment_1, experiment_2)</span>
<span id="cb307-7"><a href="#cb307-7" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   subject sex   control experiment_1 experiment_2
##   &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 Tim     M          23           34           40
## 2 Ann     F          31           38           42
## 3 Jill    F          30           36           44</code></pre>
<p>Next we melt it by providing the df as the only argument to <code>reshape2::melt</code>:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">melt</span>(df) <span class="co"># this gives identical result.</span></span></code></pre></div>
<pre><code>## Using subject, sex as id variables</code></pre>
<pre><code>##   subject sex     variable value
## 1     Tim   M      control    23
## 2     Ann   F      control    31
## 3    Jill   F      control    30
## 4     Tim   M experiment_1    34
## 5     Ann   F experiment_1    38
## 6    Jill   F experiment_1    36
## 7     Tim   M experiment_2    40
## 8     Ann   F experiment_2    42
## 9    Jill   F experiment_2    44</code></pre>
<p>We can also use pipe operator (<code>%&gt;%</code>):</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> melt <span class="sc">%&gt;%</span> tbl_df <span class="co"># we further convert dataframe to a tibble by tbl_df</span></span></code></pre></div>
<pre><code>## Using subject, sex as id variables</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>df_melted</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   subject sex   variable     value
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;
## 1 Tim     M     control         23
## 2 Ann     F     control         31
## 3 Jill    F     control         30
## 4 Tim     M     experiment_1    34
## 5 Ann     F     experiment_1    38
## 6 Jill    F     experiment_1    36
## 7 Tim     M     experiment_2    40
## 8 Ann     F     experiment_2    42
## 9 Jill    F     experiment_2    44</code></pre>
<p>Here we are more explicit about arguments to <code>melt()</code>. If you provide only <code>id.vars</code> or <code>measure.vars</code>, <code>R</code> will assume that all other variables belong to the argument that was not provided:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">melt</span>(<span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;subject&quot;</span>, <span class="st">&quot;sex&quot;</span>),   <span class="co"># all the variables to keep, but not split apart </span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;control&quot;</span>, <span class="st">&quot;experiment_1&quot;</span>, <span class="st">&quot;experiment_2&quot;</span>),</span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">variable.name =</span> <span class="st">&quot;experiment&quot;</span>, <span class="co"># Name of the destination column for factors that are taken from names of melted columns</span></span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">value.name =</span> <span class="st">&quot;nr.of.counts&quot;</span> <span class="co"># name of the newly made column which contains the values</span></span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> tbl_df</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   subject sex   experiment   nr.of.counts
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;               &lt;dbl&gt;
## 1 Tim     M     control                23
## 2 Ann     F     control                31
## 3 Jill    F     control                30
## 4 Tim     M     experiment_1           34
## 5 Ann     F     experiment_1           38
## 6 Jill    F     experiment_1           36
## 7 Tim     M     experiment_2           40
## 8 Ann     F     experiment_2           42
## 9 Jill    F     experiment_2           44</code></pre>
<p>Alternatively we can use <code>tidyr::gather</code> to melt tables:</p>
<ul>
<li>1st argument (here <code>key = experiment</code>) names the key factor or character column, whose values will be the names of the columns, which are melted into a single column.</li>
<li>The 2nd argument (here <code>value = value</code>) is the name of the resultant single column, which contains the values.</li>
<li>The third argument (here <code>3:ncol(df)</code>) specifies the columns, which are melted into a single column; in the version <code>c(-subject, -sex)</code> every column except these 2 is melted.</li>
</ul>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">gather</span>(<span class="at">key =</span> experiment, <span class="at">value =</span> value, <span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(df))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   subject sex   experiment   value
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1 Tim     M     control         23
## 2 Ann     F     control         31
## 3 Jill    F     control         30
## 4 Tim     M     experiment_1    34
## 5 Ann     F     experiment_1    38
## 6 Jill    F     experiment_1    36
## 7 Tim     M     experiment_2    40
## 8 Ann     F     experiment_2    42
## 9 Jill    F     experiment_2    44</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df_melted3&lt;-df %&gt;% gather(experiment, value, 3:ncol(df)) works as well.</span></span></code></pre></div>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">gather</span>(experiment, value, <span class="fu">c</span>(<span class="sc">-</span>subject, <span class="sc">-</span>sex))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   subject sex   experiment   value
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1 Tim     M     control         23
## 2 Ann     F     control         31
## 3 Jill    F     control         30
## 4 Tim     M     experiment_1    34
## 5 Ann     F     experiment_1    38
## 6 Jill    F     experiment_1    36
## 7 Tim     M     experiment_2    40
## 8 Ann     F     experiment_2    42
## 9 Jill    F     experiment_2    44</code></pre>
</div>
<div id="cast-melted-table-back-into-wide" class="section level2">
<h2>Cast melted table back into wide</h2>
<p>While there is only one correct tidy long format, there exist several possible wide formats. Which one to choose depends on what you want to use the wide table for (i.e., on the specific statistical application)</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">dcast</span>(subject <span class="sc">+</span> sex <span class="sc">~</span> value)</span></code></pre></div>
<pre><code>##   subject sex 23 30 31 34 36 38 40 42 44
## 1     Ann   F NA NA 31 NA NA 38 NA 42 NA
## 2    Jill   F NA 30 NA NA 36 NA NA NA 44
## 3     Tim   M 23 NA NA 34 NA NA 40 NA NA</code></pre>
<p>Uups!</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">dcast</span>(subject <span class="sc">+</span> sex <span class="sc">~</span> variable)</span></code></pre></div>
<pre><code>##   subject sex control experiment_1 experiment_2
## 1     Ann   F      31           38           42
## 2    Jill   F      30           36           44
## 3     Tim   M      23           34           40</code></pre>
<p><code>dcast()</code> starts with melted data and reshapes it into a wide format using a formula. The format is <code>newdata &lt;- dcast(md, formula, FUN)</code> where md is the melted data. The formula takes the form:</p>
<ul>
<li><code>rowvar1 + rowvar2 + … ~ colvar1 + colvar2 + …</code></li>
<li><code>rowvar1 + rowvar2 + …</code> define the rows, and</li>
<li><code>colvar1 + colvar2 + …</code> define the columns.</li>
</ul>
<blockquote>
<p>Important! the right-hand argument to the equation <code>~</code> is the column that contains the factor levels or character vectors that will be tranformed into column names of the wide table.</p>
</blockquote>
<p>We can use <code>tidyr::spread()</code> as an alternative to <code>dcast()</code>. Here <strong>variable</strong> is the factor or character column, whose values will be transformed into column names and <strong>value</strong> is the name of the column, which contains all the values that are spread into the new columns.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">spread</span>(<span class="at">key =</span> variable, <span class="at">value =</span> value)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   subject sex   control experiment_1 experiment_2
##   &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 Ann     F          31           38           42
## 2 Jill    F          30           36           44
## 3 Tim     M          23           34           40</code></pre>
</div>
<div id="separate" class="section level2">
<h2>Separate</h2>
<p>Separate separates one column into many:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">country =</span> <span class="fu">c</span>(<span class="st">&quot;Albania&quot;</span>), <span class="at">disease.cases =</span> <span class="fu">c</span>(<span class="st">&quot;80/1000&quot;</span>))</span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   country disease.cases
##   &lt;chr&gt;   &lt;chr&gt;        
## 1 Albania 80/1000</code></pre>
<p>We want to separate <code>80/1000</code> at the slash. Default action of separate is to look at the any sequence of non-alphanumeric values:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(disease.cases, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>)) <span class="co"># works ok in this case!</span></span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   
## 1 Albania 80    1000</code></pre>
<p>We can supply regular expression, matching <code>/</code>:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(disease.cases, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>) <span class="co">#match slash</span></span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   
## 1 Albania 80    1000</code></pre>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(disease.cases, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">W&quot;</span>) <span class="co"># any non-alphanumeric</span></span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   
## 1 Albania 80    1000</code></pre>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(disease.cases, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="at">sep =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   
## 1 Albania 80    /1000</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(disease.cases, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="at">sep =</span> <span class="sc">-</span><span class="dv">6</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   
## 1 Albania 8     0/1000</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">index =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">taxon =</span> <span class="fu">c</span>(<span class="st">&quot;Procaryota; Bacteria; Alpha-Proteobacteria; Escharichia&quot;</span>, <span class="st">&quot;Eukaryota; Chordata&quot;</span>))</span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(taxon, <span class="fu">c</span>(<span class="st">&#39;riik&#39;</span>, <span class="st">&#39;hmk&#39;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="at">sep =</span> <span class="st">&#39;;&#39;</span>, <span class="at">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index riik       hmk         klass                   perekond      
##   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;                   &lt;chr&gt;         
## 1     1 Procaryota &quot; Bacteria&quot; &quot; Alpha-Proteobacteria&quot; &quot; Escharichia&quot;
## 2     2 Eukaryota  &quot; Chordata&quot;  &lt;NA&gt;                    &lt;NA&gt;</code></pre>
<p>Some special cases:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">index =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">taxon =</span> <span class="fu">c</span>(<span class="st">&quot;Procaryota || Bacteria || Alpha-Proteobacteria || Escharichia&quot;</span>, <span class="st">&quot;Eukaryota || Chordata&quot;</span>))</span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(taxon, <span class="fu">c</span>(<span class="st">&quot;riik&quot;</span>, <span class="st">&quot;hmk&quot;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">|</span><span class="sc">\\</span><span class="st">|&quot;</span>, <span class="at">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index riik          hmk          klass                    perekond      
##   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;                    &lt;chr&gt;         
## 1     1 &quot;Procaryota &quot; &quot; Bacteria &quot; &quot; Alpha-Proteobacteria &quot; &quot; Escharichia&quot;
## 2     2 &quot;Eukaryota &quot;  &quot; Chordata&quot;   &lt;NA&gt;                     &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">index =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">taxon =</span> <span class="fu">c</span>(<span class="st">&quot;Procaryota.Bacteria.Alpha-Proteobacteria.Escharichia&quot;</span>, <span class="st">&quot;Eukaryota.Chordata&quot;</span>))</span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(taxon, <span class="fu">c</span>(<span class="st">&#39;riik&#39;</span>, <span class="st">&#39;hmk&#39;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="at">sep =</span> <span class="st">&#39;[.]&#39;</span>, <span class="at">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index riik       hmk      klass                perekond   
##   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;      
## 1     1 Procaryota Bacteria Alpha-Proteobacteria Escharichia
## 2     2 Eukaryota  Chordata &lt;NA&gt;                 &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">index =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">taxon =</span> <span class="fu">c</span>(<span class="st">&quot;Procaryota.Bacteria,Alpha-Proteobacteria.Escharichia&quot;</span>, <span class="st">&quot;Eukaryota.Chordata&quot;</span>))</span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(taxon, <span class="fu">c</span>(<span class="st">&#39;riik&#39;</span>, <span class="st">&#39;hmk&#39;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="at">sep =</span> <span class="st">&#39;[,</span><span class="sc">\\</span><span class="st">.]&#39;</span>, <span class="at">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;right&quot;</span>) </span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index riik       hmk      klass                perekond   
##   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;      
## 1     1 Procaryota Bacteria Alpha-Proteobacteria Escharichia
## 2     2 Eukaryota  Chordata &lt;NA&gt;                 &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="co"># [,\\.] separates by dot or comma. Isn&#39;t that cool?</span></span></code></pre></div>
<p>The companion FUN to separate is <code>unite()</code> - see help (if you should feel the need for it, which you probably wont).</p>
<div id="find-and-replace-helps-to-deal-with-unruly-labelling-inside-columns-containing-strings" class="section level3">
<h3>Find and replace helps to deal with unruly labelling inside columns containing strings</h3>
<p>The idea is to find a pattern in a collection of strings and replace it with something else. <code>String == character vector</code>.</p>
<p>To find and replace we use <code>str_replace_all()</code>, whose base R analogue is <code>gsub()</code>:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(<span class="fu">c</span>(<span class="st">&quot;t0&quot;</span>, <span class="st">&quot;t1&quot;</span>, <span class="st">&quot;t12&quot;</span>), <span class="st">&quot;t&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>() </span></code></pre></div>
<pre><code>## [1]  0  1 12</code></pre>
<p>Now we have a numeric time column, which can be used in plotting.</p>
<p>or</p>
<p>Here we do the same thing more elegantly by directly parsing numbers from a character string:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_number</span>(<span class="fu">c</span>(<span class="st">&quot;t0&quot;</span>, <span class="st">&quot;t1&quot;</span>, <span class="st">&quot;t12&quot;</span>))</span></code></pre></div>
<pre><code>## [1]  0  1 12</code></pre>
</div>
</div>
<div id="it-is-high-time-to-learn-the-5-verbs-of-dplyr" class="section level2">
<h2>It is high time to learn the 5 verbs of dplyr</h2>
<p>NB! Check the data wrangling cheatsheet and help for further details</p>
<div id="select" class="section level3">
<h3>select</h3>
<p><code>select</code> selects, renames, and re-orders columns</p>
<p>To select columns from sex to value:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>df_melted</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   subject sex   variable     value
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;
## 1 Tim     M     control         23
## 2 Ann     F     control         31
## 3 Jill    F     control         30
## 4 Tim     M     experiment_1    34
## 5 Ann     F     experiment_1    38
## 6 Jill    F     experiment_1    36
## 7 Tim     M     experiment_2    40
## 8 Ann     F     experiment_2    42
## 9 Jill    F     experiment_2    44</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">select</span>(sex<span class="sc">:</span>value)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 3
##   sex   variable     value
##   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;
## 1 M     control         23
## 2 F     control         31
## 3 F     control         30
## 4 M     experiment_1    34
## 5 F     experiment_1    38
## 6 F     experiment_1    36
## 7 M     experiment_2    40
## 8 F     experiment_2    42
## 9 F     experiment_2    44</code></pre>
<p>To select just 2 columns and rename <em>subject</em> to <em>SUBJ</em>:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">select</span>(sex, value, <span class="at">SUBJ=</span>subject)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 3
##   sex   value SUBJ 
##   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;
## 1 M        23 Tim  
## 2 F        31 Ann  
## 3 F        30 Jill 
## 4 M        34 Tim  
## 5 F        38 Ann  
## 6 F        36 Jill 
## 7 M        40 Tim  
## 8 F        42 Ann  
## 9 F        44 Jill</code></pre>
<p>To select all cols, except sex and value, and rename the <em>subject</em> col:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>sex, <span class="sc">-</span>value, <span class="at">SUBJ=</span>subject)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 2
##   SUBJ  variable    
##   &lt;chr&gt; &lt;fct&gt;       
## 1 Tim   control     
## 2 Ann   control     
## 3 Jill  control     
## 4 Tim   experiment_1
## 5 Ann   experiment_1
## 6 Jill  experiment_1
## 7 Tim   experiment_2
## 8 Ann   experiment_2
## 9 Jill  experiment_2</code></pre>
</div>
<div id="mutate" class="section level3">
<h3>mutate</h3>
<p>Mutate adds new columns (and transmute creates new columns while losing the previous columns - see the cheatsheet and help)</p>
<p>Here we firstly create a new column, which contains log-transformed values from the <em>value</em> column, and name it <em>log.value</em>. And secondly we create a new col <em>strange.value</em>, which contains the results of a really silly data transformation including taking a square root.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">log.value =</span> <span class="fu">log10</span>(value), <span class="at">strange.value=</span> <span class="fu">sqrt</span>(value <span class="sc">-</span> log.value))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 6
##   subject sex   variable     value log.value strange.value
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 Tim     M     control         23      1.36          4.65
## 2 Ann     F     control         31      1.49          5.43
## 3 Jill    F     control         30      1.48          5.34
## 4 Tim     M     experiment_1    34      1.53          5.70
## 5 Ann     F     experiment_1    38      1.58          6.03
## 6 Jill    F     experiment_1    36      1.56          5.87
## 7 Tim     M     experiment_2    40      1.60          6.20
## 8 Ann     F     experiment_2    42      1.62          6.35
## 9 Jill    F     experiment_2    44      1.64          6.51</code></pre>
<p>The same with transmute: note the dropping of some of the original cols, keeping the original <em>subject</em> col and renaming the <em>sex</em> col.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(subject, <span class="at">gender=</span>sex, <span class="at">log.value =</span> <span class="fu">log10</span>(value))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 3
##   subject gender log.value
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;
## 1 Tim     M           1.36
## 2 Ann     F           1.49
## 3 Jill    F           1.48
## 4 Tim     M           1.53
## 5 Ann     F           1.58
## 6 Jill    F           1.56
## 7 Tim     M           1.60
## 8 Ann     F           1.62
## 9 Jill    F           1.64</code></pre>
</div>
<div id="filter" class="section level3">
<h3>filter</h3>
<p>Filter filters rows</p>
<p>Keep rows that have sex level “M” and value &gt;30.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">&quot;M&quot;</span> <span class="sc">&amp;</span> value <span class="sc">&lt;</span> <span class="dv">30</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   subject sex   variable value
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;    &lt;dbl&gt;
## 1 Tim     M     control     23</code></pre>
<p>Keep rows that have sex level “M” or value &gt;30.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">&quot;M&quot;</span> <span class="sc">|</span> value <span class="sc">&lt;</span> <span class="dv">30</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   subject sex   variable     value
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;
## 1 Tim     M     control         23
## 2 Tim     M     experiment_1    34
## 3 Tim     M     experiment_2    40</code></pre>
<p>Keep rows that have sex level not “M” (which in this case equals “F”) or value &gt;30.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">!=</span> <span class="st">&quot;M&quot;</span> <span class="sc">|</span> value <span class="sc">&lt;=</span> <span class="dv">30</span>)</span></code></pre></div>
<pre><code>## # A tibble: 7 x 4
##   subject sex   variable     value
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;
## 1 Tim     M     control         23
## 2 Ann     F     control         31
## 3 Jill    F     control         30
## 4 Ann     F     experiment_1    38
## 5 Jill    F     experiment_1    36
## 6 Ann     F     experiment_2    42
## 7 Jill    F     experiment_2    44</code></pre>
<p>Filtering with regular expression: we keep the rows where <em>subject</em> starts with the letter “T”</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">filter</span>(subject<span class="sc">==</span>(<span class="fu">str_subset</span>(subject, <span class="st">&quot;^T&quot;</span>))) </span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   subject sex   variable     value
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;
## 1 Tim     M     control         23
## 2 Tim     M     experiment_1    34
## 3 Tim     M     experiment_2    40</code></pre>
<p>As you can see there are endless vistas here, open for a regular expression fanatic. I so wish I was one!</p>
</div>
<div id="summarise" class="section level3">
<h3>summarise</h3>
<p>Summarise does just that</p>
<p>Here we generate common summary statistics for our value variable. This is all right in a limited sort of way.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">MEAN=</span> <span class="fu">mean</span>(value), <span class="at">SD=</span> <span class="fu">sd</span>(value), <span class="at">MAD=</span><span class="fu">mad</span>(value), <span class="at">N=</span> <span class="fu">n</span>(), <span class="at">unique_values_sex=</span> <span class="fu">n_distinct</span>(sex))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##    MEAN    SD   MAD     N unique_values_sex
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;             &lt;int&gt;
## 1  35.3  6.61  7.41     9                 2</code></pre>
<p>To do something more exiting we must first group our observations by some facto(s) levels.</p>
</div>
<div id="group_by" class="section level3">
<h3>group_by</h3>
<p>Groups values for summarising or mutating</p>
<p>When we summarise by <em>sex</em> we will get two values for each summary statistic: for males and females. Aint that sexy?!</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">MEAN=</span> <span class="fu">mean</span>(value), <span class="at">SD=</span> <span class="fu">sd</span>(value), <span class="at">MAD=</span><span class="fu">mad</span>(value), <span class="at">N=</span> <span class="fu">n</span>(), <span class="at">unique_values_sex=</span> <span class="fu">n_distinct</span>(sex))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   sex    MEAN    SD   MAD     N unique_values_sex
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;             &lt;int&gt;
## 1 F      36.8  5.67  8.15     6                 1
## 2 M      32.3  8.62  8.90     3                 1</code></pre>
<p>Now we group first by <em>variable</em> and then inside each group again by <em>sex</em>. This is getting complicated …</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(variable, sex) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">MEAN=</span> <span class="fu">mean</span>(value), <span class="at">SD=</span> <span class="fu">sd</span>(value), <span class="at">MAD=</span><span class="fu">mad</span>(value), <span class="at">N=</span> <span class="fu">n</span>(), <span class="at">unique_values_sex=</span> <span class="fu">n_distinct</span>(sex))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;variable&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 6 x 7
## # Groups:   variable [3]
##   variable     sex    MEAN     SD   MAD     N unique_values_sex
##   &lt;fct&gt;        &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;             &lt;int&gt;
## 1 control      F      30.5  0.707 0.741     2                 1
## 2 control      M      23   NA     0         1                 1
## 3 experiment_1 F      37    1.41  1.48      2                 1
## 4 experiment_1 M      34   NA     0         1                 1
## 5 experiment_2 F      43    1.41  1.48      2                 1
## 6 experiment_2 M      40   NA     0         1                 1</code></pre>
<p>Now we group first by sex and then by variable. Spot the difference!</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sex, variable) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">MEAN=</span> <span class="fu">mean</span>(value), <span class="at">SD=</span> <span class="fu">sd</span>(value), <span class="at">MAD=</span><span class="fu">mad</span>(value), <span class="at">N=</span> <span class="fu">n</span>(), <span class="at">unique_values_sex=</span> <span class="fu">n_distinct</span>(sex))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;sex&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 6 x 7
## # Groups:   sex [2]
##   sex   variable      MEAN     SD   MAD     N unique_values_sex
##   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;             &lt;int&gt;
## 1 F     control       30.5  0.707 0.741     2                 1
## 2 F     experiment_1  37    1.41  1.48      2                 1
## 3 F     experiment_2  43    1.41  1.48      2                 1
## 4 M     control       23   NA     0         1                 1
## 5 M     experiment_1  34   NA     0         1                 1
## 6 M     experiment_2  40   NA     0         1                 1</code></pre>
<p>Here we group and then mutate (meaning that the resulting table has as many rows — but more column — than the original table).</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">normalised.value=</span>value<span class="sc">/</span><span class="fu">mean</span>(value), <span class="at">n2.val=</span>value<span class="sc">/</span><span class="fu">sd</span>(value))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 6
## # Groups:   sex [2]
##   subject sex   variable     value normalised.value n2.val
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;            &lt;dbl&gt;  &lt;dbl&gt;
## 1 Tim     M     control         23            0.711   2.67
## 2 Ann     F     control         31            0.842   5.47
## 3 Jill    F     control         30            0.814   5.29
## 4 Tim     M     experiment_1    34            1.05    3.94
## 5 Ann     F     experiment_1    38            1.03    6.70
## 6 Jill    F     experiment_1    36            0.977   6.35
## 7 Tim     M     experiment_2    40            1.24    4.64
## 8 Ann     F     experiment_2    42            1.14    7.41
## 9 Jill    F     experiment_2    44            1.19    7.76</code></pre>
<p>Compare with a “straight” mutate to note the difference in values.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">normalised.value=</span>value<span class="sc">/</span><span class="fu">mean</span>(value), <span class="at">n2.val=</span>value<span class="sc">/</span><span class="fu">sd</span>(value))</span></code></pre></div>
<pre><code>## # A tibble: 9 x 6
##   subject sex   variable     value normalised.value n2.val
##   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;            &lt;dbl&gt;  &lt;dbl&gt;
## 1 Tim     M     control         23            0.651   3.48
## 2 Ann     F     control         31            0.877   4.69
## 3 Jill    F     control         30            0.849   4.54
## 4 Tim     M     experiment_1    34            0.962   5.14
## 5 Ann     F     experiment_1    38            1.08    5.75
## 6 Jill    F     experiment_1    36            1.02    5.44
## 7 Tim     M     experiment_2    40            1.13    6.05
## 8 Ann     F     experiment_2    42            1.19    6.35
## 9 Jill    F     experiment_2    44            1.25    6.65</code></pre>
<!-- ## A more realistic example: -->
<!-- Its not unheard of of one having to analyse a table with less than perfect structure. Yes, life really does suck. Here some column names need to be renamed for consistency, an empty column has to be dropped and column *OTU* must be cleansed from NAs. We will also convert the df to tibble. -->
<!-- ```{r} -->
<!-- y1 <- read.csv("/Users/ulomaivali/Dropbox/Viia kartul/Viia_original.csv") -->
<!-- y1<- y1 %>% rename(KARS2=KARS2.7, TS1=TS1.26, kars1=karS1) %>% -->
<!--   select(-Col53)%>% -->
<!--   drop_na(OTU) %>%  -->
<!--   as_data_frame() -->
<!-- names(y1)  -->
<!-- y1 -->
<!-- ``` -->
<!-- Woeh, it wasnt too bad, I guess. -->
<!-- Next we drop the first col *X*, which kind of popped up unannounced, and melt the table. -->
<!-- ```{r} -->
<!-- y2<-y1[,-1] %>% melt -->
<!-- as_data_frame(y2) -->
<!-- ``` -->
<!-- This is the explicit melt - same result. -->
<!-- ```{r} -->
<!-- y3<-y1[,-1] %>% melt(id.vars=c("OTU","TAXON.ID"),   # all the variables to keep, but not split apart  -->
<!--                 variable.name="experiment", # Name of the destination column for factors that are taken from names of melted columns -->
<!--                 value.name="nr.of.counts" # name of the newly made single value column -->
<!-- )%>% as_data_frame() -->
<!-- y3 -->
<!-- ``` -->
<!-- or tidyr::gather - same result again -->
<!-- ```{r} -->
<!-- y4<-y1 %>% gather(key="experiment", value="nr.of.counts", 4:ncol(y1)) %>% select(-X) -->
<!-- y4 -->
<!-- all.equal(y3, y4) -->
<!-- ``` -->
<!-- and dcast to cast the table back into wide format... -->
<!-- (This is just for show --- in reality we usually work with a porpose in mind.) -->
<!-- ```{r} -->
<!-- w1<-y4%>% dcast(OTU+TAXON.ID~experiment) %>% as_data_frame() -->
<!-- w1 -->
<!-- ``` -->
<!-- or tidyr::spread --- same result -->
<!-- ```{r} -->
<!-- w2<-y4 %>% spread(key=experiment, value=nr.of.counts) %>% as_data_frame() -->
<!-- w2 -->
<!-- ``` -->
<!-- and finally, tidyr::separate sepatates the content of the column *TAXON.ID* into several columns -->
<!-- ```{r} -->
<!-- y5<-y4%>%separate(TAXON.ID, c("riik", "hmk", "klass", "selts", "sgk", "prk", "liik"), sep=';', extra="merge") -->
<!-- y5 -->
<!-- ``` -->
</div>
</div>
</div>
<div id="ggplot2" class="section level1">
<h1>ggplot2</h1>
<p><strong>ggplot2</strong> is an R package for producing statistical graphics based on the grammar of graphics (hence the gg!).</p>
<ul>
<li><strong>ggplot2 works iteratively</strong> – you start with a layer showing the raw data and then add layers of geoms, annotations, and statistical summaries.</li>
</ul>
<p>To compose plots, you have to supply minimally:</p>
<ul>
<li><strong>Data</strong> that you want to visualise and <strong>aes</strong>thetic mappings – what’s on x-axis, what’s on y-axis, and how to you want to group and color your data.</li>
<li><strong>Layers</strong> made up of <strong>geom</strong>etric elements: points, lines, boxes, etc.</li>
</ul>
<p>You can further adjust your plot:</p>
<ul>
<li>by adding <strong>statistical summaries</strong> of your raw data.</li>
<li>using <strong>scale</strong>s to redraw a legend or axes.</li>
<li>using <strong>facet</strong>ing to break up the data into subsets for display.</li>
<li>using <strong>theme</strong>s which control plot features like the font size and background colour.</li>
</ul>
<p>ggplot2 is different from base graphics:</p>
<ul>
<li>Plots created by base graphics appear only on the screen and you cannot assign plot to an object for later use. Everything is created in place.</li>
<li>You can only draw on top of the plot, you cannot modify or delete existing content.</li>
</ul>
<p>That was theory, you can read more from <a href="https://github.com/hadley/ggplot2-book">ggplot2-book</a>, this is where rubber meets the road:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># load ggplot2 library</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># dplyr is necessary for piping operator and for some data munging</span></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code></pre></div>
<p>We use ggplot2 builtin dataset <code>mpg</code> with fuel economy data from 1999 and 2008 for 38 models of car:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a>mpg</span></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model    displ  year   cyl trans   drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4         1.8  1999     4 auto(l… f        18    29 p     comp…
##  2 audi         a4         1.8  1999     4 manual… f        21    29 p     comp…
##  3 audi         a4         2    2008     4 manual… f        20    31 p     comp…
##  4 audi         a4         2    2008     4 auto(a… f        21    30 p     comp…
##  5 audi         a4         2.8  1999     6 auto(l… f        16    26 p     comp…
##  6 audi         a4         2.8  1999     6 manual… f        18    26 p     comp…
##  7 audi         a4         3.1  2008     6 auto(a… f        18    27 p     comp…
##  8 audi         a4 quat…   1.8  1999     4 manual… 4        18    26 p     comp…
##  9 audi         a4 quat…   1.8  1999     4 auto(l… 4        16    25 p     comp…
## 10 audi         a4 quat…   2    2008     4 manual… 4        20    28 p     comp…
## # … with 224 more rows</code></pre>
<p>Key variables in <code>mpg</code> dataset are <code>displ</code> – engine displacement (L), <code>cyl</code> – number of cylinders, <code>cty</code> – city miles per gallon, <code>hwy</code> – highway miles per gallon.</p>
<p>Simple scatterplot to explore relationship between fuel consumption in city traffick (cty) and engine size (displ) is created like this:</p>
<pre class="{r}s"><code>ggplot(mpg, aes(displ, cty)) + geom_point()</code></pre>
<p><strong>Notice that</strong>: in ggplot first two unnamed arguments to <code>aes()</code> are <code>x</code> and <code>y</code>, so we can easily skip <code>x =</code> and <code>y =</code> to reduce typing.</p>
<div id="scatterplot-1" class="section level2">
<h2>Scatterplot</h2>
<p>To illustrate layerwise plot creation in ggplot:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="co"># first add data</span></span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy) <span class="co"># add aesthetics</span></span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="co"># add geom, specifying plot type </span></span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="co"># add statistical summary</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-164-1.png" width="672" style="display: block; margin: auto;" /> The <strong>point geom is used to create scatterplots</strong>.</p>
<p>Of course, this result is usually achieved by this oneliner:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(cty, hwy)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
</div>
<div id="color-size-shape-and-fill" class="section level2">
<h2>Color, size, shape, and fill</h2>
<p>Other aesthetics like <code>color</code>, <code>shape</code>, <code>fill</code>, and <code>size</code> can be used to add additional variables to a plot:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(cty, hwy, <span class="at">color =</span> drv)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="co"># &#39;colour=&#39; can be used too</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-166-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="point-shape-codes" class="section level2">
<h2>Point shape codes</h2>
<p>While colors and sizes are intuitive, it seems impossible to remember available point shape codes in R. The quickest way out of this is to know how to generate an example plot of the shapes quickly. <a href="http://www.win-vector.com/blog/2012/04/how-to-remember-point-shape-codes-in-r/">This is how to do this in ggplot2.</a></p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">25</span>))) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">8</span>, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>x,<span class="at">shape=</span>x)) <span class="sc">+</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> x, <span class="at">scales=</span><span class="st">&#39;free&#39;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&#39;&#39;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&#39;&#39;</span>) <span class="sc">+</span></span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_identity</span>() <span class="sc">+</span></span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_blank</span>(), <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb396-5"><a href="#cb396-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks=</span><span class="fu">element_blank</span>(), <span class="at">legend.position=</span><span class="st">&#39;none&#39;</span>,</span>
<span id="cb396-6"><a href="#cb396-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb396-7"><a href="#cb396-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(),</span>
<span id="cb396-8"><a href="#cb396-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border=</span><span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-167-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="facetting" class="section level2">
<h2>Facetting</h2>
<p>Another possibility to add more variables is to use <code>facet_wrap</code>:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(cty, hwy)) <span class="sc">+</span> </span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> drv) <span class="co"># to specify name of a variable preceded by  ̃</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-168-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Two-way table can be created using <code>facet_grid</code> command:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(cty, hwy)) <span class="sc">+</span> </span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> drv) <span class="co"># to specify row variable ̃column variable</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-169-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="modify-axes-start-y-or-x-axis-at-zero" class="section level2">
<h2>Modify axes, start y or x axis at zero</h2>
<p>Axis labels can be changed using <code>xlab()</code> and <code>ylab()</code>:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;City driving (miles per gallon)&quot;</span>) <span class="sc">+</span> <span class="co"># to set x axis label</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Highway driving (miles per gallon)&quot;</span>) <span class="co"># to set y axis label</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-170-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The other way around, to remove axis leables, set them to <code>NULL</code>:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-171-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In many cases proper visual representation of data requires that e.g. y axis starts from zero. By default, ggplot zooms only into region where data is located and 0 is dropped from axes. To change this behaviour, ggplot has command <code>expand_limits()</code> specifying the value(-s) that should be included in each scale:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>) <span class="co"># upper and lower axis limits can be specified by supplying vector of two values</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-172-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><code>scale_x_continuous()</code> and <code>scale_y_continuous()</code> have argument limits, which can be used to set axis limits, but values remaining outside limits will be set to <code>NA</code>:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 145 rows containing missing values (geom_point).</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-173-1.png" width="672" style="display: block; margin: auto;" /> Note the warning!</p>
<p>More simply, we can use <code>xlim()</code> and <code>ylim()</code>:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">15</span>, <span class="dv">20</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">30</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 119 rows containing missing values (geom_point).</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-174-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="ggsave-plot" class="section level2">
<h2>ggsave plot</h2>
<p><code>ggsave</code> recognises .eps/ps, .tex (pictex), .pdf, .jpeg, .tiff, .png, .bmp, .svg, and .wmf (windows only) file extensions. To save a plot <code>p</code> to e.g. as <code>.png</code> file use:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;graphs/my_biutiful_plot.png&quot;</span>, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>By default <code>plot=</code> is the last plot.</p>
</div>
<div id="histograms" class="section level2">
<h2>Histograms</h2>
<p>Differently from base R graphics, where histogram is drawn by a special command, ggplot specifies the type of plot by geoms, like <code>geom_histogram()</code>:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>)) <span class="co"># For demo we create tibble with 10000 random numbers from normal distribution</span></span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="co"># to plot histogram we specify geom_histogram </span></span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-176-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>ggplot says: <code>stat_bin()</code> using <code>bins = 30</code>. Pick better value with <code>binwidth</code>, also help file notes that ‘the default is to use bins bins that cover the range of the data. You should always override this value, exploring multiple widths to find the best to illustrate the stories in your data’. OK, Messy Goes to Okido, lets try:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>) <span class="co"># for better granularity, we specify binwith = 0.1</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-177-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Alternatively, you can specify the number of bins (and perhaps send some hidden messages along with your visualisation):</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">5</span>) <span class="co"># if we want to split data into eg. 5 bins</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-178-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>For some more practice, lets recreate Tartu Marathon 2013 histogram:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/Tartu_Maraton_2013.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a>tm <span class="ot">&lt;-</span> tm_2013 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Aeg =</span> <span class="fu">unclass</span>(<span class="fu">as.duration</span>(<span class="fu">hms</span>(Aeg)))<span class="sc">/</span><span class="dv">3600</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.))</span></code></pre></div>
<pre><code>## Warning in .parse_hms(..., order = &quot;HMS&quot;, quiet = quiet): Some strings failed to
## parse, or all strings are NAs</code></pre>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a>tm <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(Aeg)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>) <span class="co"># we want binwidth ~5 minutes (1/12 hour)</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-180-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>These were histograms with counts on y-axis, but we may want to plot (kernel) density instead, for this we use <code>geom_density()</code>:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-181-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Histogram with densities on y-axis:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, ..density..)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-182-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Kernel density plot and histogram together:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, ..density..)) <span class="sc">+</span> </span>
<span id="cb418-2"><a href="#cb418-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb418-3"><a href="#cb418-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-183-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x)) <span class="sc">+</span> </span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="co"># note that we specify density here, </span></span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">binwidth =</span> <span class="fl">0.1</span>, </span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb419-6"><a href="#cb419-6" aria-hidden="true" tabindex="-1"></a>p <span class="co"># we disrected plot to object</span></span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-184-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can add vertical line, denoting mean, to our histogram like this:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(x)), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) </span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-185-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>To compare distributions</strong> we can overlay histograms and density plots. To demonstrate this, let’s create dummy dataset of two normal distributions:</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pop =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;S&quot;</span>), <span class="at">each =</span> <span class="dv">1000</span>), </span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">20</span>, <span class="dv">3</span>), <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">25</span>, <span class="dv">3</span>)))</span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div>
<pre><code>## # A tibble: 2,000 x 2
##    pop   value
##    &lt;chr&gt; &lt;dbl&gt;
##  1 N      18.4
##  2 N      14.6
##  3 N      19.6
##  4 N      20.5
##  5 N      25.5
##  6 N      23.4
##  7 N      19.2
##  8 N      21.1
##  9 N      19.3
## 10 N      23.5
## # … with 1,990 more rows</code></pre>
<p>When overlaying histograms in ggplot, default action is to ‘stack’ them one to another, making comparison difficult. We have to specify <code>position = "identity"</code> to place them directly onto x-axis (each bar starts from y = 0). Also we specify <code>alpha =</code> for some transparency:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(value, <span class="at">fill =</span> pop)) </span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">binwidth =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-187-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Alternatively, it’s possible to place comparable bars next to each other by specifying <code>position = "dodge"</code>:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">binwidth =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-188-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Overlaid kernel density plots:</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>)</span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a>p2</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-189-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>To indicate means for these two distributions, we have to calculate means into a new data frame:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a>df2_stats <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(pop) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">pop_mean =</span> <span class="fu">mean</span>(value))</span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">data =</span> df2_stats, <span class="fu">aes</span>(<span class="at">xintercept =</span> pop_mean, <span class="at">color =</span> pop), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-190-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="boxplots" class="section level2">
<h2>Boxplots</h2>
<p><strong>Boxplots</strong> are created using <code>geom_boxplot</code>:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(pop, value)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-191-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(pop, value, <span class="at">fill =</span> pop)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a>p3</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-192-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Often, it’s a good idea to overlay original values to plot. Specially, if there is only few values. Let’s add original data points to previous boxplot:</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-193-1.png" width="672" style="display: block; margin: auto;" /> Adding geom_points was not very helpful in this case. s We can try to jitter these points, where argument <code>width=</code> specifies jitter width (default full boxplot width):</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-194-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As shown previously, we can also add summary data (mean) to this plot (large red dots):</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> df2_stats, <span class="fu">aes</span>(<span class="at">y =</span> pop_mean), <span class="at">shape =</span> <span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-195-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-means-and-error-bars" class="section level2">
<h2>Plotting means and error bars</h2>
<p>Summaries and e.g. errorbars can also be calculated on the fly. To illustrate this, we take first smaller sample from our dataset in order to have larger errorbars. Here we add bootstrapped 99% confidence intervals of the mean:</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">50</span>) <span class="sc">%&gt;%</span> <span class="co"># to have larger error</span></span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(pop, value, <span class="at">fill =</span> pop)) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) </span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a>p4 <span class="sc">+</span> <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">&quot;mean_cl_boot&quot;</span>, <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">conf.int =</span> .<span class="dv">99</span>), <span class="at">geom =</span> <span class="st">&quot;pointrange&quot;</span>) <span class="co"># poinrange is default geom </span></span></code></pre></div>
<pre><code>## Warning: Computation failed in `stat_summary()`:
## The `Hmisc` package is required.</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-196-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Here we add errorbars, denoting standard error of the mean:</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> p4 <span class="sc">+</span> <span class="fu">stat_summary</span>(<span class="at">fun.y =</span> mean, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">shape =</span> <span class="dv">95</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span> <span class="co"># mean</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_se, <span class="at">geom =</span> <span class="st">&quot;errorbar&quot;</span>, <span class="at">width =</span> <span class="fl">0.25</span>) <span class="co"># standard deviation</span></span></code></pre></div>
<pre><code>## Warning: `fun.y` is deprecated. Use `fun` instead.</code></pre>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a>p4</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-197-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="linegraphs" class="section level2">
<h2>Linegraphs</h2>
<p>Now we create line graphs with errorbars, we use <code>mpg</code> data. We calculate mean and standard error of the mean for highway fuel consumption (hwy) per year and per number of cylinders:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a>mpg_sum <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span> </span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cyl <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>)) <span class="sc">%&gt;%</span>  <span class="co"># to include only comparable values</span></span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, cyl) <span class="sc">%&gt;%</span> <span class="co"># to compare two years</span></span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_hwy =</span> <span class="fu">mean</span>(hwy), <span class="co"># to calculate mean</span></span>
<span id="cb437-5"><a href="#cb437-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">N =</span> <span class="fu">n</span>(), <span class="co"># N to calculate standard error</span></span>
<span id="cb437-6"><a href="#cb437-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_hwy =</span> <span class="fu">sd</span>(cty)<span class="sc">/</span><span class="fu">sqrt</span>(N)) <span class="co"># standard error</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a>mpg_sum</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
## # Groups:   year [2]
##    year   cyl mean_hwy     N se_hwy
##   &lt;int&gt; &lt;int&gt;    &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
## 1  1999     4     28.4    45  0.632
## 2  1999     6     22.3    45  0.249
## 3  1999     8     17.0    27  0.317
## 4  2008     4     29.3    36  0.382
## 5  2008     6     23.5    34  0.327
## 6  2008     8     18      43  0.287</code></pre>
<p><code>geom_line()</code> is used to create linegraphs in ggplot. We want two distinct colors for year variable, therefore we coerce year to factor:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> mpg_sum <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(cyl, mean_hwy, <span class="at">color =</span> <span class="fu">factor</span>(year))) </span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a>p5 <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-199-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Errorbars can be added by using <code>geom_errorbar</code>, which needs arguments <code>ymin</code> and <code>ymax</code>:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a>p5 <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_hwy <span class="sc">+</span> se_hwy, <span class="at">ymax =</span> mean_hwy <span class="sc">-</span> se_hwy), <span class="at">width =</span> <span class="fl">0.25</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-200-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>When the errorbars overlap, use <code>position_dodge</code> to move them horizontally.</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">position_dodge</span>(<span class="fl">0.7</span>) <span class="co"># move them </span></span></code></pre></div>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a>p5 <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">position =</span> pd) <span class="sc">+</span> </span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">position =</span> pd) <span class="sc">+</span></span>
<span id="cb444-3"><a href="#cb444-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_hwy <span class="sc">+</span> se_hwy, <span class="at">ymax =</span> mean_hwy <span class="sc">-</span> se_hwy), </span>
<span id="cb444-4"><a href="#cb444-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">width =</span> <span class="fl">0.25</span>, </span>
<span id="cb444-5"><a href="#cb444-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">position =</span> pd)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-202-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="bargraphs-1" class="section level2">
<h2>Bargraphs</h2>
<p>Bargraphs are created using <code>geom_bar</code> and default stat <code>counts</code> needs to changed to <code>identity</code>:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> mpg_sum <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1999</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb445-2"><a href="#cb445-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">factor</span>(cyl), mean_hwy))</span>
<span id="cb445-3"><a href="#cb445-3" aria-hidden="true" tabindex="-1"></a>p6 <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-203-1.png" width="672" style="display: block; margin: auto;" /> Note that bargraph starts at 0.</p>
<p>When adding additional variables to a bargraphs e.g. via <code>fill =</code> you need also unstack the bars by specifying <code>position = position_dodge()</code>:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>) </span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> mpg_sum <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">factor</span>(cyl), mean_hwy, <span class="at">fill =</span> <span class="fu">factor</span>(year)))</span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> p6 <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> pd)</span>
<span id="cb446-4"><a href="#cb446-4" aria-hidden="true" tabindex="-1"></a>p7</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-204-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a>p7 <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_hwy <span class="sc">-</span> se_hwy, <span class="at">ymax =</span> mean_hwy <span class="sc">+</span> se_hwy),</span>
<span id="cb447-2"><a href="#cb447-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">position =</span> pd, <span class="at">width =</span> <span class="fl">0.25</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-205-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="merging-tables" class="section level1">
<h1>Merging tables</h1>
<div id="combine-by-rows-and-columns" class="section level2">
<h2>Combine by rows and columns</h2>
<p>Base R <code>rbind</code> and <code>cbind</code> <strong>take in a sequence of vector, matrix or data-frame</strong> and combine by rows or columns, respectively. Meaning that if you want to combine only data frames you have also option to use Hadleyverse’s <code>dplyr::bind_rows</code> or <code>dplyr::bind_cols</code>. Otherwise, if playing around with vectors and/or matrices too, you have to stick with base R functions.</p>
<p>Don’t try to understand this excerpt from help: for <code>rbind</code> column names are taken from the first argument with appropriate names: colnames for a matrix, or names for a vector of length the number of columns of the result.</p>
<p>To illustrate combining two data.frames by rowwise we first subset <code>mtcars</code> dataset into two mini dataframes:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mtcars)</span></code></pre></div>
<pre><code>## [1] 32 11</code></pre>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a>df1</span></code></pre></div>
<pre><code>##               mpg  hp
## Mazda RX4      21 110
## Mazda RX4 Wag  21 110</code></pre>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> mtcars[<span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)]</span>
<span id="cb452-2"><a href="#cb452-2" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div>
<pre><code>##             mpg  hp
## Merc 280C  17.8 123
## Merc 450SE 16.4 180
## Merc 450SL 17.3 180</code></pre>
<p>Combine by rows using base R <code>rbind</code>, <strong>columns need to match</strong>:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(df1, df2)</span></code></pre></div>
<pre><code>##                mpg  hp
## Mazda RX4     21.0 110
## Mazda RX4 Wag 21.0 110
## Merc 280C     17.8 123
## Merc 450SE    16.4 180
## Merc 450SL    17.3 180</code></pre>
<p>Hadleyverse’s verb to perform this task is <code>bind_rows</code>, however note that <code>bind_rows</code> (<code>bind_cols</code>) <strong>needs data frames</strong> (NO vectors or matrices!):</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(df1, df2) </span></code></pre></div>
<pre><code>##                mpg  hp
## Mazda RX4     21.0 110
## Mazda RX4 Wag 21.0 110
## Merc 280C     17.8 123
## Merc 450SE    16.4 180
## Merc 450SL    17.3 180</code></pre>
<p>Neat feature of the <code>bind_rows</code> function is that when you supply a column name with the <code>.id=</code> argument, a new column is created to link each row to its original data frame:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="at">df1 =</span> df1, <span class="at">df2 =</span> df2, <span class="at">.id =</span> <span class="st">&quot;id&quot;</span>)</span></code></pre></div>
<pre><code>##                id  mpg  hp
## Mazda RX4     df1 21.0 110
## Mazda RX4 Wag df1 21.0 110
## Merc 280C     df2 17.8 123
## Merc 450SE    df2 16.4 180
## Merc 450SL    df2 17.3 180</code></pre>
<p><strong>Columns don’t need to match</strong> when row-binding using <code>bind_rows</code>, missing values are filled with <code>NA</code>-s:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="at">df1 =</span> df1, </span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">df2 =</span> mtcars[<span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">6</span>)], </span>
<span id="cb460-3"><a href="#cb460-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">df3 =</span> mtcars[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>)],</span>
<span id="cb460-4"><a href="#cb460-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">.id =</span> <span class="st">&quot;id&quot;</span>)</span></code></pre></div>
<pre><code>##                    id  mpg  hp    wt
## Mazda RX4         df1 21.0 110    NA
## Mazda RX4 Wag     df1 21.0 110    NA
## Merc 280C         df2 17.8 123 3.440
## Merc 450SE        df2 16.4 180 4.070
## Merc 450SL        df2 17.3 180 3.730
## Hornet 4 Drive    df3 21.4  NA 3.215
## Hornet Sportabout df3 18.7  NA 3.440
## Valiant           df3 18.1  NA 3.460</code></pre>
<p>If you have <strong>data frames or tibbles in a list</strong>, then you can bind them rowwise into one data frame.</p>
<p>Here we first create list with two dataframes:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a>df_list <span class="ot">&lt;-</span> <span class="fu">list</span>(df1, df2)</span>
<span id="cb462-2"><a href="#cb462-2" aria-hidden="true" tabindex="-1"></a>df_list</span></code></pre></div>
<pre><code>## [[1]]
##               mpg  hp
## Mazda RX4      21 110
## Mazda RX4 Wag  21 110
## 
## [[2]]
##             mpg  hp
## Merc 280C  17.8 123
## Merc 450SE 16.4 180
## Merc 450SL 17.3 180</code></pre>
<p><code>do.call(rbind, my_list_of_dataframes)</code> is base R solution to this task, but you need data frames with same column names:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(rbind, df_list) <span class="co"># bind dataframes in list by rows</span></span></code></pre></div>
<pre><code>##                mpg  hp
## Mazda RX4     21.0 110
## Mazda RX4 Wag 21.0 110
## Merc 280C     17.8 123
## Merc 450SE    16.4 180
## Merc 450SL    17.3 180</code></pre>
<p><code>bind_rows</code> argument can also be a <strong>list of data frames</strong>, and again, columns are matched by name, and any values that don’t match will be filled with <code>NA</code>-s:</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a>df_list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">df1 =</span> df1, </span>
<span id="cb466-2"><a href="#cb466-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">df2 =</span> mtcars[<span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">6</span>)], </span>
<span id="cb466-3"><a href="#cb466-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">df3 =</span> mtcars[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>)])</span>
<span id="cb466-4"><a href="#cb466-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(df_list2, <span class="at">.id =</span> <span class="st">&quot;id&quot;</span>)</span></code></pre></div>
<pre><code>##                    id  mpg  hp    wt
## Mazda RX4         df1 21.0 110    NA
## Mazda RX4 Wag     df1 21.0 110    NA
## Merc 280C         df2 17.8 123 3.440
## Merc 450SE        df2 16.4 180 4.070
## Merc 450SL        df2 17.3 180 3.730
## Hornet 4 Drive    df3 21.4  NA 3.215
## Hornet Sportabout df3 18.7  NA 3.440
## Valiant           df3 18.1  NA 3.460</code></pre>
<p>Combining two vectors of same length columnwise results in matrix (similar to rbind):</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,] &quot;a&quot;  &quot;1&quot; 
## [2,] &quot;b&quot;  &quot;2&quot; 
## [3,] &quot;c&quot;  &quot;3&quot; 
## [4,] &quot;d&quot;  &quot;4&quot; 
## [5,] &quot;e&quot;  &quot;5&quot;</code></pre>
<p>When combining vectors with different lengths, the shorter one is recycled:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="co"># the &#39;1&#39; (= shorter vector) is recycled</span></span>
<span id="cb470-2"><a href="#cb470-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    1
## [2,]    1    2
## [3,]    1    3
## [4,]    1    4
## [5,]    1    5
## [6,]    1    6
## [7,]    1    7</code></pre>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>) <span class="co"># same applies to rbind</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    1    2    3    4    5    6
## [2,]    7    8    7    8    7    8</code></pre>
<p>Columns can be inserted by specifing order of colums in the index:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(m, <span class="dv">8</span><span class="sc">:</span><span class="dv">14</span>)[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)] <span class="co"># insert a column</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    8    1
## [2,]    1    9    2
## [3,]    1   10    3
## [4,]    1   11    4
## [5,]    1   12    5
## [6,]    1   13    6
## [7,]    1   14    7</code></pre>
<p>When the arguments consist of a mix of matrices and vectors the number of rows of the result is determined by the number of rows of the matrix arguments:</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="fu">matrix</span>(<span class="dv">11</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">nrow =</span> <span class="dv">3</span>)) <span class="co"># vector is subset -&gt; warning</span></span></code></pre></div>
<pre><code>## Warning in cbind(1:7, matrix(11:16, nrow = 3)): number of rows of result is not
## a multiple of vector length (arg 1)</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1   11   14
## [2,]    2   12   15
## [3,]    3   13   16</code></pre>
<p>When column-binding, rows are matched by position, not value so all data frames must have the same number of rows:</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(df1, mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>])</span></code></pre></div>
<pre><code>##               mpg  hp drat    wt
## Mazda RX4      21 110  3.9 2.620
## Mazda RX4 Wag  21 110  3.9 2.875</code></pre>
<p>Summary:</p>
<ul>
<li><code>rbind</code>, <code>cbind</code> take in vectors, matrices and data frames.</li>
<li><code>bind_rows</code>, <code>bind_cols</code> – <strong>data frames only</strong>.</li>
<li>with <code>rbind</code> column names must match as well numbers of columns.</li>
<li><code>bind_rows</code> handles non-matching cols and rows with ease.</li>
<li>in case of combining vector with array, <code>cbind</code> handles non-matching vector length with row number and recycles or subsets vector if necessary.</li>
<li><code>bind_cols</code> need same number of rows in data frames.</li>
<li>whatever you combine, onus is on you to ensure that proper rows and columns get combined, when they get combined.</li>
</ul>
</div>
<div id="joins" class="section level2">
<h2>Joins</h2>
<p>During data analysis you find out quite often that your data is lying around in multiple tables and you need to combine these sets. In <code>dplyr</code>, <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/two-table.html">there are three families of verbs</a> that work with two tables at a time:</p>
<ul>
<li>Mutating joins, which add new variables to one table from matching rows in another.</li>
<li>Filtering joins, which filter observations from one table based on whether or not they match an observation in the other table.</li>
<li>Set operations, which combine the observations in the data sets as if they were set elements.</li>
</ul>
<p>To illustrate joining, let’s consider <a href="http://www.ester.ee/record=b2697405*est">following data</a>. Here we have day of travel, city, and population.</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb481-2"><a href="#cb481-2" aria-hidden="true" tabindex="-1"></a>trip <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">day =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>), <span class="at">city =</span> <span class="fu">c</span>(<span class="st">&quot;Teheran&quot;</span>, <span class="st">&quot;Qom&quot;</span>, <span class="st">&quot;Esfahan&quot;</span>, <span class="st">&quot;Persepolis&quot;</span>, <span class="st">&quot;Shiraz&quot;</span>, <span class="st">&quot;Bandar&quot;</span>, <span class="st">&quot;Karaj&quot;</span>, <span class="st">&quot;Tabriz&quot;</span>), <span class="at">pop =</span> <span class="fu">c</span>(<span class="dv">8846782</span>,<span class="dv">1374036</span>,<span class="dv">1945765</span>,<span class="cn">NA</span>,<span class="dv">1460665</span>,<span class="dv">212</span>,<span class="dv">1967005</span>,<span class="dv">1549453</span>))</span>
<span id="cb481-3"><a href="#cb481-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trip)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##     day city           pop
##   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1     1 Teheran    8846782
## 2     2 Qom        1374036
## 3     3 Esfahan    1945765
## 4     4 Persepolis      NA
## 5     5 Shiraz     1460665
## 6     6 Bandar         212</code></pre>
<p>Next table we have hotels with addresses for some of the cities.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a>hotels <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">city =</span> <span class="fu">c</span>(<span class="st">&quot;Teheran&quot;</span>, <span class="st">&quot;Qom&quot;</span>, <span class="st">&quot;Esfahan&quot;</span>, <span class="st">&quot;Persepolis&quot;</span>, <span class="st">&quot;Shiraz&quot;</span>, <span class="st">&quot;Bandar&quot;</span>), <span class="at">hotel =</span> <span class="fu">c</span>(<span class="st">&quot;Firouzeh Hotel&quot;</span>, <span class="st">&quot;Aria Hotel&quot;</span>, <span class="st">&quot;Amir Kabir Hotel&quot;</span>, <span class="st">&quot;Sita Aukh Guest House&quot;</span>, <span class="st">&quot;Anvari Hotel&quot;</span>, <span class="st">&quot;Bolivar Inn&quot;</span>), <span class="at">address =</span> <span class="fu">c</span>(<span class="st">&quot;Dowlat Abad Alley&quot;</span>, <span class="st">&quot;Astane Square&quot;</span>, <span class="st">&quot;Chahar Bagh Abbasi Street&quot;</span>, <span class="st">&quot;Tume Junn Mohammad Street&quot;</span>, <span class="st">&quot;Anvari Street&quot;</span>, <span class="st">&quot;Abuzar Street&quot;</span>))</span>
<span id="cb483-2"><a href="#cb483-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hotels)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   city       hotel                 address                  
##   &lt;chr&gt;      &lt;chr&gt;                 &lt;chr&gt;                    
## 1 Teheran    Firouzeh Hotel        Dowlat Abad Alley        
## 2 Qom        Aria Hotel            Astane Square            
## 3 Esfahan    Amir Kabir Hotel      Chahar Bagh Abbasi Street
## 4 Persepolis Sita Aukh Guest House Tume Junn Mohammad Street
## 5 Shiraz     Anvari Hotel          Anvari Street            
## 6 Bandar     Bolivar Inn           Abuzar Street</code></pre>
<div id="mutating-joins" class="section level3">
<h3>Mutating joins</h3>
<p>We use <code>dplyr</code> <code>left_join</code> and <code>inner_join</code> functions to combine these tables by explicitly specifying column/variable ‘by = “city”’ (e.g. in order to guarantee consistent behaviour when number of columns in our data frame can vary in our script). If keep default ‘by = NULL’, then two datasets are combined by all matching columns.</p>
<p><code>left_join</code> returns all rows from trip where there are matching values in trip, and all columns from trip and hotels.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(trip, hotels, <span class="at">by =</span> <span class="st">&quot;city&quot;</span>) </span></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##     day city           pop hotel                 address                  
##   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;                 &lt;chr&gt;                    
## 1     1 Teheran    8846782 Firouzeh Hotel        Dowlat Abad Alley        
## 2     2 Qom        1374036 Aria Hotel            Astane Square            
## 3     3 Esfahan    1945765 Amir Kabir Hotel      Chahar Bagh Abbasi Street
## 4     4 Persepolis      NA Sita Aukh Guest House Tume Junn Mohammad Street
## 5     5 Shiraz     1460665 Anvari Hotel          Anvari Street            
## 6     6 Bandar         212 Bolivar Inn           Abuzar Street            
## 7     7 Karaj      1967005 &lt;NA&gt;                  &lt;NA&gt;                     
## 8     8 Tabriz     1549453 &lt;NA&gt;                  &lt;NA&gt;</code></pre>
<p><code>left_join</code> is the most commonly used join because it ensures that you don’t lose observations from your primary table on the left side.</p>
<p><code>inner_join</code> returns all rows from trip, and all columns from trip and hotels. Rows in trip with no match in hotels will have NA values in the new columns.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(trip, hotels, <span class="at">by =</span> <span class="st">&quot;city&quot;</span>) </span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##     day city           pop hotel                 address                  
##   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;                 &lt;chr&gt;                    
## 1     1 Teheran    8846782 Firouzeh Hotel        Dowlat Abad Alley        
## 2     2 Qom        1374036 Aria Hotel            Astane Square            
## 3     3 Esfahan    1945765 Amir Kabir Hotel      Chahar Bagh Abbasi Street
## 4     4 Persepolis      NA Sita Aukh Guest House Tume Junn Mohammad Street
## 5     5 Shiraz     1460665 Anvari Hotel          Anvari Street            
## 6     6 Bandar         212 Bolivar Inn           Abuzar Street</code></pre>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">y =</span> <span class="fu">c</span>(T, F))</span>
<span id="cb489-2"><a href="#cb489-2" aria-hidden="true" tabindex="-1"></a>df1</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##       x y    
##   &lt;dbl&gt; &lt;lgl&gt;
## 1     1 TRUE 
## 2     2 FALSE</code></pre>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="at">a =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="st">&quot;a&quot;</span>)</span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##       x     a b    
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1    10 a    
## 2     3    10 a</code></pre>
<p><code>left_join(x, y)</code> includes all observations from x and observations from y that have match in x:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(df1, df2)</span></code></pre></div>
<pre><code>## Joining, by = &quot;x&quot;</code></pre>
<pre><code>## # A tibble: 2 x 4
##       x y         a b    
##   &lt;dbl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1 TRUE     10 a    
## 2     2 FALSE    NA &lt;NA&gt;</code></pre>
<p><code>inner_join(x, y)</code> only includes observations that match in both x and y:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(df1, df2)</span></code></pre></div>
<pre><code>## Joining, by = &quot;x&quot;</code></pre>
<pre><code>## # A tibble: 1 x 4
##       x y         a b    
##   &lt;dbl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1 TRUE     10 a</code></pre>
<p>Return all rows from trip where there are not matching values in hotels, keeping just columns from trip.</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(trip[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,], hotels[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>,], <span class="at">by =</span> <span class="st">&quot;city&quot;</span>) <span class="co"># returns cols fron trip where there are no matching values in hotels </span></span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     day city        pop
##   &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
## 1     1 Teheran 8846782
## 2     2 Qom     1374036</code></pre>
<p>Return all rows and all columns from both trip and hotels. Where there are not matching values, returns NA for the one missing.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(trip[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,], hotels[<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>,], <span class="at">by =</span> <span class="st">&quot;city&quot;</span>) </span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##     day city           pop hotel                 address                  
##   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;                 &lt;chr&gt;                    
## 1     1 Teheran    8846782 &lt;NA&gt;                  &lt;NA&gt;                     
## 2     2 Qom        1374036 &lt;NA&gt;                  &lt;NA&gt;                     
## 3     3 Esfahan    1945765 Amir Kabir Hotel      Chahar Bagh Abbasi Street
## 4    NA Persepolis      NA Sita Aukh Guest House Tume Junn Mohammad Street
## 5    NA Shiraz          NA Anvari Hotel          Anvari Street            
## 6    NA Bandar          NA Bolivar Inn           Abuzar Street</code></pre>
</div>
</div>
</div>
<div id="find-character-strings" class="section level1">
<h1>Find character strings</h1>
<p>Character strings can be matched and manipulated in base R by using <code>regular expressions</code> in functions <code>grep</code>, <code>grepl</code>, <code>sub</code>, <code>gsub</code>, <code>regexpr</code> + <code>regmatches</code> and some others. Also tidyverse package ‘stringr’ contains analogous verbs with more consistent syntax. A <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html">regular expression</a> is a pattern that describes a set of strings.</p>
<!-- + The fundamental building blocks are the regular expressions that match a single character.  -->
<ul>
<li><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html">Regular Expressions as used in R</a></li>
<li>Most characters, including all letters and digits, are regular expressions that match themselves. Whereas, e.g. <code>.</code> matches any single character.</li>
<li>You can refer also to a character class, which is a list of characters enclosed between <code>[</code> and <code>]</code>, e.g. <code>[[:alnum:]]</code> is same as <code>[A-z0-9]</code>.</li>
<li>Most common character classes: - <code>[:alnum:]</code> includes alphanumerics (<code>[:alpha:]</code> and <code>[:digit:]</code>); - <code>[:alpha:]</code>, includes alphabetic characters (<code>[:upper:]</code> and <code>[:lower:]</code> case); - <code>[:punct:]</code> includes punctuation characters ! " # $ % &amp; ’ ( ) * + , - . / : ; &lt; = &gt; ? @ [  ] ^ _ <code></code> { | } ~.; - <code>[:blank:]</code> includes space and tab; etc.</li>
<li>The metacharacters in regular expressions are <code>. \ | ( ) [ { ^ $ * + ?</code>, whether these have a special meaning depends on the context.</li>
<li>When matching any metacharacter as a regular character, precede it with a double backslash <code>\\</code>.</li>
<li>Repetition quantifiers put after regex specify how many times regex is matched: <code>?</code>, optional, at most once; <code>*</code>, zero or more times; <code>+</code>, one or more times; <code>{n}</code>, n times; <code>{n,}</code>, n or more times; <code>{n,m}</code>, n to m times.</li>
<li>The caret <code>^</code> and the dollar sign <code>$</code> are metacharacters that respectively match the empty string at the beginning and end of a line.</li>
</ul>
<div id="common-operations-with-regular-expressions" class="section level2">
<h2>Common operations with regular expressions</h2>
<ul>
<li>Locate a pattern match (positions)</li>
<li>Extract a matched pattern</li>
<li>Identify a match to a pattern</li>
<li>Replace a matched pattern</li>
</ul>
</div>
<div id="get-string-length" class="section level2">
<h2>Get string length</h2>
<p>To get the length of a text string (i.e. the number of characters in the string):</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;reformation&quot;</span>, <span class="st">&quot;post&quot;</span>, <span class="st">&quot;TLC&quot;</span>)</span>
<span id="cb503-2"><a href="#cb503-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nchar</span>(x)</span></code></pre></div>
<pre><code>## [1] 11  4  3</code></pre>
</div>
<div id="locate-and-extract-strings" class="section level2">
<h2>Locate and extract strings</h2>
<p><code>regexpr</code> returns position of 1st match and its length in a string:</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">regexpr</span>(<span class="st">&quot;o&quot;</span>, x)</span></code></pre></div>
<pre><code>## [1]  4  2 -1
## attr(,&quot;match.length&quot;)
## [1]  1  1 -1
## attr(,&quot;index.type&quot;)
## [1] &quot;chars&quot;
## attr(,&quot;useBytes&quot;)
## [1] TRUE</code></pre>
<p>We can see that “o” is the 4th character in a 1st string and 2nd character in the 2nd string and is missing (-1) from the last string, all have length 1 chracter (useBytes=T).</p>
<p>Lets try vector of strings. We want to return matching strings **after underscore ’_’ ** and we know that this <strong>match may contain both letters and numbers</strong> and is located at the end of the string:</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AreaShape_Area&quot;</span>, <span class="st">&quot;AreaShape_Perimeter&quot;</span>, <span class="st">&quot;AreaShape_MajorAxisLength&quot;</span>, <span class="st">&quot;Intensity_MADIntensity&quot;</span>)</span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">regexpr</span>(<span class="st">&quot;[[:alnum:]]*$&quot;</span>, y) <span class="co"># to return start and length of match</span></span>
<span id="cb507-3"><a href="#cb507-3" aria-hidden="true" tabindex="-1"></a>m <span class="co"># to have have a look: 1st vector is the first match from beginning, 2nd the lenght of match </span></span></code></pre></div>
<pre><code>## [1] 11 11 11 11
## attr(,&quot;match.length&quot;)
## [1]  4  9 15 12
## attr(,&quot;index.type&quot;)
## [1] &quot;chars&quot;
## attr(,&quot;useBytes&quot;)
## [1] TRUE</code></pre>
<p>What the heck we do with this list? <code>regexpr</code> works with the <code>regmatches</code> command, you can return matching strings:</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">regmatches</span>(y, m) <span class="co"># to return matching strings</span></span></code></pre></div>
<pre><code>## [1] &quot;Area&quot;            &quot;Perimeter&quot;       &quot;MajorAxisLength&quot; &quot;MADIntensity&quot;</code></pre>
<blockquote>
<p>Tidyverse’s <code>stringr</code> library resolves the problem of difficult to work with putputs and produces outputs than can easily be used as inputs.</p>
</blockquote>
<p><code>stringr</code> library verbs to fulfill tasks by <code>regexpr</code> and <code>regmatches</code> are <code>str_locate</code> and <code>str_extract</code>:</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate</span>(y, <span class="st">&quot;[[:alnum:]]*$&quot;</span>) <span class="co"># if we want only start and end positions</span></span></code></pre></div>
<pre><code>##      start end
## [1,]    11  14
## [2,]    11  19
## [3,]    11  25
## [4,]    11  22</code></pre>
<p>Note that, <code>str_locate</code> returns more conveniently a matrix (instead of a list as in regexpr).</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(y, <span class="st">&quot;[[:alnum:]]*$&quot;</span>) <span class="co"># if we want actual strings</span></span></code></pre></div>
<pre><code>## [1] &quot;Area&quot;            &quot;Perimeter&quot;       &quot;MajorAxisLength&quot; &quot;MADIntensity&quot;</code></pre>
<p>Seems nice and tidy.</p>
<p>To return multiple matches from the string, not just the first one, use <code>gregexpr</code>, which returns start position and length of every match:</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="fu">regmatches</span>(y, <span class="fu">gregexpr</span>(<span class="st">&quot;Area&quot;</span>, y)) <span class="co"># to return start position and length of every match</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Area&quot; &quot;Area&quot;
## 
## [[2]]
## [1] &quot;Area&quot;
## 
## [[3]]
## [1] &quot;Area&quot;
## 
## [[4]]
## character(0)</code></pre>
<p>Please try to return positions of all upper case letters from y:</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">regmatches</span>(y, <span class="fu">gregexpr</span>(<span class="st">&quot;[[:upper:]]&quot;</span>, y))</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;A&quot; &quot;S&quot; &quot;A&quot;
## 
## [[2]]
## [1] &quot;A&quot; &quot;S&quot; &quot;P&quot;
## 
## [[3]]
## [1] &quot;A&quot; &quot;S&quot; &quot;M&quot; &quot;A&quot; &quot;L&quot;
## 
## [[4]]
## [1] &quot;I&quot; &quot;M&quot; &quot;A&quot; &quot;D&quot; &quot;I&quot;</code></pre>
<p>Tidyverse alternatives to <code>gregexpr</code> is <code>str_locate_all</code> and <code>str_extract_all</code>:</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate_all</span>(y, <span class="st">&quot;e&quot;</span>) <span class="co"># to locate all start positions and lengths of letter &quot;e&quot;</span></span></code></pre></div>
<pre><code>## [[1]]
##      start end
## [1,]     3   3
## [2,]     9   9
## [3,]    13  13
## 
## [[2]]
##      start end
## [1,]     3   3
## [2,]     9   9
## [3,]    12  12
## [4,]    16  16
## [5,]    18  18
## 
## [[3]]
##      start end
## [1,]     3   3
## [2,]     9   9
## [3,]    21  21
## 
## [[4]]
##      start end
## [1,]     4   4
## [2,]    17  17</code></pre>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract_all</span>(y, <span class="st">&quot;[[:upper:]]&quot;</span>) <span class="co"># to extract all upper case letters</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;A&quot; &quot;S&quot; &quot;A&quot;
## 
## [[2]]
## [1] &quot;A&quot; &quot;S&quot; &quot;P&quot;
## 
## [[3]]
## [1] &quot;A&quot; &quot;S&quot; &quot;M&quot; &quot;A&quot; &quot;L&quot;
## 
## [[4]]
## [1] &quot;I&quot; &quot;M&quot; &quot;A&quot; &quot;D&quot; &quot;I&quot;</code></pre>
</div>
<div id="use-of-string-extraction-in-dplyr" class="section level2">
<h2>Use of string extraction in dplyr</h2>
</div>
<div id="find-matching-elements-in-vector" class="section level2">
<h2>Find matching elements in vector</h2>
<p><code>grep(pattern, x)</code> finds a pattern in x. Pattern – character string containing a regular expressions (or exact character string for fixed = TRUE).</p>
<p>What really happens when we use <code>grep</code> or <code>grepl</code> on a vector x. By using <code>grep()</code> with default arguments gets us vector of the indices of the matching items in x:</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;Area&quot;</span>, y)</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>Using <code>grep(value = TRUE)</code> we get character vector containing the selected elements of x:</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;Area&quot;</span>, y, <span class="at">value =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;AreaShape_Area&quot;            &quot;AreaShape_Perimeter&quot;      
## [3] &quot;AreaShape_MajorAxisLength&quot;</code></pre>
<p>Tidy way to run <code>grep</code> is to use <code>str_subset()</code> from <code>stringr</code> library:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(y, <span class="st">&quot;Area&quot;</span>) <span class="co"># note that strings and pattern have changed positions</span></span></code></pre></div>
<pre><code>## [1] &quot;AreaShape_Area&quot;            &quot;AreaShape_Perimeter&quot;      
## [3] &quot;AreaShape_MajorAxisLength&quot;</code></pre>
<p>However, by using <code>grepl</code> we get logical vector showing match for each element:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">&quot;Area&quot;</span>, y)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE</code></pre>
<p>Neat thing with the <code>grepl</code> is that it’s versatile: you can use its result for subsetting or to count matches (TRUE = 1 and FALSE = 0):</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">&quot;Area&quot;</span>, y) <span class="sc">%&gt;%</span> sum</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Respectively, <code>stringr</code> library verb is <code>str_detect()</code>:</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(y, <span class="st">&quot;Area&quot;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE</code></pre>
</div>
<div id="filter-variables" class="section level2">
<h2>Filter variables</h2>
<p>We can use <code>grepl</code> in <code>dplyr::filter</code> to subset data frame. For example we want to look at the participants with first name ‘Jaan’ in 2013 Tartu Ski Marathon finish protocol:</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true" tabindex="-1"></a>tm_2013 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;, Jaan&quot;</span>, Nimi)) <span class="sc">%&gt;%</span> tbl_df <span class="co"># Nimi is name and is given as &#39;lastname, firstname&#39;.</span></span></code></pre></div>
<pre><code>## # A tibble: 103 x 7
##     Koht    Nr Nimi             Elukoht            Aeg     Vanuseklass Kuubik
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;
##  1   166   119 Laidvee, Jaanus  Harju maakond      3:11:07 M35           1.09
##  2   197   249 Jõgi, Jaan       Võru maakond       3:13:21 M60           1.10
##  3   219   248 Undrest, Jaanus  Lääne-Viru maakond 3:15:25 M35           1.11
##  4   289   237 Bauman, Jaanus   Lääne-Viru maakond 3:19:37 M35           1.13
##  5   388   626 Johanson, Jaanus Viljandi maakond   3:24:42 M40           1.15
##  6   499   345 Ritson, Jaanus   Harju maakond      3:29:41 M40           1.17
##  7   567   908 Tiisvend, Jaanus Harju maakond      3:32:42 M35           1.19
##  8   638   564 Koval, Jaanus    Harju maakond      3:35:33 M21           1.20
##  9   710   532 Olop, Jaanus     Harju maakond      3:37:32 M40           1.21
## 10   716   407 Aus, Jaanus      Pärnu maakond      3:37:54 M35           1.22
## # … with 93 more rows</code></pre>
<p>Ups, we got ‘Jaanus’-es too!</p>
<p>Let’s add end of a line anchor <code>$</code> to get only ’Jaan’s and lets use <code>str_detect</code> verb:</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="#cb537-1" aria-hidden="true" tabindex="-1"></a>tm_2013 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(Nimi, <span class="st">&quot;, Jaan$&quot;</span>)) <span class="sc">%&gt;%</span> tbl_df <span class="co"># Nimi is name and is given as &#39;lastname, firstname&#39;. We use tbl_df to print only head of the table.</span></span></code></pre></div>
<pre><code>## # A tibble: 31 x 7
##     Koht    Nr Nimi           Elukoht          Aeg     Vanuseklass Kuubik
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;
##  1   197   249 Jõgi, Jaan     Võru maakond     3:13:21 M60           1.10
##  2  1072  1177 Jagomägi, Jaan Tartu maakond    3:51:05 M35           1.29
##  3  1639  1735 Saviir, Jaan   Lääne maakond    4:08:01 M50           1.38
##  4  1778   956 Leppik, Jaan   Harju maakond    4:12:01 M40           1.41
##  5  1793  1213 Harak, Jaan    Hiiu maakond     4:12:13 M55           1.41
##  6  1847  1359 Reiner, Jaan   Viljandi maakond 4:13:53 M40           1.42
##  7  2049  6144 Lendsaar, Jaan Võru maakond     4:20:49 M20           1.46
##  8  2076  6051 Joonas, Jaan   Võru maakond     4:21:38 M40           1.46
##  9  2193  2239 Sibul, Jaan    Harju maakond    4:24:38 M35           1.48
## 10  2321  1907 Pedajas, Jaan  Valga maakond    4:28:08 M35           1.50
## # … with 21 more rows</code></pre>
<p>Good!</p>
</div>
<div id="replace-strings" class="section level2">
<h2>Replace strings</h2>
<p>To substitute parts of a string, base R uses <code>sub</code> and <code>gsub</code> to perform replacement of the first and all matches respectively. <code>stringr</code> versions of these verbs are <code>str_replace</code> and <code>str_replace_all</code>, respectively:</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="#cb539-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(y, <span class="st">&quot;Area&quot;</span>, <span class="st">&quot;XXX&quot;</span>) <span class="co"># to replace first occurence of Area in each string with XXX</span></span></code></pre></div>
<pre><code>## [1] &quot;XXXShape_Area&quot;            &quot;XXXShape_Perimeter&quot;      
## [3] &quot;XXXShape_MajorAxisLength&quot; &quot;Intensity_MADIntensity&quot;</code></pre>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(y, <span class="st">&quot;Area&quot;</span>, <span class="st">&quot;XXX&quot;</span>) <span class="co"># replaces all Area-s with XXX</span></span></code></pre></div>
<pre><code>## [1] &quot;XXXShape_XXX&quot;             &quot;XXXShape_Perimeter&quot;      
## [3] &quot;XXXShape_MajorAxisLength&quot; &quot;Intensity_MADIntensity&quot;</code></pre>
<!-- # Using Dates and Times in R -->
<!-- % Bonnie Dixon -->
<!-- % 14-02-10 15:09:57 -->
<!-- *Today at the [Davis R Users' -->
<!-- Group](http://www.noamross.net/davis-r-users-group.html), [Bonnie -->
<!-- Dixon](http://ffhi.ucdavis.edu/people/directory/bmdixon) gave a tutorial on the -->
<!-- various ways to handle dates and times in R. Bonnie provided this great script -->
<!-- which walks through essential classes, functions, and packages. Here it is piped through -->
<!-- `knitr::spin`. The original R script can be found as a gist -->
<!-- [here](https://gist.github.com/noamross/8928124).* -->
</div>
</div>
<div id="date-and-time-classes" class="section level1">
<h1>Date and time classes</h1>
<p>Three date and time classes are built-in in R, <code>Date</code>, <code>POSIXct</code>, and <code>POSIXlt</code>.</p>
<div id="date" class="section level2">
<h2>Date</h2>
<p>If you have <strong>only dates</strong> in your data (but no times).</p>
<p>Create a date:</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1" aria-hidden="true" tabindex="-1"></a>bs <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2016-08-29&quot;</span>)</span>
<span id="cb543-2"><a href="#cb543-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(bs)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="#cb545-1" aria-hidden="true" tabindex="-1"></a>bs</span></code></pre></div>
<pre><code>## [1] &quot;2016-08-29&quot;</code></pre>
<p>If you don’t specify format, <code>as.Date</code> will try “%Y-%m-%d” then “%Y/%m/%d”. Other formats must be specified:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1" aria-hidden="true" tabindex="-1"></a>es <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;01/29/2017&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%m/%d/%Y&quot;</span>)</span>
<span id="cb547-2"><a href="#cb547-2" aria-hidden="true" tabindex="-1"></a>es  </span></code></pre></div>
<pre><code>## [1] &quot;2017-01-29&quot;</code></pre>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="#cb549-1" aria-hidden="true" tabindex="-1"></a>ch <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;December 19, 2016&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%B %d, %Y&quot;</span>)</span>
<span id="cb549-2"><a href="#cb549-2" aria-hidden="true" tabindex="-1"></a>ch</span></code></pre></div>
<pre><code>## [1] &quot;2016-12-19&quot;</code></pre>
<p>The list of format symbols can be accessed via <code>strptime</code>:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="#cb551-1" aria-hidden="true" tabindex="-1"></a>?strptime     </span></code></pre></div>
<p>Get the current date:</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.Date</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2021-09-03&quot;</code></pre>
<p><strong>Calculations with dates</strong>. Find the difference between dates:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a>es <span class="sc">-</span> bs</span></code></pre></div>
<pre><code>## Time difference of 153 days</code></pre>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">difftime</span>(ch, bs, <span class="at">units =</span> <span class="st">&quot;weeks&quot;</span>)</span></code></pre></div>
<pre><code>## Time difference of 16 weeks</code></pre>
<p>Add or subtract days:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1" aria-hidden="true" tabindex="-1"></a>bs <span class="sc">+</span> <span class="dv">40</span></span></code></pre></div>
<pre><code>## [1] &quot;2016-10-08&quot;</code></pre>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1" aria-hidden="true" tabindex="-1"></a>ch <span class="sc">-</span> <span class="dv">10</span></span></code></pre></div>
<pre><code>## [1] &quot;2016-12-09&quot;</code></pre>
<p>Create a vector of dates and find the intervals between them:</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1" aria-hidden="true" tabindex="-1"></a>road.fatalities <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;01.01.2016&quot;</span>, <span class="st">&quot;05.01.2016&quot;</span>, <span class="st">&quot;11.01.2016&quot;</span>,<span class="st">&quot;18.01.2016&quot;</span>,<span class="st">&quot;02.02.2016&quot;</span>,<span class="st">&quot;08.02.2016&quot;</span>,<span class="st">&quot;19.02.2016&quot;</span>,<span class="st">&quot;25.02.2016&quot;</span>, <span class="st">&quot;02.03.2016&quot;</span>, <span class="st">&quot;28.03.2016&quot;</span>, <span class="st">&quot;29.03.2016&quot;</span>, <span class="st">&quot;21.03.2016&quot;</span>, <span class="st">&quot;04.04.2016&quot;</span>, <span class="st">&quot;12.04.2016&quot;</span>, <span class="st">&quot;13.04.2016&quot;</span>,<span class="st">&quot;09.05.2016&quot;</span>,<span class="st">&quot;13.05.2016&quot;</span>,<span class="st">&quot;16.05.2016&quot;</span>, <span class="st">&quot;01.08.2016&quot;</span>,<span class="st">&quot;22.08.2016&quot;</span>), <span class="at">format =</span> <span class="st">&quot;%d.%m.%Y&quot;</span>)</span>
<span id="cb562-2"><a href="#cb562-2" aria-hidden="true" tabindex="-1"></a>road.fatalities <span class="ot">&lt;-</span> <span class="fu">sort</span>(road.fatalities) <span class="co"># just in case, lets sort it</span></span>
<span id="cb562-3"><a href="#cb562-3" aria-hidden="true" tabindex="-1"></a>road.fatalities</span></code></pre></div>
<pre><code>##  [1] &quot;2016-01-01&quot; &quot;2016-01-05&quot; &quot;2016-01-11&quot; &quot;2016-01-18&quot; &quot;2016-02-02&quot;
##  [6] &quot;2016-02-08&quot; &quot;2016-02-19&quot; &quot;2016-02-25&quot; &quot;2016-03-02&quot; &quot;2016-03-21&quot;
## [11] &quot;2016-03-28&quot; &quot;2016-03-29&quot; &quot;2016-04-04&quot; &quot;2016-04-12&quot; &quot;2016-04-13&quot;
## [16] &quot;2016-05-09&quot; &quot;2016-05-13&quot; &quot;2016-05-16&quot; &quot;2016-08-01&quot; &quot;2016-08-22&quot;</code></pre>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diff</span>(road.fatalities)</span></code></pre></div>
<pre><code>## Time differences in days
##  [1]  4  6  7 15  6 11  6  6 19  7  1  6  8  1 26  4  3 77 21</code></pre>
<p>Create a sequence of dates:</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="#cb566-1" aria-hidden="true" tabindex="-1"></a>six.weeks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">Sys.Date</span>(), <span class="at">length =</span> <span class="dv">6</span>, <span class="at">by =</span> <span class="st">&quot;week&quot;</span>) </span>
<span id="cb566-2"><a href="#cb566-2" aria-hidden="true" tabindex="-1"></a>six.weeks</span></code></pre></div>
<pre><code>## [1] &quot;2021-09-03&quot; &quot;2021-09-10&quot; &quot;2021-09-17&quot; &quot;2021-09-24&quot; &quot;2021-10-01&quot;
## [6] &quot;2021-10-08&quot;</code></pre>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a>six.weeks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">Sys.Date</span>(), <span class="at">length =</span> <span class="dv">6</span>, <span class="at">by =</span> <span class="dv">7</span>)</span>
<span id="cb568-2"><a href="#cb568-2" aria-hidden="true" tabindex="-1"></a>six.weeks</span></code></pre></div>
<pre><code>## [1] &quot;2021-09-03&quot; &quot;2021-09-10&quot; &quot;2021-09-17&quot; &quot;2021-09-24&quot; &quot;2021-10-01&quot;
## [6] &quot;2021-10-08&quot;</code></pre>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="#cb570-1" aria-hidden="true" tabindex="-1"></a>six.weeks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">Sys.Date</span>(), <span class="at">length =</span> <span class="dv">3</span>, <span class="at">by =</span> <span class="st">&quot;2 weeks&quot;</span>)</span>
<span id="cb570-2"><a href="#cb570-2" aria-hidden="true" tabindex="-1"></a>six.weeks</span></code></pre></div>
<pre><code>## [1] &quot;2021-09-03&quot; &quot;2021-09-17&quot; &quot;2021-10-01&quot;</code></pre>
<p>See the internal integer representation:</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(bs)</span></code></pre></div>
<pre><code>## [1] 17042</code></pre>
<p>Note, that internal integer representation of Date class is number of days from <code>January 1, 1970</code>:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="#cb574-1" aria-hidden="true" tabindex="-1"></a>bs <span class="sc">-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1970-01-01&quot;</span>) <span class="co"># </span></span></code></pre></div>
<pre><code>## Time difference of 17042 days</code></pre>
</div>
<div id="posixct" class="section level2">
<h2>POSIXct</h2>
<p>If you have <strong>times in your data</strong>, this is usually the best class to use.</p>
<p>Create some POSIXct objects:</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="#cb576-1" aria-hidden="true" tabindex="-1"></a>mft1 <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2014-03-11  17:14:15&quot;</span>)</span>
<span id="cb576-2"><a href="#cb576-2" aria-hidden="true" tabindex="-1"></a>mft1</span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 17:14:15 EET&quot;</code></pre>
<p>Specify format:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="#cb578-1" aria-hidden="true" tabindex="-1"></a>mft2 <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;22-Oct-2013 16:30:55&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%d-%b-%Y %H:%M:%S&quot;</span>)</span>
<span id="cb578-2"><a href="#cb578-2" aria-hidden="true" tabindex="-1"></a>mft2</span></code></pre></div>
<pre><code>## [1] &quot;2013-10-22 16:30:55 EEST&quot;</code></pre>
<p>Specify the time zone:</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="#cb580-1" aria-hidden="true" tabindex="-1"></a>rstudio.webinar <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;November 9, 2016 11am&quot;</span>, </span>
<span id="cb580-2"><a href="#cb580-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">format =</span> <span class="st">&quot;%B %d, %Y %I%p&quot;</span>, </span>
<span id="cb580-3"><a href="#cb580-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tz =</span> <span class="st">&quot;EST&quot;</span>)</span>
<span id="cb580-4"><a href="#cb580-4" aria-hidden="true" tabindex="-1"></a>rstudio.webinar</span></code></pre></div>
<pre><code>## [1] &quot;2016-11-09 11:00:00 EST&quot;</code></pre>
<p><strong>Some calculations with times</strong> Compare times:</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="#cb582-1" aria-hidden="true" tabindex="-1"></a>mft1 <span class="sc">&gt;</span> mft2</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Add or subtract seconds:</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a>mft1 <span class="sc">+</span> <span class="dv">30</span></span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 17:14:45 EET&quot;</code></pre>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="#cb586-1" aria-hidden="true" tabindex="-1"></a>mft2 <span class="sc">-</span> <span class="dv">30</span></span></code></pre></div>
<pre><code>## [1] &quot;2013-10-22 16:30:25 EEST&quot;</code></pre>
<p>Find the difference between times:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="#cb588-1" aria-hidden="true" tabindex="-1"></a>mft1 <span class="sc">-</span> mft2</span></code></pre></div>
<pre><code>## Time difference of 140.0718 days</code></pre>
<p>Automatically adjusts for daylight savings time. Last sunday in march, clocks are adjusted forward one hour:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.POSIXct</span>(<span class="st">&quot;2016-03-27 3:00:00&quot;</span>) <span class="sc">-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2016-03-26 23:55:00&quot;</span>) <span class="co"># note that time difference is only 2.08 hours</span></span></code></pre></div>
<pre><code>## Time difference of 5 mins</code></pre>
<p>Get the current time (in POSIXct by default):</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2021-09-03 12:28:39 EEST&quot;</code></pre>
<p>See the internal integer representation in seconds:</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(mft1)</span></code></pre></div>
<pre><code>## [1] 1394550855
## attr(,&quot;tzone&quot;)
## [1] &quot;&quot;</code></pre>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="fu">difftime</span>(mft1, <span class="fu">as.POSIXct</span>(<span class="st">&quot;1970-01-01 00:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>), <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)</span></code></pre></div>
<pre><code>## Time difference of 1394550855 secs</code></pre>
</div>
<div id="posixlt" class="section level2">
<h2>POSIXlt</h2>
<p>This class enables easy extraction of specific componants of a time.</p>
<ul>
<li><code>ct</code> – calendar time</li>
<li><code>lt</code> – local time. <code>lt</code> also helps one remember that POXIXlt objects are <em>lists</em>.)</li>
</ul>
<p>Create a time:</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="#cb598-1" aria-hidden="true" tabindex="-1"></a>mft1.lt <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(<span class="st">&quot;2014-03-11   17:14:15&quot;</span>)</span>
<span id="cb598-2"><a href="#cb598-2" aria-hidden="true" tabindex="-1"></a>mft1.lt</span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 17:14:15 EET&quot;</code></pre>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(mft1.lt)</span></code></pre></div>
<pre><code>## $sec
## [1] 15
## 
## $min
## [1] 14
## 
## $hour
## [1] 17
## 
## $mday
## [1] 11
## 
## $mon
## [1] 2
## 
## $year
## [1] 114
## 
## $wday
## [1] 2
## 
## $yday
## [1] 69
## 
## $isdst
## [1] 0
## 
## $zone
## [1] &quot;EET&quot;
## 
## $gmtoff
## [1] NA</code></pre>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(mft1.lt)</span></code></pre></div>
<pre><code>##    sec    min   hour   mday    mon   year   wday   yday  isdst   zone gmtoff 
##   &quot;15&quot;   &quot;14&quot;   &quot;17&quot;   &quot;11&quot;    &quot;2&quot;  &quot;114&quot;    &quot;2&quot;   &quot;69&quot;    &quot;0&quot;  &quot;EET&quot;     NA</code></pre>
<p>Extract componants of a time object:</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="#cb604-1" aria-hidden="true" tabindex="-1"></a>mft1.lt<span class="sc">$</span>sec</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="#cb606-1" aria-hidden="true" tabindex="-1"></a>mft1.lt<span class="sc">$</span>wday</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>Truncate or round off the time:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="fu">trunc</span>(mft1.lt, <span class="st">&quot;days&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 EET&quot;</code></pre>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="fu">trunc</span>(mft1.lt, <span class="st">&quot;mins&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 17:14:00 EET&quot;</code></pre>
<p><strong>Summary of date and time classes</strong></p>
<ul>
<li>When you just have dates, use <code>Date</code>.</li>
<li>When you have times, <code>POSIXct</code> is usually the best,</li>
<li><code>POSIXlt</code> enables easy extraction of specific components</li>
<li>and there is also <code>chron</code> package when you don’t need to deal with timezones and daylight savings time.</li>
</ul>
</div>
<div id="manipulating-times-and-dates" class="section level2">
<h2>Manipulating times and dates</h2>
<div id="lubridate" class="section level3">
<h3>lubridate</h3>
<p>This package is a wrapper for POSIXct with more intuitive syntax.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="#cb612-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p>Create a time. Note that lubridate uses UTC time zones as default:</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="#cb613-1" aria-hidden="true" tabindex="-1"></a>mft1.lub <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2014-03-11 17:14:15&quot;</span>)</span>
<span id="cb613-2"><a href="#cb613-2" aria-hidden="true" tabindex="-1"></a>mft1.lub</span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 17:14:15 UTC&quot;</code></pre>
<p>We have to set timezone explicitly:</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="#cb615-1" aria-hidden="true" tabindex="-1"></a>mft2.lub <span class="ot">&lt;-</span> <span class="fu">dmy_hm</span>(<span class="st">&quot;22-Oct-2013 16:30&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;EET&quot;</span>) </span>
<span id="cb615-2"><a href="#cb615-2" aria-hidden="true" tabindex="-1"></a>mft2.lub</span></code></pre></div>
<pre><code>## [1] &quot;2013-10-22 16:30:00 EEST&quot;</code></pre>
<p>Timezone can be easily changed using <code>force_tz</code>:</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="#cb617-1" aria-hidden="true" tabindex="-1"></a>mft1.lub <span class="ot">&lt;-</span> <span class="fu">force_tz</span>(mft1.lub, <span class="st">&quot;EET&quot;</span>)</span>
<span id="cb617-2"><a href="#cb617-2" aria-hidden="true" tabindex="-1"></a>mft1.lub</span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 17:14:15 EET&quot;</code></pre>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="#cb619-1" aria-hidden="true" tabindex="-1"></a>rstudio.webinar <span class="ot">&lt;-</span> <span class="fu">mdy_h</span>(<span class="st">&quot;November 9, 2016 11am&quot;</span>)</span>
<span id="cb619-2"><a href="#cb619-2" aria-hidden="true" tabindex="-1"></a>rstudio.webinar</span></code></pre></div>
<pre><code>## [1] &quot;2016-11-09 11:00:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="#cb621-1" aria-hidden="true" tabindex="-1"></a>today <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb621-2"><a href="#cb621-2" aria-hidden="true" tabindex="-1"></a>today</span></code></pre></div>
<pre><code>## [1] &quot;2021-09-03&quot;</code></pre>
<p>Some manipulations: Extract or reassign componants:</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(mft1.lub)</span></code></pre></div>
<pre><code>## [1] 2014</code></pre>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="#cb625-1" aria-hidden="true" tabindex="-1"></a><span class="fu">week</span>(mft1.lub)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="#cb627-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(mft1.lub, <span class="at">label =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] Tue
## Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat</code></pre>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="#cb629-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hour</span>(mft1.lub)</span></code></pre></div>
<pre><code>## [1] 17</code></pre>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="#cb631-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tz</span>(mft1.lub)</span></code></pre></div>
<pre><code>## [1] &quot;EET&quot;</code></pre>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="fu">second</span>(mft1.lub) <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb633-2"><a href="#cb633-2" aria-hidden="true" tabindex="-1"></a>mft1.lub</span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 17:14:07 EET&quot;</code></pre>
<p>Converting to decimal hours can facilitate some types of calculations:</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="#cb635-1" aria-hidden="true" tabindex="-1"></a>mft1.dechr <span class="ot">&lt;-</span> <span class="fu">hour</span>(mft1.lub) <span class="sc">+</span> <span class="fu">minute</span>(mft1.lub)<span class="sc">/</span><span class="dv">60</span> <span class="sc">+</span> <span class="fu">second</span>(mft1.lub)<span class="sc">/</span><span class="dv">3600</span></span>
<span id="cb635-2"><a href="#cb635-2" aria-hidden="true" tabindex="-1"></a>mft1.dechr</span></code></pre></div>
<pre><code>## [1] 17.23528</code></pre>
<ul>
<li>Lubridate distinguishes between four types of objects: instant, interval, duration, and period.</li>
<li>An instant is a specific moment in time.</li>
<li>Interval, duration, and period are all ways of recording time spans.</li>
</ul>
<p>Dates and times parsed in lubridate are instants:</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="#cb637-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.instant</span>(mft1.lub)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Round an instant:</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="#cb639-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round_date</span>(mft1.lub, <span class="st">&quot;minute&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 17:14:00 EET&quot;</code></pre>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="#cb641-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round_date</span>(mft1.lub, <span class="st">&quot;day&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2014-03-12 EET&quot;</code></pre>
<p>Get the current time or date as an instant (<code>Sys.time()</code>):</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="#cb643-1" aria-hidden="true" tabindex="-1"></a><span class="fu">now</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2021-09-03 12:28:39 EEST&quot;</code></pre>
<p>Shortcut for <code>Sys.Date()</code></p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="#cb645-1" aria-hidden="true" tabindex="-1"></a><span class="fu">today</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2021-09-03&quot;</code></pre>
<p>Some calculations with instants. Note that the units are seconds:</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="#cb647-1" aria-hidden="true" tabindex="-1"></a>mft1.lub <span class="sc">-</span> mft2.lub</span></code></pre></div>
<pre><code>## Time difference of 140.0723 days</code></pre>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="#cb649-1" aria-hidden="true" tabindex="-1"></a>mft1.lub <span class="sc">&gt;</span> mft2.lub</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Add seconds:</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="#cb651-1" aria-hidden="true" tabindex="-1"></a>mft1.lub <span class="sc">+</span> <span class="dv">30</span></span></code></pre></div>
<pre><code>## [1] &quot;2014-03-11 17:14:37 EET&quot;</code></pre>
<p>An interval is the span of time that occurs between two specified instants.</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="#cb653-1" aria-hidden="true" tabindex="-1"></a>time.to.xmas <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">now</span>(), <span class="fu">dmy</span>(<span class="st">&quot;24-12-2016&quot;</span>))</span>
<span id="cb653-2"><a href="#cb653-2" aria-hidden="true" tabindex="-1"></a>time.to.xmas</span></code></pre></div>
<pre><code>## [1] 2021-09-03 12:28:39 EEST--2016-12-24 02:00:00 EET</code></pre>
<p>Check whether a certain instant occured with a specified interval:</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="#cb655-1" aria-hidden="true" tabindex="-1"></a>rstudio.webinar <span class="sc">%within%</span> time.to.xmas</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="#cb657-1" aria-hidden="true" tabindex="-1"></a>mft1.lub <span class="sc">%within%</span> time.to.xmas</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Determine whether two intervals overlap:</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="#cb659-1" aria-hidden="true" tabindex="-1"></a>daylight <span class="ot">&lt;-</span> <span class="fu">as.interval</span>(<span class="fu">ymd_hm</span>(<span class="st">&quot;2016-03-26 23:55&quot;</span>), <span class="fu">ymd_hm</span>(<span class="st">&quot;2016-03-27 3:00&quot;</span>))</span>
<span id="cb659-2"><a href="#cb659-2" aria-hidden="true" tabindex="-1"></a>daylight</span></code></pre></div>
<pre><code>## [1] 2016-03-26 23:55:00 UTC--2016-03-27 03:00:00 UTC</code></pre>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="#cb661-1" aria-hidden="true" tabindex="-1"></a>inbed <span class="ot">&lt;-</span> <span class="fu">as.interval</span>(<span class="fu">ymd_hm</span>(<span class="st">&quot;2016-03-26 22:30&quot;</span>), <span class="fu">ymd_hm</span>(<span class="st">&quot;2016-03-27 7:30&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="#cb662-1" aria-hidden="true" tabindex="-1"></a><span class="fu">int_overlaps</span>(inbed, daylight)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>A <strong>duration is a time span not anchored to specific start and end times</strong>. It has an exact, fixed length, and is stored internally in seconds. Lets go to the wild side and create some durations:</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="#cb664-1" aria-hidden="true" tabindex="-1"></a>six.minutes <span class="ot">&lt;-</span> <span class="fu">dminutes</span>(<span class="dv">6</span>)</span>
<span id="cb664-2"><a href="#cb664-2" aria-hidden="true" tabindex="-1"></a>six.minutes</span></code></pre></div>
<pre><code>## [1] &quot;360s (~6 minutes)&quot;</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="#cb666-1" aria-hidden="true" tabindex="-1"></a>five.days <span class="ot">&lt;-</span> <span class="fu">ddays</span>(<span class="dv">5</span>)</span>
<span id="cb666-2"><a href="#cb666-2" aria-hidden="true" tabindex="-1"></a>five.days</span></code></pre></div>
<pre><code>## [1] &quot;432000s (~5 days)&quot;</code></pre>
<p>And now, after some practice with days and minutes, lets create whole year…</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="#cb668-1" aria-hidden="true" tabindex="-1"></a>one.year <span class="ot">&lt;-</span> <span class="fu">dyears</span>(<span class="dv">1</span>)</span>
<span id="cb668-2"><a href="#cb668-2" aria-hidden="true" tabindex="-1"></a>one.year</span></code></pre></div>
<pre><code>## [1] &quot;31557600s (~1 years)&quot;</code></pre>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="#cb670-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.duration</span>(inbed)</span></code></pre></div>
<pre><code>## [1] &quot;32400s (~9 hours)&quot;</code></pre>
<p>Calculations with durations:</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="#cb672-1" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(mft1.lub)</span></code></pre></div>
<pre><code>## [1] 2014</code></pre>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="#cb674-1" aria-hidden="true" tabindex="-1"></a>mft1.lub <span class="sc">+</span> one.year</span></code></pre></div>
<pre><code>## [1] &quot;2015-03-11 23:14:07 EET&quot;</code></pre>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb676-1"><a href="#cb676-1" aria-hidden="true" tabindex="-1"></a>five.days <span class="sc">+</span> <span class="fu">dhours</span>(<span class="dv">12</span>)</span></code></pre></div>
<pre><code>## [1] &quot;475200s (~5.5 days)&quot;</code></pre>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="#cb678-1" aria-hidden="true" tabindex="-1"></a>six.minutes<span class="sc">/</span><span class="fu">as.duration</span>(inbed)</span></code></pre></div>
<pre><code>## [1] 0.01111111</code></pre>
<p>A <strong>period is a time span not anchored to specific start and end times and measured in units larger than seconds with inexact lengths</strong>. Create some periods:</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="#cb680-1" aria-hidden="true" tabindex="-1"></a>three.weeks <span class="ot">&lt;-</span> <span class="fu">weeks</span>(<span class="dv">3</span>)</span>
<span id="cb680-2"><a href="#cb680-2" aria-hidden="true" tabindex="-1"></a>three.weeks</span></code></pre></div>
<pre><code>## [1] &quot;21d 0H 0M 0S&quot;</code></pre>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="#cb682-1" aria-hidden="true" tabindex="-1"></a>four.hours <span class="ot">&lt;-</span> <span class="fu">hours</span>(<span class="dv">4</span>)</span>
<span id="cb682-2"><a href="#cb682-2" aria-hidden="true" tabindex="-1"></a>four.hours</span></code></pre></div>
<pre><code>## [1] &quot;4H 0M 0S&quot;</code></pre>
<p>Calculations with periods:</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="#cb684-1" aria-hidden="true" tabindex="-1"></a>mft2.lub</span></code></pre></div>
<pre><code>## [1] &quot;2013-10-22 16:30:00 EEST&quot;</code></pre>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="#cb686-1" aria-hidden="true" tabindex="-1"></a>mft2.lub <span class="sc">+</span> three.weeks</span></code></pre></div>
<pre><code>## [1] &quot;2013-11-12 16:30:00 EET&quot;</code></pre>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb688-1"><a href="#cb688-1" aria-hidden="true" tabindex="-1"></a>sabbatical <span class="ot">&lt;-</span> <span class="fu">months</span>(<span class="dv">6</span>) <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">12</span>)</span>
<span id="cb688-2"><a href="#cb688-2" aria-hidden="true" tabindex="-1"></a>sabbatical</span></code></pre></div>
<pre><code>## [1] &quot;6m 12d 0H 0M 0S&quot;</code></pre>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="#cb690-1" aria-hidden="true" tabindex="-1"></a>three.weeks<span class="sc">/</span>sabbatical</span></code></pre></div>
<pre><code>## [1] 0.1078998</code></pre>
</div>
</div>
<div id="calculating-mean-clock-times" class="section level2">
<h2>Calculating mean clock times</h2>
<p>Say we have a vector of clock times in decimal hours and <strong>we want to calculate the mean clock time</strong>.</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="#cb692-1" aria-hidden="true" tabindex="-1"></a>bed.times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">23.9</span>, <span class="fl">0.5</span>, <span class="fl">22.7</span>, <span class="fl">0.1</span>, <span class="fl">23.3</span>, <span class="fl">1.2</span>, <span class="fl">23.6</span>)</span>
<span id="cb692-2"><a href="#cb692-2" aria-hidden="true" tabindex="-1"></a>bed.times</span></code></pre></div>
<pre><code>## [1] 23.9  0.5 22.7  0.1 23.3  1.2 23.6</code></pre>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="#cb694-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bed.times)  <span class="co"># doesn&#39;t work, gives arithmetic mean</span></span></code></pre></div>
<pre><code>## [1] 13.61429</code></pre>
<p>The <strong>clock has a circular scale</strong>, which ends where it begins, so we need to use circular statistics. Get the package <code>psych</code>.</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="#cb696-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb696-2"><a href="#cb696-2" aria-hidden="true" tabindex="-1"></a><span class="fu">circadian.mean</span>(bed.times)</span></code></pre></div>
<pre><code>## [1] 23.89926</code></pre>
</div>
<div id="using-times-and-dates-in-a-data-frame" class="section level2">
<h2>Using times and dates in a data frame</h2>
<p>Here is a data frame with a week of hypothetical times of going to bed and getting up for one person, and the total amount of time sleep time obtained each night according to a sleep monitoring device.</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="#cb698-1" aria-hidden="true" tabindex="-1"></a>sleep <span class="ot">&lt;-</span> </span>
<span id="cb698-2"><a href="#cb698-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb698-3"><a href="#cb698-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">bed.time =</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2013-09-01 23:05:24&quot;</span>, <span class="st">&quot;2013-09-02 22:51:09&quot;</span>,</span>
<span id="cb698-4"><a href="#cb698-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;2013-09-04 00:09:16&quot;</span>, <span class="st">&quot;2013-09-04 23:43:31&quot;</span>,</span>
<span id="cb698-5"><a href="#cb698-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;2013-09-06 00:17:41&quot;</span>, <span class="st">&quot;2013-09-06 22:42:27&quot;</span>,</span>
<span id="cb698-6"><a href="#cb698-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;2013-09-08 00:22:27&quot;</span>),</span>
<span id="cb698-7"><a href="#cb698-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">rise.time =</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2013-09-02 08:03:29&quot;</span>, <span class="st">&quot;2013-09-03 07:34:21&quot;</span>,</span>
<span id="cb698-8"><a href="#cb698-8" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;2013-09-04 07:45:06&quot;</span>, <span class="st">&quot;2013-09-05 07:07:17&quot;</span>,</span>
<span id="cb698-9"><a href="#cb698-9" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;2013-09-06 08:17:13&quot;</span>, <span class="st">&quot;2013-09-07 06:52:11&quot;</span>,</span>
<span id="cb698-10"><a href="#cb698-10" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;2013-09-08 07:15:19&quot;</span>),</span>
<span id="cb698-11"><a href="#cb698-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sleep.time =</span> <span class="fu">dhours</span>(<span class="fu">c</span>(<span class="fl">6.74</span>, <span class="fl">7.92</span>, <span class="fl">7.01</span>, <span class="fl">6.23</span>, <span class="fl">6.34</span>, <span class="fl">7.42</span>, <span class="fl">6.45</span>))</span>
<span id="cb698-12"><a href="#cb698-12" aria-hidden="true" tabindex="-1"></a>              ); sleep</span></code></pre></div>
<pre><code>##              bed.time           rise.time           sleep.time
## 1 2013-09-01 23:05:24 2013-09-02 08:03:29 24264s (~6.74 hours)
## 2 2013-09-02 22:51:09 2013-09-03 07:34:21 28512s (~7.92 hours)
## 3 2013-09-04 00:09:16 2013-09-04 07:45:06 25236s (~7.01 hours)
## 4 2013-09-04 23:43:31 2013-09-05 07:07:17 22428s (~6.23 hours)
## 5 2013-09-06 00:17:41 2013-09-06 08:17:13 22824s (~6.34 hours)
## 6 2013-09-06 22:42:27 2013-09-07 06:52:11 26712s (~7.42 hours)
## 7 2013-09-08 00:22:27 2013-09-08 07:15:19 23220s (~6.45 hours)</code></pre>
<p>We want to calculate sleep efficiency, the percent of time in bed spent asleep.</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="#cb700-1" aria-hidden="true" tabindex="-1"></a>sleep<span class="sc">$</span>efficiency <span class="ot">&lt;-</span> </span>
<span id="cb700-2"><a href="#cb700-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(sleep<span class="sc">$</span>sleep.time<span class="sc">/</span>(sleep<span class="sc">$</span>rise.time <span class="sc">-</span> sleep<span class="sc">$</span>bed.time)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb700-3"><a href="#cb700-3" aria-hidden="true" tabindex="-1"></a>sleep</span></code></pre></div>
<pre><code>##              bed.time           rise.time           sleep.time efficiency
## 1 2013-09-01 23:05:24 2013-09-02 08:03:29 24264s (~6.74 hours)       75.2
## 2 2013-09-02 22:51:09 2013-09-03 07:34:21 28512s (~7.92 hours)       90.8
## 3 2013-09-04 00:09:16 2013-09-04 07:45:06 25236s (~7.01 hours)       92.3
## 4 2013-09-04 23:43:31 2013-09-05 07:07:17 22428s (~6.23 hours)       84.2
## 5 2013-09-06 00:17:41 2013-09-06 08:17:13 22824s (~6.34 hours)       79.3
## 6 2013-09-06 22:42:27 2013-09-07 06:52:11 26712s (~7.42 hours)       90.9
## 7 2013-09-08 00:22:27 2013-09-08 07:15:19 23220s (~6.45 hours)       93.7</code></pre>
<p>Now let’s calculate the mean of each column:</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb702-1"><a href="#cb702-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(sleep)  <span class="co"># doesn&#39;t work</span></span></code></pre></div>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="#cb703-1" aria-hidden="true" tabindex="-1"></a><span class="fu">circadian.mean</span>(<span class="fu">hour</span>(sleep<span class="sc">$</span>bed.time) <span class="sc">+</span> </span>
<span id="cb703-2"><a href="#cb703-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">minute</span>(sleep<span class="sc">$</span>bed.time)<span class="sc">/</span><span class="dv">60</span> <span class="sc">+</span> </span>
<span id="cb703-3"><a href="#cb703-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">second</span>(sleep<span class="sc">$</span>bed.time)<span class="sc">/</span><span class="dv">3600</span>)</span></code></pre></div>
<pre><code>## [1] 23.60028</code></pre>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="#cb705-1" aria-hidden="true" tabindex="-1"></a><span class="fu">circadian.mean</span>(<span class="fu">hour</span>(sleep<span class="sc">$</span>rise.time) <span class="sc">+</span> </span>
<span id="cb705-2"><a href="#cb705-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">minute</span>(sleep<span class="sc">$</span>rise.time)<span class="sc">/</span><span class="dv">60</span> <span class="sc">+</span> </span>
<span id="cb705-3"><a href="#cb705-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">second</span>(sleep<span class="sc">$</span>rise.time)<span class="sc">/</span><span class="dv">3600</span>)</span></code></pre></div>
<pre><code>## [1] 7.55924</code></pre>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="#cb707-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(sleep<span class="sc">$</span>sleep.time)<span class="sc">/</span><span class="dv">3600</span></span></code></pre></div>
<pre><code>## [1] 6.872857</code></pre>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="#cb709-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(sleep<span class="sc">$</span>efficiency)</span></code></pre></div>
<pre><code>## [1] 86.62857</code></pre>
<!-- We can also plot sleep duration and efficiency across the week: -->
<!-- ```{r} -->
<!-- par(mar = c(5, 4, 4, 4)) -->
<!-- plot(round_date(sleep$rise.time, "day"), sleep$efficiency,  -->
<!--      type = "o", col = "blue", xlab = "Morning", ylab = NA) -->
<!-- par(new = TRUE) -->
<!-- plot(round_date(sleep$rise.time, "day"), sleep$sleep.time/3600,  -->
<!--      type = "o", col = "red", axes = FALSE, ylab = NA, xlab = NA) -->
<!-- axis(side = 4) -->
<!-- mtext(side = 4, line = 2.5, col = "red", "Sleep duration") -->
<!-- mtext(side = 2, line = 2.5, col = "blue", "Sleep efficiency") -->
<!-- ``` -->
<!-- More resources on times and dates -->
<!-- Date and time tutorials for R: -->
<!-- + [http://www.stat.berkeley.edu/classes/s133/dates.html](http://www.stat.berkeley.edu/classes/s133/dates.html) -->
<!-- + [http://science.nature.nps.gov/im/datamgmt/statistics/r/fundamentals/dates.cfm](http://science.nature.nps.gov/im/datamgmt/statistics/r/fundamentals/dates.cfm) -->
<!-- + [http://en.wikibooks.org/wiki/R_Programming/Times_and_Dates](http://en.wikibooks.org/wiki/R_Programming/Times_and_Dates) -->
<!-- [lubridate](http://www.jstatsoft.org/v40/i03/paper) -->
<!-- Time zone and daylight saving time info: -->
<!-- + [http://www.timeanddate.com/](http://www.timeanddate.com/) -->
<!-- + [http://en.wikipedia.org/wiki/List_of_tz_database_time_zones](http://en.wikipedia.org/wiki/List_of_tz_database_time_zones) -->
<!-- + [http://www.twinsun.com/tz/tz-link.htm](http://www.twinsun.com/tz/tz-link.htm) -->
<!-- + Also see the R help file at `?Sys.timezone` -->
</div>
</div>
<div id="functions" class="section level1">
<h1>Functions</h1>
<p>A function is a piece of code to carry out a specified task, e.g. calculate mean, split data frame. It may accept arguments (or not) and it may return zero to more values or objects.</p>
<p>General form of R function is following:</p>
<pre><code>
function(argslist) expr
</code></pre>
<p>Where, <code>argslist</code> is either empty or one to more <code>name</code> or <code>name=expression</code> terms. When calling a function you can specify arguments by position, by complete name, or by partial name.</p>
<p>Example function with no arguments, doing only one thing:</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="#cb711-1" aria-hidden="true" tabindex="-1"></a>dedication <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb711-2"><a href="#cb711-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;And Pierce Brosnan how dare you prescribe</span><span class="sc">\n</span></span>
<span id="cb711-3"><a href="#cb711-3" aria-hidden="true" tabindex="-1"></a><span class="st">      Sad grief and bed wet pills&quot;</span>)</span>
<span id="cb711-4"><a href="#cb711-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Above defined function prints cryptic lyrics (Credit: ME Smith)</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="#cb712-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dedication</span>()</span></code></pre></div>
<pre><code>## And Pierce Brosnan how dare you prescribe
## 
##       Sad grief and bed wet pills</code></pre>
<p>But we can tune above function to insert your computer’s username into that line instead of that actor:</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="#cb714-1" aria-hidden="true" tabindex="-1"></a>not_medication <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;And&quot;</span>, <span class="fu">system</span>(<span class="st">&quot;whoami&quot;</span>,T), <span class="st">&quot;how dare you prescribe</span><span class="sc">\n</span></span>
<span id="cb714-2"><a href="#cb714-2" aria-hidden="true" tabindex="-1"></a><span class="st">Sad grief and bed wet pills&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="#cb715-1" aria-hidden="true" tabindex="-1"></a><span class="fu">not_medication</span>()</span></code></pre></div>
<pre><code>## And taavi how dare you prescribe
## 
## Sad grief and bed wet pills</code></pre>
<ul>
<li>Function names must be concise, <a href="http://thefall.org/discography/data/album31.html">like above</a></li>
<li>Note that, when writing a multiline function, braces <code>{}</code> must be used to enclose the body of the function.</li>
</ul>
<p>Onliners like this does not need braces:</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="#cb717-1" aria-hidden="true" tabindex="-1"></a>plusone <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb717-2"><a href="#cb717-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plusone</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div id="default-arguments" class="section level2">
<h2>Default arguments</h2>
<p>Some arguments have default values specified, as shown below. Arguments without a default must have a value supplied for the function to run. You do not need to provide a value for those arguments with a default, as the function will use the default value:</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="#cb719-1" aria-hidden="true" tabindex="-1"></a>sum_stat <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">f =</span> <span class="st">&quot;mean&quot;</span>){</span>
<span id="cb719-2"><a href="#cb719-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(f, <span class="fu">list</span>(x))</span>
<span id="cb719-3"><a href="#cb719-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb719-4"><a href="#cb719-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-5"><a href="#cb719-5" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb719-6"><a href="#cb719-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_stat</span>(v) <span class="co"># by default this function calculates mean</span></span></code></pre></div>
<pre><code>## [1] 0.4341941</code></pre>
<p>But we can also calculate median, if we change f argument:</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="#cb721-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_stat</span>(v, <span class="at">f =</span> <span class="st">&quot;median&quot;</span>) <span class="co"># </span></span></code></pre></div>
<pre><code>## [1] 0.1910319</code></pre>
</div>
<div id="ellipsis" class="section level2">
<h2>Ellipsis</h2>
<p>The addition of <code>...</code>, or <strong>ellipsis</strong>, in the function definition allows other arguments to be passed into the function, and passed onto to another function:</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb723-1"><a href="#cb723-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s redifine sum_stat function with ellipsis to pass additional arguments to summary function</span></span>
<span id="cb723-2"><a href="#cb723-2" aria-hidden="true" tabindex="-1"></a>sum_stat2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">f =</span> <span class="st">&quot;mean&quot;</span>, ...){</span>
<span id="cb723-3"><a href="#cb723-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(f, <span class="fu">list</span>(x, ...)) <span class="co"># do.call constructs and executes a function call from a function and a list of arguments to be passed to it</span></span>
<span id="cb723-4"><a href="#cb723-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb723-5"><a href="#cb723-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb723-6"><a href="#cb723-6" aria-hidden="true" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, v, <span class="cn">NA</span>, <span class="cn">NA</span>)</span>
<span id="cb723-7"><a href="#cb723-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_stat2</span>(v2) <span class="co"># NA-s start to give trouble, as mean fun has na.rm = FALSE argument</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb725-1"><a href="#cb725-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_stat2</span>(v2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># here we pass na.rm = TRUE to our function and voila!</span></span></code></pre></div>
<pre><code>## [1] 0.4341941</code></pre>
</div>
<div id="function-environment" class="section level2">
<h2>Function environment</h2>
<p>By default, function returns result from last expression:</p>
<div class="sourceCode" id="cb727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb727-1"><a href="#cb727-1" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb727-2"><a href="#cb727-2" aria-hidden="true" tabindex="-1"></a> odds <span class="ot">&lt;-</span> p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb727-3"><a href="#cb727-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">log</span>(odds)</span>
<span id="cb727-4"><a href="#cb727-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb727-5"><a href="#cb727-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb727-6"><a href="#cb727-6" aria-hidden="true" tabindex="-1"></a><span class="fu">logit</span>(<span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Importantly, objects that are created within the function are local to the environment of the function. If you direct your last expression into an object inside function, you need to explicitly <code>return()</code> the value of that object:</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="#cb729-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look what happens</span></span>
<span id="cb729-2"><a href="#cb729-2" aria-hidden="true" tabindex="-1"></a>logit2 <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb729-3"><a href="#cb729-3" aria-hidden="true" tabindex="-1"></a> odds <span class="ot">&lt;-</span> p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb729-4"><a href="#cb729-4" aria-hidden="true" tabindex="-1"></a> log_odds <span class="ot">&lt;-</span> <span class="fu">log</span>(odds) <span class="co"># last expression&#39;s value is assigned to log_odds object inside function</span></span>
<span id="cb729-5"><a href="#cb729-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb729-6"><a href="#cb729-6" aria-hidden="true" tabindex="-1"></a><span class="fu">logit2</span>(<span class="fl">0.5</span>) <span class="co"># nothing is returned</span></span>
<span id="cb729-7"><a href="#cb729-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb729-8"><a href="#cb729-8" aria-hidden="true" tabindex="-1"></a><span class="do">## use of return()</span></span>
<span id="cb729-9"><a href="#cb729-9" aria-hidden="true" tabindex="-1"></a>logit3 <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb729-10"><a href="#cb729-10" aria-hidden="true" tabindex="-1"></a> odds <span class="ot">&lt;-</span> p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb729-11"><a href="#cb729-11" aria-hidden="true" tabindex="-1"></a> log_odds <span class="ot">&lt;-</span> <span class="fu">log</span>(odds) <span class="co"># last expression&#39;s value is assigned to log_odds object inside function</span></span>
<span id="cb729-12"><a href="#cb729-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(log_odds) <span class="co"># return object log_odds value</span></span>
<span id="cb729-13"><a href="#cb729-13" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb729-14"><a href="#cb729-14" aria-hidden="true" tabindex="-1"></a><span class="fu">logit3</span>(<span class="fl">0.5</span>) </span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="#cb731-1" aria-hidden="true" tabindex="-1"></a><span class="do">## use of return()</span></span>
<span id="cb731-2"><a href="#cb731-2" aria-hidden="true" tabindex="-1"></a>logit4 <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb731-3"><a href="#cb731-3" aria-hidden="true" tabindex="-1"></a> odds <span class="ot">&lt;-</span> p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb731-4"><a href="#cb731-4" aria-hidden="true" tabindex="-1"></a> log_odds <span class="ot">&lt;-</span> <span class="fu">log</span>(odds) <span class="co"># last expression&#39;s value is assigned to log_odds object inside function</span></span>
<span id="cb731-5"><a href="#cb731-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">odds =</span> odds, <span class="at">log_odds =</span> log_odds)) <span class="co"># return two objects from function environment as named list</span></span>
<span id="cb731-6"><a href="#cb731-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb731-7"><a href="#cb731-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb731-8"><a href="#cb731-8" aria-hidden="true" tabindex="-1"></a><span class="fu">logit4</span>(<span class="fl">0.5</span>) </span></code></pre></div>
<pre><code>## $odds
## [1] 1
## 
## $log_odds
## [1] 0</code></pre>
</div>
<div id="anonymous-function-inside-for-loop" class="section level2">
<h2>Anonymous function inside for loop</h2>
<p><code>lapply()</code>/<code>sapply()</code> takes a function, applies it to each element in a list/vector, and returns the results in the form of a list. Its easy to use when you want to calculate eg. mean of each list element. But what if you need to do something more specific with your data:</p>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="#cb733-1" aria-hidden="true" tabindex="-1"></a>let <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;x&quot;</span>,<span class="st">&quot;u&quot;</span>,<span class="st">&quot;b&quot;</span>) <span class="co"># we have a list of letters</span></span>
<span id="cb733-2"><a href="#cb733-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(let, <span class="cf">function</span>(x) <span class="fu">grep</span>(x, letters)) <span class="co"># we need to know the position of each letter in alphabet</span></span></code></pre></div>
<pre><code>##  a  z  x  u  b 
##  1 26 24 21  2</code></pre>
</div>
<div id="functional-sequence" class="section level2">
<h2>Functional sequence</h2>
<p><code>magrittr</code> allows to use <code>%&gt;%</code> piping operator not only to produce values but also <a href="https://blog.rstudio.org/2014/12/01/magrittr-1-5/">to produce functions</a>. This kind of functional sequences denote input with <code>.</code> dot:</p>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="#cb735-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb735-2"><a href="#cb735-2" aria-hidden="true" tabindex="-1"></a>mae <span class="ot">&lt;-</span> . <span class="sc">%&gt;%</span> abs <span class="sc">%&gt;%</span> <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb735-3"><a href="#cb735-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mae</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>))</span></code></pre></div>
<pre><code>## [1] 0.8654328</code></pre>
<p>This is similar to following function:</p>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb737-1"><a href="#cb737-1" aria-hidden="true" tabindex="-1"></a>mae <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb737-2"><a href="#cb737-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(x), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb737-3"><a href="#cb737-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Quite common use case of these functional sequences is inside lapply/sapply:</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="#cb738-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb738-2"><a href="#cb738-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb738-3"><a href="#cb738-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb738-4"><a href="#cb738-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> paths<span class="sc">-</span>to<span class="sc">-</span>csv<span class="sc">-</span>files <span class="sc">%&gt;%</span> <span class="fu">lapply</span>(. <span class="sc">%&gt;%</span> read_csv <span class="sc">%&gt;%</span> melt)</span></code></pre></div>
<p>It’s cool that you can subset these functional sequences and use only parts of them when necessary:</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb739-1"><a href="#cb739-1" aria-hidden="true" tabindex="-1"></a>mae[<span class="dv">2</span>](<span class="fu">rnorm</span>(<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## [1] 0.7661742</code></pre>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="#cb741-1" aria-hidden="true" tabindex="-1"></a>mae[<span class="dv">1</span>](<span class="fu">rnorm</span>(<span class="dv">10</span>))</span></code></pre></div>
<pre><code>##  [1] 1.21564351 0.63210482 0.66973270 0.55847675 0.04517433 0.18987531
##  [7] 0.68961782 0.79848746 0.31851973 0.15912980</code></pre>
<div id="another-example" class="section level4">
<h4>Another example</h4>
<p>Let’s create function to calculate <strong>standardised effect size, Cohen’s d</strong>. First let’s simulate some toy data of blood pressure readings from patients with high systolic bp, treated either with drug or placebo:</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="#cb743-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb743-2"><a href="#cb743-2" aria-hidden="true" tabindex="-1"></a>probs_h <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">70</span><span class="sc">:</span><span class="dv">190</span>, <span class="dv">150</span>, <span class="dv">7</span>) </span>
<span id="cb743-3"><a href="#cb743-3" aria-hidden="true" tabindex="-1"></a>probs_n <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">70</span><span class="sc">:</span><span class="dv">190</span>, <span class="dv">130</span>, <span class="dv">7</span>)</span>
<span id="cb743-4"><a href="#cb743-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">bp =</span> <span class="fu">c</span>(<span class="fu">sample</span>(<span class="dv">70</span><span class="sc">:</span><span class="dv">190</span>, <span class="dv">56</span>, <span class="at">replace =</span> T, <span class="at">prob =</span> probs_h), </span>
<span id="cb743-5"><a href="#cb743-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sample</span>(<span class="dv">70</span><span class="sc">:</span><span class="dv">190</span>, <span class="dv">60</span>, <span class="at">replace =</span> T, <span class="at">prob =</span> probs_n)), </span>
<span id="cb743-6"><a href="#cb743-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">tr =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;placebo&quot;</span>, <span class="dv">56</span>), <span class="fu">rep</span>(<span class="st">&quot;drug&quot;</span>, <span class="dv">60</span>)))</span></code></pre></div>
<p>This is how our dummy dataset looks like:</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="#cb744-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(m, <span class="fu">aes</span>(tr, bp)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-351-1.png" width="288" style="display: block; margin: auto;" /></p>
<p><a href="https://en.wikipedia.org/wiki/Effect_size">Cohen’s d is defined</a> as the difference between two means divided by a standard deviation for the data:</p>
<p><span class="math display">\[d = \frac{\bar{x}_1-\bar{x}_2}{s}\]</span></p>
<p><span class="math inline">\(s\)</span> is pooled standard deviation:</p>
<p><span class="math display">\[s = \sqrt{\frac{(n_1-1){s_1}^2+(n_2-1){s_2}^2}{n_1+n_2-2}}\]</span></p>
<p>Using above equations, we define function:</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="#cb745-1" aria-hidden="true" tabindex="-1"></a>cohensd <span class="ot">&lt;-</span> <span class="cf">function</span>(x1, x2){ <span class="co"># &#39;{}&#39; because our function is spread on multiple lines</span></span>
<span id="cb745-2"><a href="#cb745-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb745-3"><a href="#cb745-3" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> <span class="fu">length</span>(x1) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb745-4"><a href="#cb745-4" aria-hidden="true" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> <span class="fu">length</span>(x2) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb745-5"><a href="#cb745-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb745-6"><a href="#cb745-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mean difference</span></span>
<span id="cb745-7"><a href="#cb745-7" aria-hidden="true" tabindex="-1"></a>  md  <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">mean</span>(x1, <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="fu">mean</span>(x2, <span class="at">na.rm =</span> T))        </span>
<span id="cb745-8"><a href="#cb745-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb745-9"><a href="#cb745-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># common sd</span></span>
<span id="cb745-10"><a href="#cb745-10" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> n1 <span class="sc">*</span> <span class="fu">var</span>(x1, <span class="at">na.rm =</span> T) <span class="sc">+</span> n2 <span class="sc">*</span> <span class="fu">var</span>(x2, <span class="at">na.rm =</span> T)</span>
<span id="cb745-11"><a href="#cb745-11" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> s<span class="sc">/</span>(n1 <span class="sc">+</span> n2)</span>
<span id="cb745-12"><a href="#cb745-12" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(s)                     </span>
<span id="cb745-13"><a href="#cb745-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb745-14"><a href="#cb745-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate Cohen&#39;s d</span></span>
<span id="cb745-15"><a href="#cb745-15" aria-hidden="true" tabindex="-1"></a>  md<span class="sc">/</span>s <span class="co"># last expression&#39;s result is returned</span></span>
<span id="cb745-16"><a href="#cb745-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Cohen’s d is interpreted that d values of 0.2, 0.5, and 0.8 represent small, medium, and large effect sizes respectively:</p>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="#cb746-1" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">split</span>(m<span class="sc">$</span>bp, m<span class="sc">$</span>tr) <span class="co"># to split data frame into two vectors</span></span>
<span id="cb746-2"><a href="#cb746-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cohensd</span>(bp<span class="sc">$</span>placebo, bp<span class="sc">$</span>drug) <span class="co"># to input treatment groups as vectors</span></span></code></pre></div>
<pre><code>## [1] 0.5146518</code></pre>
<p>Because our function arguments are two vectors x1 and x2 and we had data frame in the long format, we had to split data frame into vectors. [Can we embed these two vectors into data frame in the long format (two cols - one col per vector)?]</p>
<p>We can try to wrap this function into another function to use on our data frame:</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="#cb748-1" aria-hidden="true" tabindex="-1"></a>cohens_d <span class="ot">&lt;-</span> <span class="cf">function</span>(data, values, group){</span>
<span id="cb748-2"><a href="#cb748-2" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fu">split</span>(data[[values]], data[[group]])</span>
<span id="cb748-3"><a href="#cb748-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cohensd</span>(v[[<span class="dv">1</span>]], v[[<span class="dv">2</span>]])</span>
<span id="cb748-4"><a href="#cb748-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="#cb749-1" aria-hidden="true" tabindex="-1"></a>cd <span class="ot">&lt;-</span> <span class="fu">cohens_d</span>(m, <span class="st">&quot;bp&quot;</span>, <span class="st">&quot;tr&quot;</span>)</span>
<span id="cb749-2"><a href="#cb749-2" aria-hidden="true" tabindex="-1"></a>cd</span></code></pre></div>
<pre><code>## [1] 0.5146518</code></pre>
<p>Now we can create function to insert word explaining the size of the effect into text:</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="#cb751-1" aria-hidden="true" tabindex="-1"></a>mansplain_cohensd <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb751-2"><a href="#cb751-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x<span class="sc">&lt;=</span><span class="fl">0.2</span>) <span class="fu">return</span>(<span class="st">&quot;small&quot;</span>) </span>
<span id="cb751-3"><a href="#cb751-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x<span class="sc">&gt;=</span><span class="fl">0.2</span><span class="sc">&amp;</span>x<span class="sc">&lt;=</span><span class="fl">0.5</span>) <span class="fu">return</span>(<span class="st">&quot;medium&quot;</span>)</span>
<span id="cb751-4"><a href="#cb751-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x<span class="sc">&gt;</span><span class="fl">0.5</span><span class="sc">&amp;</span>x<span class="sc">&lt;</span><span class="cn">Inf</span>) <span class="fu">return</span>(<span class="st">&quot;large&quot;</span>)</span>
<span id="cb751-5"><a href="#cb751-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x<span class="sc">==</span><span class="cn">Inf</span>) <span class="fu">return</span>(<span class="st">&quot;cosmos&quot;</span>)</span>
<span id="cb751-6"><a href="#cb751-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb751-7"><a href="#cb751-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb751-8"><a href="#cb751-8" aria-hidden="true" tabindex="-1"></a>cdv <span class="ot">&lt;-</span> <span class="fu">mansplain_cohensd</span>(cd)</span>
<span id="cb751-9"><a href="#cb751-9" aria-hidden="true" tabindex="-1"></a>cdv</span></code></pre></div>
<pre><code>## [1] &quot;large&quot;</code></pre>
<pre><code>Seems that the standardised effect size for the drug treatment effect on blood pressure is **` r round(cd, 2)`**, which means it&#39;s **` r mansplain_cohensd(cd)`**.</code></pre>
<p>Whitch produces following output:</p>
<p>Seems that the standardised effect size for the drug treatment effect on blood pressure is <strong>0.51</strong>, which means it’s <strong>large</strong>.</p>
<hr />
<ul>
<li>Try to keep your functions in separate sub directory <code>lib</code> in your project’s dir</li>
<li>load functions using <code>load(lib/cohens_d.R)</code></li>
</ul>
<p>Good function is:</p>
<ul>
<li>short</li>
<li>performs one task</li>
<li>has intuitive short name</li>
</ul>
</div>
</div>
</div>
<div id="reports-with-rmarkdown" class="section level1">
<h1>Reports with rmarkdown</h1>
<p>R markdown is a variant of markdown that has embedded R code chunks. R markdown allows you to combine your R code, producing statistics and plots, with write-up. With the help of knitr and pandoc R markdown documents can be converted into reports in html, pdf or MS word format.</p>
<p><a href="http://kbroman.org/knitr_knutshell/pages/Rmarkdown.html">Quick overview of R markdown document, what it contains and how its structure looks like.</a></p>
<p><a href="https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf">R markdown cheatsheet</a>.</p>
<strong>This is how basic rmarkdown document template looks like in RStudio:</strong>
<pre><code>---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.</code></pre>
<div id="yaml" class="section level3">
<h3>YAML</h3>
<p>Lets break down this document, first part, embedded between double <code>---</code> is YAML header. We can pass additional arguments to header, like author or date:</p>
<pre><code>---
title: "Reproducible Data Analysis in R"
author: "Ülo Maiväli^1^, Taavi Päll^2^"
date: "`r Sys.Date()`" 
output:
  html_document:
    theme: journal
    highlight: pygments
    toc: true
    toc_float: true
    toc_depth: 4
---</code></pre>
<p>Note that above, date is returned as <code>Sys.Date()</code> using R code, but it could be much simpler, like “29. september 2016”. If you run Knit from RStudio <strong>all fields in YAML are optional</strong>. Default <code>output: html_document</code> specifies .html output, <code>pdf_document</code> and <code>word_document</code> specify that .pdf and .docx ,respectively, is genereated by pandoc.</p>
</div>
<div id="code-chunks" class="section level3">
<h3>Code chunks</h3>
<p>Most important parts of R markdown document are R code chunks, which look like this:</p>
<pre><code>
```{r plotnorm}
x <- rnorm(100)
boxplot(x)
```
</code></pre>
R markdown chunks start with triple backticks, followed by <code>{r}</code>:
<pre><code>
```{r chunkname}
</code></pre>
Then comes your R code. And chunk ends with triple backticks (grave accent):
<pre><code>
```
</code></pre>
<p>An R Markdown document usually contains many code chunks. All consequtive chunks are evaluated in order of appearance in a single R session. All objects generated will be preserved in future chunks. It’s like running source on your R file without interleaved text. In fact, you can pull out only R code from your R markdown file using knitr command <code>purl</code>.</p>
</div>
<div id="chunk-options" class="section level3">
<h3>Chunk options</h3>
<p>Chunk output can be customized with knitr <a href="http://yihui.name/knitr/options/">options</a>, arguments set in the <code>{}</code> of a chunk header. Some of the frequently used chunk options:</p>
<ul>
<li><code>include = FALSE</code> prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.</li>
<li><code>echo = FALSE</code> prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.</li>
<li><code>message = FALSE</code> prevents messages that are generated by code from appearing in the finished file.</li>
<li><code>warning = FALSE</code> prevents warnings that are generated by code from appearing in the finished.</li>
<li><code>fig.cap = "..."</code> adds a figure caption.</li>
</ul>
<p>To knit this rmarkdown document into a html, pdf or word document hit <code>Knit</code> button in the head of source file window in RStudio:</p>
<div class="figure">
<img src="graphs/knit.png" alt="" />
<p class="caption">It is easy to Knit your R markdown document in RStudio.</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
