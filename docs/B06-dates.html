<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>B06-dates.knit</title>

<script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Reproducible Data Analysis in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<hr />
<hr />
<!-- # Using Dates and Times in R -->
<!-- % Bonnie Dixon -->
<!-- % 14-02-10 15:09:57 -->
<!-- *Today at the [Davis R Users' -->
<!-- Group](http://www.noamross.net/davis-r-users-group.html), [Bonnie -->
<!-- Dixon](http://ffhi.ucdavis.edu/people/directory/bmdixon) gave a tutorial on the -->
<!-- various ways to handle dates and times in R. Bonnie provided this great script -->
<!-- which walks through essential classes, functions, and packages. Here it is piped through -->
<!-- `knitr::spin`. The original R script can be found as a gist -->
<!-- [here](https://gist.github.com/noamross/8928124).* -->
<div id="date-and-time-classes" class="section level1">
<h1>Date and time classes</h1>
<p>Three date and time classes are built-in in R, <code>Date</code>, <code>POSIXct</code>, and <code>POSIXlt</code>.</p>
<div id="date" class="section level2">
<h2>Date</h2>
<p>If you have <strong>only dates</strong> in your data (but no times).</p>
<p>Create a date:</p>
<pre class="r"><code>bs &lt;- as.Date(&quot;2016-08-29&quot;)
class(bs)</code></pre>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<pre class="r"><code>bs</code></pre>
<pre><code>## [1] &quot;2016-08-29&quot;</code></pre>
<p>If you don’t specify format, <code>as.Date</code> will try “%Y-%m-%d” then “%Y/%m/%d”. Other formats must be specified:</p>
<pre class="r"><code>es &lt;- as.Date(&quot;01/29/2017&quot;, format = &quot;%m/%d/%Y&quot;)
es  </code></pre>
<pre><code>## [1] &quot;2017-01-29&quot;</code></pre>
<pre class="r"><code>ch &lt;- as.Date(&quot;December 19, 2016&quot;, format = &quot;%B %d, %Y&quot;)
ch</code></pre>
<pre><code>## [1] &quot;2016-12-19&quot;</code></pre>
<p>The list of format symbols can be accessed via <code>strptime</code>:</p>
<pre class="r"><code>?strptime     </code></pre>
<p>Get the current date:</p>
<pre class="r"><code>Sys.Date()</code></pre>
<pre><code>## [1] &quot;2021-09-03&quot;</code></pre>
<p><strong>Calculations with dates</strong>. Find the difference between dates:</p>
<pre class="r"><code>es - bs</code></pre>
<pre><code>## Time difference of 153 days</code></pre>
<pre class="r"><code>difftime(ch, bs, units = &quot;weeks&quot;)</code></pre>
<pre><code>## Time difference of 16 weeks</code></pre>
<p>Add or subtract days:</p>
<pre class="r"><code>bs + 40</code></pre>
<pre><code>## [1] &quot;2016-10-08&quot;</code></pre>
<pre class="r"><code>ch - 10</code></pre>
<pre><code>## [1] &quot;2016-12-09&quot;</code></pre>
<p>Create a vector of dates and find the intervals between them:</p>
<pre class="r"><code>road.fatalities &lt;- as.Date(c(&quot;01.01.2016&quot;, &quot;05.01.2016&quot;, &quot;11.01.2016&quot;,&quot;18.01.2016&quot;,&quot;02.02.2016&quot;,&quot;08.02.2016&quot;,&quot;19.02.2016&quot;,&quot;25.02.2016&quot;, &quot;02.03.2016&quot;, &quot;28.03.2016&quot;, &quot;29.03.2016&quot;, &quot;21.03.2016&quot;, &quot;04.04.2016&quot;, &quot;12.04.2016&quot;, &quot;13.04.2016&quot;,&quot;09.05.2016&quot;,&quot;13.05.2016&quot;,&quot;16.05.2016&quot;, &quot;01.08.2016&quot;,&quot;22.08.2016&quot;), format = &quot;%d.%m.%Y&quot;)
road.fatalities &lt;- sort(road.fatalities) # just in case, lets sort it
road.fatalities</code></pre>
<pre><code>##  [1] &quot;2016-01-01&quot; &quot;2016-01-05&quot; &quot;2016-01-11&quot; &quot;2016-01-18&quot; &quot;2016-02-02&quot;
##  [6] &quot;2016-02-08&quot; &quot;2016-02-19&quot; &quot;2016-02-25&quot; &quot;2016-03-02&quot; &quot;2016-03-21&quot;
## [11] &quot;2016-03-28&quot; &quot;2016-03-29&quot; &quot;2016-04-04&quot; &quot;2016-04-12&quot; &quot;2016-04-13&quot;
## [16] &quot;2016-05-09&quot; &quot;2016-05-13&quot; &quot;2016-05-16&quot; &quot;2016-08-01&quot; &quot;2016-08-22&quot;</code></pre>
<pre class="r"><code>diff(road.fatalities)</code></pre>
<pre><code>## Time differences in days
##  [1]  4  6  7 15  6 11  6  6 19  7  1  6  8  1 26  4  3 77 21</code></pre>
<p>Create a sequence of dates:</p>
<pre class="r"><code>six.weeks &lt;- seq(Sys.Date(), length = 6, by = &quot;week&quot;) 
six.weeks</code></pre>
<pre><code>## [1] &quot;2021-09-03&quot; &quot;2021-09-10&quot; &quot;2021-09-17&quot; &quot;2021-09-24&quot; &quot;2021-10-01&quot;
## [6] &quot;2021-10-08&quot;</code></pre>
<pre class="r"><code>six.weeks &lt;- seq(Sys.Date(), length = 6, by = 7)
six.weeks</code></pre>
<pre><code>## [1] &quot;2021-09-03&quot; &quot;2021-09-10&quot; &quot;2021-09-17&quot; &quot;2021-09-24&quot; &quot;2021-10-01&quot;
## [6] &quot;2021-10-08&quot;</code></pre>
<pre class="r"><code>six.weeks &lt;- seq(Sys.Date(), length = 3, by = &quot;2 weeks&quot;)
six.weeks</code></pre>
<pre><code>## [1] &quot;2021-09-03&quot; &quot;2021-09-17&quot; &quot;2021-10-01&quot;</code></pre>
<p>See the internal integer representation:</p>
<pre class="r"><code>unclass(bs)</code></pre>
<pre><code>## [1] 17042</code></pre>
<p>Note, that internal integer representation of Date class is number of days from <code>January 1, 1970</code>:</p>
<pre class="r"><code>bs - as.Date(&quot;1970-01-01&quot;) # </code></pre>
<pre><code>## Time difference of 17042 days</code></pre>
</div>
<div id="posixct" class="section level2">
<h2>POSIXct</h2>
<p>If you have <strong>times in your data</strong>, this is usually the best class to use.</p>
<p>Create some POSIXct objects:</p>
<pre class="r"><code>mft1 &lt;- as.POSIXct(&quot;2014-03-11  17:14:15&quot;)
mft1</code></pre>
<pre><code>## [1] &quot;2014-03-11 17:14:15 EET&quot;</code></pre>
<p>Specify format:</p>
<pre class="r"><code>mft2 &lt;- as.POSIXct(&quot;22-Oct-2013 16:30:55&quot;, format = &quot;%d-%b-%Y %H:%M:%S&quot;)
mft2</code></pre>
<pre><code>## [1] &quot;2013-10-22 16:30:55 EEST&quot;</code></pre>
<p>Specify the time zone:</p>
<pre class="r"><code>rstudio.webinar &lt;- as.POSIXct(&quot;November 9, 2016 11am&quot;, 
                  format = &quot;%B %d, %Y %I%p&quot;, 
                  tz = &quot;EST&quot;)
rstudio.webinar</code></pre>
<pre><code>## [1] &quot;2016-11-09 11:00:00 EST&quot;</code></pre>
<p><strong>Some calculations with times</strong> Compare times:</p>
<pre class="r"><code>mft1 &gt; mft2</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Add or subtract seconds:</p>
<pre class="r"><code>mft1 + 30</code></pre>
<pre><code>## [1] &quot;2014-03-11 17:14:45 EET&quot;</code></pre>
<pre class="r"><code>mft2 - 30</code></pre>
<pre><code>## [1] &quot;2013-10-22 16:30:25 EEST&quot;</code></pre>
<p>Find the difference between times:</p>
<pre class="r"><code>mft1 - mft2</code></pre>
<pre><code>## Time difference of 140.0718 days</code></pre>
<p>Automatically adjusts for daylight savings time. Last sunday in march, clocks are adjusted forward one hour:</p>
<pre class="r"><code>as.POSIXct(&quot;2016-03-27 3:00:00&quot;) - as.POSIXct(&quot;2016-03-26 23:55:00&quot;) # note that time difference is only 2.08 hours</code></pre>
<pre><code>## Time difference of 5 mins</code></pre>
<p>Get the current time (in POSIXct by default):</p>
<pre class="r"><code>Sys.time()</code></pre>
<pre><code>## [1] &quot;2021-09-03 12:28:15 EEST&quot;</code></pre>
<p>See the internal integer representation in seconds:</p>
<pre class="r"><code>unclass(mft1)</code></pre>
<pre><code>## [1] 1394550855
## attr(,&quot;tzone&quot;)
## [1] &quot;&quot;</code></pre>
<pre class="r"><code>difftime(mft1, as.POSIXct(&quot;1970-01-01 00:00:00&quot;, tz = &quot;UTC&quot;), units = &quot;secs&quot;)</code></pre>
<pre><code>## Time difference of 1394550855 secs</code></pre>
</div>
<div id="posixlt" class="section level2">
<h2>POSIXlt</h2>
<p>This class enables easy extraction of specific componants of a time.</p>
<ul>
<li><code>ct</code> – calendar time</li>
<li><code>lt</code> – local time. <code>lt</code> also helps one remember that POXIXlt objects are <em>lists</em>.)</li>
</ul>
<p>Create a time:</p>
<pre class="r"><code>mft1.lt &lt;- as.POSIXlt(&quot;2014-03-11   17:14:15&quot;)
mft1.lt</code></pre>
<pre><code>## [1] &quot;2014-03-11 17:14:15 EET&quot;</code></pre>
<pre class="r"><code>unclass(mft1.lt)</code></pre>
<pre><code>## $sec
## [1] 15
## 
## $min
## [1] 14
## 
## $hour
## [1] 17
## 
## $mday
## [1] 11
## 
## $mon
## [1] 2
## 
## $year
## [1] 114
## 
## $wday
## [1] 2
## 
## $yday
## [1] 69
## 
## $isdst
## [1] 0
## 
## $zone
## [1] &quot;EET&quot;
## 
## $gmtoff
## [1] NA</code></pre>
<pre class="r"><code>unlist(mft1.lt)</code></pre>
<pre><code>##    sec    min   hour   mday    mon   year   wday   yday  isdst   zone gmtoff 
##   &quot;15&quot;   &quot;14&quot;   &quot;17&quot;   &quot;11&quot;    &quot;2&quot;  &quot;114&quot;    &quot;2&quot;   &quot;69&quot;    &quot;0&quot;  &quot;EET&quot;     NA</code></pre>
<p>Extract componants of a time object:</p>
<pre class="r"><code>mft1.lt$sec</code></pre>
<pre><code>## [1] 15</code></pre>
<pre class="r"><code>mft1.lt$wday</code></pre>
<pre><code>## [1] 2</code></pre>
<p>Truncate or round off the time:</p>
<pre class="r"><code>trunc(mft1.lt, &quot;days&quot;)</code></pre>
<pre><code>## [1] &quot;2014-03-11 EET&quot;</code></pre>
<pre class="r"><code>trunc(mft1.lt, &quot;mins&quot;)</code></pre>
<pre><code>## [1] &quot;2014-03-11 17:14:00 EET&quot;</code></pre>
<p><strong>Summary of date and time classes</strong></p>
<ul>
<li>When you just have dates, use <code>Date</code>.</li>
<li>When you have times, <code>POSIXct</code> is usually the best,</li>
<li><code>POSIXlt</code> enables easy extraction of specific components</li>
<li>and there is also <code>chron</code> package when you don’t need to deal with timezones and daylight savings time.</li>
</ul>
</div>
<div id="manipulating-times-and-dates" class="section level2">
<h2>Manipulating times and dates</h2>
<div id="lubridate" class="section level3">
<h3>lubridate</h3>
<p>This package is a wrapper for POSIXct with more intuitive syntax.</p>
<pre class="r"><code>library(lubridate)</code></pre>
<p>Create a time. Note that lubridate uses UTC time zones as default:</p>
<pre class="r"><code>mft1.lub &lt;- ymd_hms(&quot;2014-03-11 17:14:15&quot;)
mft1.lub</code></pre>
<pre><code>## [1] &quot;2014-03-11 17:14:15 UTC&quot;</code></pre>
<p>We have to set timezone explicitly:</p>
<pre class="r"><code>mft2.lub &lt;- dmy_hm(&quot;22-Oct-2013 16:30&quot;, tz = &quot;EET&quot;) 
mft2.lub</code></pre>
<pre><code>## [1] &quot;2013-10-22 16:30:00 EEST&quot;</code></pre>
<p>Timezone can be easily changed using <code>force_tz</code>:</p>
<pre class="r"><code>mft1.lub &lt;- force_tz(mft1.lub, &quot;EET&quot;)
mft1.lub</code></pre>
<pre><code>## [1] &quot;2014-03-11 17:14:15 EET&quot;</code></pre>
<pre class="r"><code>rstudio.webinar &lt;- mdy_h(&quot;November 9, 2016 11am&quot;)
rstudio.webinar</code></pre>
<pre><code>## [1] &quot;2016-11-09 11:00:00 UTC&quot;</code></pre>
<pre class="r"><code>today &lt;- ymd(Sys.Date())
today</code></pre>
<pre><code>## [1] &quot;2021-09-03&quot;</code></pre>
<p>Some manipulations: Extract or reassign componants:</p>
<pre class="r"><code>year(mft1.lub)</code></pre>
<pre><code>## [1] 2014</code></pre>
<pre class="r"><code>week(mft1.lub)</code></pre>
<pre><code>## [1] 10</code></pre>
<pre class="r"><code>wday(mft1.lub, label = TRUE)</code></pre>
<pre><code>## [1] Tue
## Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat</code></pre>
<pre class="r"><code>hour(mft1.lub)</code></pre>
<pre><code>## [1] 17</code></pre>
<pre class="r"><code>tz(mft1.lub)</code></pre>
<pre><code>## [1] &quot;EET&quot;</code></pre>
<pre class="r"><code>second(mft1.lub) &lt;- 7
mft1.lub</code></pre>
<pre><code>## [1] &quot;2014-03-11 17:14:07 EET&quot;</code></pre>
<p>Converting to decimal hours can facilitate some types of calculations:</p>
<pre class="r"><code>mft1.dechr &lt;- hour(mft1.lub) + minute(mft1.lub)/60 + second(mft1.lub)/3600
mft1.dechr</code></pre>
<pre><code>## [1] 17.23528</code></pre>
<ul>
<li>Lubridate distinguishes between four types of objects: instant, interval, duration, and period.</li>
<li>An instant is a specific moment in time.</li>
<li>Interval, duration, and period are all ways of recording time spans.</li>
</ul>
<p>Dates and times parsed in lubridate are instants:</p>
<pre class="r"><code>is.instant(mft1.lub)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Round an instant:</p>
<pre class="r"><code>round_date(mft1.lub, &quot;minute&quot;)</code></pre>
<pre><code>## [1] &quot;2014-03-11 17:14:00 EET&quot;</code></pre>
<pre class="r"><code>round_date(mft1.lub, &quot;day&quot;)</code></pre>
<pre><code>## [1] &quot;2014-03-12 EET&quot;</code></pre>
<p>Get the current time or date as an instant (<code>Sys.time()</code>):</p>
<pre class="r"><code>now()</code></pre>
<pre><code>## [1] &quot;2021-09-03 12:28:15 EEST&quot;</code></pre>
<p>Shortcut for <code>Sys.Date()</code></p>
<pre class="r"><code>today()</code></pre>
<pre><code>## [1] &quot;2021-09-03&quot;</code></pre>
<p>Some calculations with instants. Note that the units are seconds:</p>
<pre class="r"><code>mft1.lub - mft2.lub</code></pre>
<pre><code>## Time difference of 140.0723 days</code></pre>
<pre class="r"><code>mft1.lub &gt; mft2.lub</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Add seconds:</p>
<pre class="r"><code>mft1.lub + 30</code></pre>
<pre><code>## [1] &quot;2014-03-11 17:14:37 EET&quot;</code></pre>
<p>An interval is the span of time that occurs between two specified instants.</p>
<pre class="r"><code>time.to.xmas &lt;- interval(now(), dmy(&quot;24-12-2016&quot;))
time.to.xmas</code></pre>
<pre><code>## [1] 2021-09-03 12:28:15 EEST--2016-12-24 02:00:00 EET</code></pre>
<p>Check whether a certain instant occured with a specified interval:</p>
<pre class="r"><code>rstudio.webinar %within% time.to.xmas</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>mft1.lub %within% time.to.xmas</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p>Determine whether two intervals overlap:</p>
<pre class="r"><code>daylight &lt;- as.interval(ymd_hm(&quot;2016-03-26 23:55&quot;), ymd_hm(&quot;2016-03-27 3:00&quot;))
daylight</code></pre>
<pre><code>## [1] 2016-03-26 23:55:00 UTC--2016-03-27 03:00:00 UTC</code></pre>
<pre class="r"><code>inbed &lt;- as.interval(ymd_hm(&quot;2016-03-26 22:30&quot;), ymd_hm(&quot;2016-03-27 7:30&quot;))</code></pre>
<pre class="r"><code>int_overlaps(inbed, daylight)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>A <strong>duration is a time span not anchored to specific start and end times</strong>. It has an exact, fixed length, and is stored internally in seconds. Lets go to the wild side and create some durations:</p>
<pre class="r"><code>six.minutes &lt;- dminutes(6)
six.minutes</code></pre>
<pre><code>## [1] &quot;360s (~6 minutes)&quot;</code></pre>
<pre class="r"><code>five.days &lt;- ddays(5)
five.days</code></pre>
<pre><code>## [1] &quot;432000s (~5 days)&quot;</code></pre>
<p>And now, after some practice with days and minutes, lets create whole year…</p>
<pre class="r"><code>one.year &lt;- dyears(1)
one.year</code></pre>
<pre><code>## [1] &quot;31557600s (~1 years)&quot;</code></pre>
<pre class="r"><code>as.duration(inbed)</code></pre>
<pre><code>## [1] &quot;32400s (~9 hours)&quot;</code></pre>
<p>Calculations with durations:</p>
<pre class="r"><code>year(mft1.lub)</code></pre>
<pre><code>## [1] 2014</code></pre>
<pre class="r"><code>mft1.lub + one.year</code></pre>
<pre><code>## [1] &quot;2015-03-11 23:14:07 EET&quot;</code></pre>
<pre class="r"><code>five.days + dhours(12)</code></pre>
<pre><code>## [1] &quot;475200s (~5.5 days)&quot;</code></pre>
<pre class="r"><code>six.minutes/as.duration(inbed)</code></pre>
<pre><code>## [1] 0.01111111</code></pre>
<p>A <strong>period is a time span not anchored to specific start and end times and measured in units larger than seconds with inexact lengths</strong>. Create some periods:</p>
<pre class="r"><code>three.weeks &lt;- weeks(3)
three.weeks</code></pre>
<pre><code>## [1] &quot;21d 0H 0M 0S&quot;</code></pre>
<pre class="r"><code>four.hours &lt;- hours(4)
four.hours</code></pre>
<pre><code>## [1] &quot;4H 0M 0S&quot;</code></pre>
<p>Calculations with periods:</p>
<pre class="r"><code>mft2.lub</code></pre>
<pre><code>## [1] &quot;2013-10-22 16:30:00 EEST&quot;</code></pre>
<pre class="r"><code>mft2.lub + three.weeks</code></pre>
<pre><code>## [1] &quot;2013-11-12 16:30:00 EET&quot;</code></pre>
<pre class="r"><code>sabbatical &lt;- months(6) + days(12)
sabbatical</code></pre>
<pre><code>## [1] &quot;6m 12d 0H 0M 0S&quot;</code></pre>
<pre class="r"><code>three.weeks/sabbatical</code></pre>
<pre><code>## [1] 0.1078998</code></pre>
</div>
</div>
<div id="calculating-mean-clock-times" class="section level2">
<h2>Calculating mean clock times</h2>
<p>Say we have a vector of clock times in decimal hours and <strong>we want to calculate the mean clock time</strong>.</p>
<pre class="r"><code>bed.times &lt;- c(23.9, 0.5, 22.7, 0.1, 23.3, 1.2, 23.6)
bed.times</code></pre>
<pre><code>## [1] 23.9  0.5 22.7  0.1 23.3  1.2 23.6</code></pre>
<pre class="r"><code>mean(bed.times)  # doesn&#39;t work, gives arithmetic mean</code></pre>
<pre><code>## [1] 13.61429</code></pre>
<p>The <strong>clock has a circular scale</strong>, which ends where it begins, so we need to use circular statistics. Get the package <code>psych</code>.</p>
<pre class="r"><code>library(psych)</code></pre>
<pre><code>## 
## Attaching package: &#39;psych&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:ggplot2&#39;:
## 
##     %+%, alpha</code></pre>
<pre class="r"><code>circadian.mean(bed.times)</code></pre>
<pre><code>## [1] 23.89926</code></pre>
</div>
<div id="using-times-and-dates-in-a-data-frame" class="section level2">
<h2>Using times and dates in a data frame</h2>
<p>Here is a data frame with a week of hypothetical times of going to bed and getting up for one person, and the total amount of time sleep time obtained each night according to a sleep monitoring device.</p>
<pre class="r"><code>sleep &lt;- 
  data.frame(
    bed.time = ymd_hms(&quot;2013-09-01 23:05:24&quot;, &quot;2013-09-02 22:51:09&quot;,
                       &quot;2013-09-04 00:09:16&quot;, &quot;2013-09-04 23:43:31&quot;,
                       &quot;2013-09-06 00:17:41&quot;, &quot;2013-09-06 22:42:27&quot;,
                       &quot;2013-09-08 00:22:27&quot;),
    rise.time = ymd_hms(&quot;2013-09-02 08:03:29&quot;, &quot;2013-09-03 07:34:21&quot;,
                        &quot;2013-09-04 07:45:06&quot;, &quot;2013-09-05 07:07:17&quot;,
                        &quot;2013-09-06 08:17:13&quot;, &quot;2013-09-07 06:52:11&quot;,
                        &quot;2013-09-08 07:15:19&quot;),
    sleep.time = dhours(c(6.74, 7.92, 7.01, 6.23, 6.34, 7.42, 6.45))
              ); sleep</code></pre>
<pre><code>##              bed.time           rise.time           sleep.time
## 1 2013-09-01 23:05:24 2013-09-02 08:03:29 24264s (~6.74 hours)
## 2 2013-09-02 22:51:09 2013-09-03 07:34:21 28512s (~7.92 hours)
## 3 2013-09-04 00:09:16 2013-09-04 07:45:06 25236s (~7.01 hours)
## 4 2013-09-04 23:43:31 2013-09-05 07:07:17 22428s (~6.23 hours)
## 5 2013-09-06 00:17:41 2013-09-06 08:17:13 22824s (~6.34 hours)
## 6 2013-09-06 22:42:27 2013-09-07 06:52:11 26712s (~7.42 hours)
## 7 2013-09-08 00:22:27 2013-09-08 07:15:19 23220s (~6.45 hours)</code></pre>
<p>We want to calculate sleep efficiency, the percent of time in bed spent asleep.</p>
<pre class="r"><code>sleep$efficiency &lt;- 
  round(sleep$sleep.time/(sleep$rise.time - sleep$bed.time)*100, 1)
sleep</code></pre>
<pre><code>##              bed.time           rise.time           sleep.time efficiency
## 1 2013-09-01 23:05:24 2013-09-02 08:03:29 24264s (~6.74 hours)       75.2
## 2 2013-09-02 22:51:09 2013-09-03 07:34:21 28512s (~7.92 hours)       90.8
## 3 2013-09-04 00:09:16 2013-09-04 07:45:06 25236s (~7.01 hours)       92.3
## 4 2013-09-04 23:43:31 2013-09-05 07:07:17 22428s (~6.23 hours)       84.2
## 5 2013-09-06 00:17:41 2013-09-06 08:17:13 22824s (~6.34 hours)       79.3
## 6 2013-09-06 22:42:27 2013-09-07 06:52:11 26712s (~7.42 hours)       90.9
## 7 2013-09-08 00:22:27 2013-09-08 07:15:19 23220s (~6.45 hours)       93.7</code></pre>
<p>Now let’s calculate the mean of each column:</p>
<pre class="r"><code>colMeans(sleep)  # doesn&#39;t work</code></pre>
<pre class="r"><code>circadian.mean(hour(sleep$bed.time) + 
               minute(sleep$bed.time)/60 + 
               second(sleep$bed.time)/3600)</code></pre>
<pre><code>## [1] 23.60028</code></pre>
<pre class="r"><code>circadian.mean(hour(sleep$rise.time) + 
               minute(sleep$rise.time)/60 + 
               second(sleep$rise.time)/3600)</code></pre>
<pre><code>## [1] 7.55924</code></pre>
<pre class="r"><code>mean(sleep$sleep.time)/3600</code></pre>
<pre><code>## [1] 6.872857</code></pre>
<pre class="r"><code>mean(sleep$efficiency)</code></pre>
<pre><code>## [1] 86.62857</code></pre>
<!-- We can also plot sleep duration and efficiency across the week: -->
<!-- ```{r} -->
<!-- par(mar = c(5, 4, 4, 4)) -->
<!-- plot(round_date(sleep$rise.time, "day"), sleep$efficiency,  -->
<!--      type = "o", col = "blue", xlab = "Morning", ylab = NA) -->
<!-- par(new = TRUE) -->
<!-- plot(round_date(sleep$rise.time, "day"), sleep$sleep.time/3600,  -->
<!--      type = "o", col = "red", axes = FALSE, ylab = NA, xlab = NA) -->
<!-- axis(side = 4) -->
<!-- mtext(side = 4, line = 2.5, col = "red", "Sleep duration") -->
<!-- mtext(side = 2, line = 2.5, col = "blue", "Sleep efficiency") -->
<!-- ``` -->
<!-- More resources on times and dates -->
<!-- Date and time tutorials for R: -->
<!-- + [http://www.stat.berkeley.edu/classes/s133/dates.html](http://www.stat.berkeley.edu/classes/s133/dates.html) -->
<!-- + [http://science.nature.nps.gov/im/datamgmt/statistics/r/fundamentals/dates.cfm](http://science.nature.nps.gov/im/datamgmt/statistics/r/fundamentals/dates.cfm) -->
<!-- + [http://en.wikibooks.org/wiki/R_Programming/Times_and_Dates](http://en.wikibooks.org/wiki/R_Programming/Times_and_Dates) -->
<!-- [lubridate](http://www.jstatsoft.org/v40/i03/paper) -->
<!-- Time zone and daylight saving time info: -->
<!-- + [http://www.timeanddate.com/](http://www.timeanddate.com/) -->
<!-- + [http://en.wikipedia.org/wiki/List_of_tz_database_time_zones](http://en.wikipedia.org/wiki/List_of_tz_database_time_zones) -->
<!-- + [http://www.twinsun.com/tz/tz-link.htm](http://www.twinsun.com/tz/tz-link.htm) -->
<!-- + Also see the R help file at `?Sys.timezone` -->
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
